{"ast":null,"code":"'use strict'; //  ---------------------------------------------------------------------------\n\nconst Exchange = require('./base/Exchange');\n\nconst {\n  AuthenticationError,\n  ExchangeError,\n  PermissionDenied,\n  ExchangeNotAvailable,\n  OnMaintenance,\n  InvalidOrder,\n  OrderNotFound,\n  InsufficientFunds,\n  ArgumentsRequired,\n  BadSymbol,\n  BadRequest,\n  RequestTimeout,\n  NetworkError\n} = require('./base/errors');\n\nconst {\n  TRUNCATE\n} = require('./base/functions/number'); //  ---------------------------------------------------------------------------\n\n\nmodule.exports = class huobipro extends Exchange {\n  describe() {\n    return this.deepExtend(super.describe(), {\n      'id': 'huobipro',\n      'name': 'Huobi Pro',\n      'countries': ['CN'],\n      'rateLimit': 2000,\n      'userAgent': this.userAgents['chrome39'],\n      'version': 'v1',\n      'accounts': undefined,\n      'accountsById': undefined,\n      'hostname': 'api.huobi.pro',\n      // api.testnet.huobi.pro\n      'pro': true,\n      'has': {\n        'cancelOrder': true,\n        'CORS': false,\n        'createOrder': true,\n        'fetchBalance': true,\n        'fetchClosedOrders': true,\n        'fetchCurrencies': true,\n        'fetchDepositAddress': true,\n        'fetchDeposits': true,\n        'fetchMarkets': true,\n        'fetchMyTrades': true,\n        'fetchOHLCV': true,\n        'fetchOpenOrders': true,\n        'fetchOrder': true,\n        'fetchOrderBook': true,\n        'fetchOrders': true,\n        'fetchTicker': true,\n        'fetchTickers': true,\n        'fetchTrades': true,\n        'fetchTradingLimits': true,\n        'fetchWithdrawals': true,\n        'withdraw': true\n      },\n      'timeframes': {\n        '1m': '1min',\n        '5m': '5min',\n        '15m': '15min',\n        '30m': '30min',\n        '1h': '60min',\n        '4h': '4hour',\n        '1d': '1day',\n        '1w': '1week',\n        '1M': '1mon',\n        '1y': '1year'\n      },\n      'urls': {\n        'test': {\n          'market': 'https://api.testnet.huobi.pro',\n          'public': 'https://api.testnet.huobi.pro',\n          'private': 'https://api.testnet.huobi.pro'\n        },\n        'logo': 'https://user-images.githubusercontent.com/1294454/76137448-22748a80-604e-11ea-8069-6e389271911d.jpg',\n        'api': {\n          'market': 'https://{hostname}',\n          'public': 'https://{hostname}',\n          'private': 'https://{hostname}',\n          'v2Public': 'https://{hostname}',\n          'v2Private': 'https://{hostname}'\n        },\n        'www': 'https://www.huobi.com',\n        'referral': 'https://www.huobi.com/en-us/topic/invited/?invite_code=rwrd3',\n        'doc': 'https://huobiapi.github.io/docs/spot/v1/cn/',\n        'fees': 'https://www.huobi.com/about/fee/'\n      },\n      'api': {\n        'v2Public': {\n          'get': ['reference/currencies']\n        },\n        'v2Private': {\n          'get': ['account/ledger', 'account/withdraw/quota', 'account/withdraw/address', // 提币地址查询(限母用户可用)\n          'account/deposit/address', 'reference/transact-fee-rate', 'account/asset-valuation', // 获取账户资产估值\n          'point/account', // 点卡余额查询\n          'sub-user/user-list', // 获取子用户列表\n          'sub-user/user-state', // 获取特定子用户的用户状态\n          'sub-user/account-list', // 获取特定子用户的账户列表\n          'sub-user/deposit-address', // 子用户充币地址查询\n          'sub-user/query-deposit', // 子用户充币记录查询\n          'user/api-key' // 母子用户API key信息查询\n          ],\n          'post': ['account/transfer', 'point/transfer', // 点卡划转\n          'sub-user/management', // 冻结/解冻子用户\n          'sub-user/creation', // 子用户创建\n          'sub-user/tradable-market', // 设置子用户交易权限\n          'sub-user/transferability', // 设置子用户资产转出权限\n          'sub-user/api-key-generation', // 子用户API key创建\n          'sub-user/api-key-modification', // 修改子用户API key\n          'sub-user/api-key-deletion' // 删除子用户API key\n          ]\n        },\n        'market': {\n          'get': ['history/kline', // 获取K线数据\n          'detail/merged', // 获取聚合行情(Ticker)\n          'depth', // 获取 Market Depth 数据\n          'trade', // 获取 Trade Detail 数据\n          'history/trade', // 批量获取最近的交易记录\n          'detail', // 获取 Market Detail 24小时成交量数据\n          'tickers']\n        },\n        'public': {\n          'get': ['common/symbols', // 查询系统支持的所有交易对\n          'common/currencys', // 查询系统支持的所有币种\n          'common/timestamp', // 查询系统当前时间\n          'common/exchange', // order limits\n          'settings/currencys' // ?language=en-US\n          ]\n        },\n        'private': {\n          'get': ['account/accounts', // 查询当前用户的所有账户(即account-id)\n          'account/accounts/{id}/balance', // 查询指定账户的余额\n          'account/accounts/{sub-uid}', 'account/history', 'cross-margin/loan-info', 'margin/loan-info', // 查询借币币息率及额度\n          'fee/fee-rate/get', 'order/openOrders', 'order/orders', 'order/orders/{id}', // 查询某个订单详情\n          'order/orders/{id}/matchresults', // 查询某个订单的成交明细\n          'order/orders/getClientOrder', 'order/history', // 查询当前委托、历史委托\n          'order/matchresults', // 查询当前成交、历史成交\n          'dw/withdraw-virtual/addresses', // 查询虚拟币提现地址（Deprecated）\n          'query/deposit-withdraw', 'margin/loan-info', 'margin/loan-orders', // 借贷订单\n          'margin/accounts/balance', // 借贷账户详情\n          'cross-margin/loan-orders', // 查询借币订单\n          'cross-margin/accounts/balance', // 借币账户详情\n          'points/actions', 'points/orders', 'subuser/aggregate-balance', 'stable-coin/exchange_rate', 'stable-coin/quote'],\n          'post': ['account/transfer', // 资产划转(该节点为母用户和子用户进行资产划转的通用接口。)\n          'futures/transfer', 'order/batch-orders', 'order/orders/place', // 创建并执行一个新订单 (一步下单， 推荐使用)\n          'order/orders/submitCancelClientOrder', 'order/orders/batchCancelOpenOrders', 'order/orders', // 创建一个新的订单请求 （仅创建订单，不执行下单）\n          'order/orders/{id}/place', // 执行一个订单 （仅执行已创建的订单）\n          'order/orders/{id}/submitcancel', // 申请撤销一个订单请求\n          'order/orders/batchcancel', // 批量撤销订单\n          'dw/balance/transfer', // 资产划转\n          'dw/withdraw/api/create', // 申请提现虚拟币\n          'dw/withdraw-virtual/create', // 申请提现虚拟币\n          'dw/withdraw-virtual/{id}/place', // 确认申请虚拟币提现（Deprecated）\n          'dw/withdraw-virtual/{id}/cancel', // 申请取消提现虚拟币\n          'dw/transfer-in/margin', // 现货账户划入至借贷账户\n          'dw/transfer-out/margin', // 借贷账户划出至现货账户\n          'margin/orders', // 申请借贷\n          'margin/orders/{id}/repay', // 归还借贷\n          'cross-margin/transfer-in', // 资产划转\n          'cross-margin/transfer-out', // 资产划转\n          'cross-margin/orders', // 申请借币\n          'cross-margin/orders/{id}/repay', // 归还借币\n          'stable-coin/exchange', 'subuser/transfer']\n        }\n      },\n      'fees': {\n        'trading': {\n          'tierBased': false,\n          'percentage': true,\n          'maker': 0.002,\n          'taker': 0.002\n        }\n      },\n      'exceptions': {\n        'exact': {\n          // err-code\n          'bad-request': BadRequest,\n          'base-date-limit-error': BadRequest,\n          // {\"status\":\"error\",\"err-code\":\"base-date-limit-error\",\"err-msg\":\"date less than system limit\",\"data\":null}\n          'api-not-support-temp-addr': PermissionDenied,\n          // {\"status\":\"error\",\"err-code\":\"api-not-support-temp-addr\",\"err-msg\":\"API withdrawal does not support temporary addresses\",\"data\":null}\n          'timeout': RequestTimeout,\n          // {\"ts\":1571653730865,\"status\":\"error\",\"err-code\":\"timeout\",\"err-msg\":\"Request Timeout\"}\n          'gateway-internal-error': ExchangeNotAvailable,\n          // {\"status\":\"error\",\"err-code\":\"gateway-internal-error\",\"err-msg\":\"Failed to load data. Try again later.\",\"data\":null}\n          'account-frozen-balance-insufficient-error': InsufficientFunds,\n          // {\"status\":\"error\",\"err-code\":\"account-frozen-balance-insufficient-error\",\"err-msg\":\"trade account balance is not enough, left: `0.0027`\",\"data\":null}\n          'invalid-amount': InvalidOrder,\n          // eg \"Paramemter `amount` is invalid.\"\n          'order-limitorder-amount-min-error': InvalidOrder,\n          // limit order amount error, min: `0.001`\n          'order-limitorder-amount-max-error': InvalidOrder,\n          // market order amount error, max: `1000000`\n          'order-marketorder-amount-min-error': InvalidOrder,\n          // market order amount error, min: `0.01`\n          'order-limitorder-price-min-error': InvalidOrder,\n          // limit order price error\n          'order-limitorder-price-max-error': InvalidOrder,\n          // limit order price error\n          'order-holding-limit-failed': InvalidOrder,\n          // {\"status\":\"error\",\"err-code\":\"order-holding-limit-failed\",\"err-msg\":\"Order failed, exceeded the holding limit of this currency\",\"data\":null}\n          'order-orderprice-precision-error': InvalidOrder,\n          // {\"status\":\"error\",\"err-code\":\"order-orderprice-precision-error\",\"err-msg\":\"order price precision error, scale: `4`\",\"data\":null}\n          'order-orderstate-error': OrderNotFound,\n          // canceling an already canceled order\n          'order-queryorder-invalid': OrderNotFound,\n          // querying a non-existent order\n          'order-update-error': ExchangeNotAvailable,\n          // undocumented error\n          'api-signature-check-failed': AuthenticationError,\n          'api-signature-not-valid': AuthenticationError,\n          // {\"status\":\"error\",\"err-code\":\"api-signature-not-valid\",\"err-msg\":\"Signature not valid: Incorrect Access key [Access key错误]\",\"data\":null}\n          'base-record-invalid': OrderNotFound,\n          // https://github.com/ccxt/ccxt/issues/5750\n          'base-symbol-trade-disabled': BadSymbol,\n          // {\"status\":\"error\",\"err-code\":\"base-symbol-trade-disabled\",\"err-msg\":\"Trading is disabled for this symbol\",\"data\":null}\n          'base-symbol-error': BadSymbol,\n          // {\"status\":\"error\",\"err-code\":\"base-symbol-error\",\"err-msg\":\"The symbol is invalid\",\"data\":null}\n          'system-maintenance': OnMaintenance,\n          // {\"status\": \"error\", \"err-code\": \"system-maintenance\", \"err-msg\": \"System is in maintenance!\", \"data\": null}\n          // err-msg\n          'invalid symbol': BadSymbol,\n          // {\"ts\":1568813334794,\"status\":\"error\",\"err-code\":\"invalid-parameter\",\"err-msg\":\"invalid symbol\"}\n          'symbol trade not open now': BadSymbol // {\"ts\":1576210479343,\"status\":\"error\",\"err-code\":\"invalid-parameter\",\"err-msg\":\"symbol trade not open now\"}\n\n        }\n      },\n      'options': {\n        // https://github.com/ccxt/ccxt/issues/5376\n        'fetchOrdersByStatesMethod': 'private_get_order_orders',\n        // 'private_get_order_history' // https://github.com/ccxt/ccxt/pull/5392\n        'fetchOpenOrdersMethod': 'fetch_open_orders_v1',\n        // 'fetch_open_orders_v2' // https://github.com/ccxt/ccxt/issues/5388\n        'createMarketBuyOrderRequiresPrice': true,\n        'fetchMarketsMethod': 'publicGetCommonSymbols',\n        'fetchBalanceMethod': 'privateGetAccountAccountsIdBalance',\n        'createOrderMethod': 'privatePostOrderOrdersPlace',\n        'language': 'en-US'\n      },\n      'commonCurrencies': {\n        // https://github.com/ccxt/ccxt/issues/6081\n        // https://github.com/ccxt/ccxt/issues/3365\n        // https://github.com/ccxt/ccxt/issues/2873\n        'GET': 'Themis',\n        // conflict with GET (Guaranteed Entrance Token, GET Protocol)\n        'HOT': 'Hydro Protocol',\n        // conflict with HOT (Holo) https://github.com/ccxt/ccxt/issues/4929\n        // https://github.com/ccxt/ccxt/issues/7399\n        // https://coinmarketcap.com/currencies/pnetwork/\n        // https://coinmarketcap.com/currencies/penta/markets/\n        // https://en.cryptonomist.ch/blog/eidoo/the-edo-to-pnt-upgrade-what-you-need-to-know-updated/\n        'PNT': 'Penta',\n        'SBTC': 'Super Bitcoin'\n      }\n    });\n  }\n\n  async fetchTradingLimits(symbols = undefined, params = {}) {\n    // this method should not be called directly, use loadTradingLimits () instead\n    //  by default it will try load withdrawal fees of all currencies (with separate requests)\n    //  however if you define symbols = [ 'ETH/BTC', 'LTC/BTC' ] in args it will only load those\n    await this.loadMarkets();\n\n    if (symbols === undefined) {\n      symbols = this.symbols;\n    }\n\n    const result = {};\n\n    for (let i = 0; i < symbols.length; i++) {\n      const symbol = symbols[i];\n      result[symbol] = await this.fetchTradingLimitsById(this.marketId(symbol), params);\n    }\n\n    return result;\n  }\n\n  async fetchTradingLimitsById(id, params = {}) {\n    const request = {\n      'symbol': id\n    };\n    const response = await this.publicGetCommonExchange(this.extend(request, params)); //\n    //     { status:   \"ok\",\n    //         data: {                                  symbol: \"aidocbtc\",\n    //                              'buy-limit-must-less-than':  1.1,\n    //                          'sell-limit-must-greater-than':  0.9,\n    //                         'limit-order-must-greater-than':  1,\n    //                            'limit-order-must-less-than':  5000000,\n    //                    'market-buy-order-must-greater-than':  0.0001,\n    //                       'market-buy-order-must-less-than':  100,\n    //                   'market-sell-order-must-greater-than':  1,\n    //                      'market-sell-order-must-less-than':  500000,\n    //                       'circuit-break-when-greater-than':  10000,\n    //                          'circuit-break-when-less-than':  10,\n    //                 'market-sell-order-rate-must-less-than':  0.1,\n    //                  'market-buy-order-rate-must-less-than':  0.1        } }\n    //\n\n    return this.parseTradingLimits(this.safeValue(response, 'data', {}));\n  }\n\n  parseTradingLimits(limits, symbol = undefined, params = {}) {\n    //\n    //   {                                  symbol: \"aidocbtc\",\n    //                  'buy-limit-must-less-than':  1.1,\n    //              'sell-limit-must-greater-than':  0.9,\n    //             'limit-order-must-greater-than':  1,\n    //                'limit-order-must-less-than':  5000000,\n    //        'market-buy-order-must-greater-than':  0.0001,\n    //           'market-buy-order-must-less-than':  100,\n    //       'market-sell-order-must-greater-than':  1,\n    //          'market-sell-order-must-less-than':  500000,\n    //           'circuit-break-when-greater-than':  10000,\n    //              'circuit-break-when-less-than':  10,\n    //     'market-sell-order-rate-must-less-than':  0.1,\n    //      'market-buy-order-rate-must-less-than':  0.1        }\n    //\n    return {\n      'info': limits,\n      'limits': {\n        'amount': {\n          'min': this.safeFloat(limits, 'limit-order-must-greater-than'),\n          'max': this.safeFloat(limits, 'limit-order-must-less-than')\n        }\n      }\n    };\n  }\n\n  costToPrecision(symbol, cost) {\n    return this.decimalToPrecision(cost, TRUNCATE, this.markets[symbol]['precision']['cost'], this.precisionMode);\n  }\n\n  async fetchMarkets(params = {}) {\n    const method = this.options['fetchMarketsMethod'];\n    const response = await this[method](params);\n    const markets = this.safeValue(response, 'data');\n    const numMarkets = markets.length;\n\n    if (numMarkets < 1) {\n      throw new NetworkError(this.id + ' publicGetCommonSymbols returned empty response: ' + this.json(markets));\n    }\n\n    const result = [];\n\n    for (let i = 0; i < markets.length; i++) {\n      const market = markets[i];\n      const baseId = this.safeString(market, 'base-currency');\n      const quoteId = this.safeString(market, 'quote-currency');\n      const id = baseId + quoteId;\n      const base = this.safeCurrencyCode(baseId);\n      const quote = this.safeCurrencyCode(quoteId);\n      const symbol = base + '/' + quote;\n      const precision = {\n        'amount': this.safeInteger(market, 'amount-precision'),\n        'price': this.safeInteger(market, 'price-precision'),\n        'cost': this.safeInteger(market, 'value-precision')\n      };\n      const maker = base === 'OMG' ? 0 : 0.2 / 100;\n      const taker = base === 'OMG' ? 0 : 0.2 / 100;\n      const minAmount = this.safeFloat(market, 'min-order-amt', Math.pow(10, -precision['amount']));\n      const maxAmount = this.safeFloat(market, 'max-order-amt');\n      const minCost = this.safeFloat(market, 'min-order-value', 0);\n      const state = this.safeString(market, 'state');\n      const active = state === 'online';\n      result.push({\n        'id': id,\n        'symbol': symbol,\n        'base': base,\n        'quote': quote,\n        'baseId': baseId,\n        'quoteId': quoteId,\n        'active': active,\n        'precision': precision,\n        'taker': taker,\n        'maker': maker,\n        'limits': {\n          'amount': {\n            'min': minAmount,\n            'max': maxAmount\n          },\n          'price': {\n            'min': Math.pow(10, -precision['price']),\n            'max': undefined\n          },\n          'cost': {\n            'min': minCost,\n            'max': undefined\n          }\n        },\n        'info': market\n      });\n    }\n\n    return result;\n  }\n\n  parseTicker(ticker, market = undefined) {\n    //\n    // fetchTicker\n    //\n    //     {\n    //         \"amount\": 26228.672978342216,\n    //         \"open\": 9078.95,\n    //         \"close\": 9146.86,\n    //         \"high\": 9155.41,\n    //         \"id\": 209988544334,\n    //         \"count\": 265846,\n    //         \"low\": 8988.0,\n    //         \"version\": 209988544334,\n    //         \"ask\": [ 9146.87, 0.156134 ],\n    //         \"vol\": 2.3822168242201668E8,\n    //         \"bid\": [ 9146.86, 0.080758 ],\n    //     }\n    //\n    // fetchTickers\n    //     {\n    //         symbol: \"bhdht\",\n    //         open:  2.3938,\n    //         high:  2.4151,\n    //         low:  2.3323,\n    //         close:  2.3909,\n    //         amount:  628.992,\n    //         vol:  1493.71841095,\n    //         count:  2088,\n    //         bid:  2.3643,\n    //         bidSize:  0.7136,\n    //         ask:  2.4061,\n    //         askSize:  0.4156\n    //     }\n    //\n    let symbol = undefined;\n\n    if (market !== undefined) {\n      symbol = market['symbol'];\n    }\n\n    const timestamp = this.safeInteger(ticker, 'ts');\n    let bid = undefined;\n    let bidVolume = undefined;\n    let ask = undefined;\n    let askVolume = undefined;\n\n    if ('bid' in ticker) {\n      if (Array.isArray(ticker['bid'])) {\n        bid = this.safeFloat(ticker['bid'], 0);\n        bidVolume = this.safeFloat(ticker['bid'], 1);\n      } else {\n        bid = this.safeFloat(ticker, 'bid');\n        bidVolume = this.safeValue(ticker, 'bidSize');\n      }\n    }\n\n    if ('ask' in ticker) {\n      if (Array.isArray(ticker['ask'])) {\n        ask = this.safeFloat(ticker['ask'], 0);\n        askVolume = this.safeFloat(ticker['ask'], 1);\n      } else {\n        ask = this.safeFloat(ticker, 'ask');\n        askVolume = this.safeValue(ticker, 'askSize');\n      }\n    }\n\n    const open = this.safeFloat(ticker, 'open');\n    const close = this.safeFloat(ticker, 'close');\n    let change = undefined;\n    let percentage = undefined;\n    let average = undefined;\n\n    if (open !== undefined && close !== undefined) {\n      change = close - open;\n      average = this.sum(open, close) / 2;\n\n      if (close !== undefined && close > 0) {\n        percentage = change / open * 100;\n      }\n    }\n\n    const baseVolume = this.safeFloat(ticker, 'amount');\n    const quoteVolume = this.safeFloat(ticker, 'vol');\n    const vwap = this.vwap(baseVolume, quoteVolume);\n    return {\n      'symbol': symbol,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'high': this.safeFloat(ticker, 'high'),\n      'low': this.safeFloat(ticker, 'low'),\n      'bid': bid,\n      'bidVolume': bidVolume,\n      'ask': ask,\n      'askVolume': askVolume,\n      'vwap': vwap,\n      'open': open,\n      'close': close,\n      'last': close,\n      'previousClose': undefined,\n      'change': change,\n      'percentage': percentage,\n      'average': average,\n      'baseVolume': baseVolume,\n      'quoteVolume': quoteVolume,\n      'info': ticker\n    };\n  }\n\n  async fetchOrderBook(symbol, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'symbol': market['id'],\n      'type': 'step0'\n    };\n    const response = await this.marketGetDepth(this.extend(request, params)); //\n    //     {\n    //         \"status\": \"ok\",\n    //         \"ch\": \"market.btcusdt.depth.step0\",\n    //         \"ts\": 1583474832790,\n    //         \"tick\": {\n    //             \"bids\": [\n    //                 [ 9100.290000000000000000, 0.200000000000000000 ],\n    //                 [ 9099.820000000000000000, 0.200000000000000000 ],\n    //                 [ 9099.610000000000000000, 0.205000000000000000 ],\n    //             ],\n    //             \"asks\": [\n    //                 [ 9100.640000000000000000, 0.005904000000000000 ],\n    //                 [ 9101.010000000000000000, 0.287311000000000000 ],\n    //                 [ 9101.030000000000000000, 0.012121000000000000 ],\n    //             ],\n    //             \"ts\":1583474832008,\n    //             \"version\":104999698780\n    //         }\n    //     }\n    //\n\n    if ('tick' in response) {\n      if (!response['tick']) {\n        throw new BadSymbol(this.id + ' fetchOrderBook() returned empty response: ' + this.json(response));\n      }\n\n      const tick = this.safeValue(response, 'tick');\n      const timestamp = this.safeInteger(tick, 'ts', this.safeInteger(response, 'ts'));\n      const result = this.parseOrderBook(tick, timestamp);\n      result['nonce'] = this.safeInteger(tick, 'version');\n      return result;\n    }\n\n    throw new ExchangeError(this.id + ' fetchOrderBook() returned unrecognized response: ' + this.json(response));\n  }\n\n  async fetchTicker(symbol, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'symbol': market['id']\n    };\n    const response = await this.marketGetDetailMerged(this.extend(request, params)); //\n    //     {\n    //         \"status\": \"ok\",\n    //         \"ch\": \"market.btcusdt.detail.merged\",\n    //         \"ts\": 1583494336669,\n    //         \"tick\": {\n    //             \"amount\": 26228.672978342216,\n    //             \"open\": 9078.95,\n    //             \"close\": 9146.86,\n    //             \"high\": 9155.41,\n    //             \"id\": 209988544334,\n    //             \"count\": 265846,\n    //             \"low\": 8988.0,\n    //             \"version\": 209988544334,\n    //             \"ask\": [ 9146.87, 0.156134 ],\n    //             \"vol\": 2.3822168242201668E8,\n    //             \"bid\": [ 9146.86, 0.080758 ],\n    //         }\n    //     }\n    //\n\n    const ticker = this.parseTicker(response['tick'], market);\n    const timestamp = this.safeValue(response, 'ts');\n    ticker['timestamp'] = timestamp;\n    ticker['datetime'] = this.iso8601(timestamp);\n    return ticker;\n  }\n\n  async fetchTickers(symbols = undefined, params = {}) {\n    await this.loadMarkets();\n    const response = await this.marketGetTickers(params);\n    const tickers = this.safeValue(response, 'data');\n    const timestamp = this.safeInteger(response, 'ts');\n    const result = {};\n\n    for (let i = 0; i < tickers.length; i++) {\n      const marketId = this.safeString(tickers[i], 'symbol');\n      const market = this.safeMarket(marketId);\n      const symbol = market['symbol'];\n      const ticker = this.parseTicker(tickers[i], market);\n      ticker['timestamp'] = timestamp;\n      ticker['datetime'] = this.iso8601(timestamp);\n      result[symbol] = ticker;\n    }\n\n    return this.filterByArray(result, 'symbol', symbols);\n  }\n\n  parseTrade(trade, market = undefined) {\n    //\n    // fetchTrades (public)\n    //\n    //     {\n    //         \"amount\": 0.010411000000000000,\n    //         \"trade-id\": 102090736910,\n    //         \"ts\": 1583497692182,\n    //         \"id\": 10500517034273194594947,\n    //         \"price\": 9096.050000000000000000,\n    //         \"direction\": \"sell\"\n    //     }\n    //\n    // fetchMyTrades (private)\n    //\n    //     {\n    //          'symbol': 'swftcbtc',\n    //          'fee-currency': 'swftc',\n    //          'filled-fees': '0',\n    //          'source': 'spot-api',\n    //          'id': 83789509854000,\n    //          'type': 'buy-limit',\n    //          'order-id': 83711103204909,\n    //          'filled-points': '0.005826843283532154',\n    //          'fee-deduct-currency': 'ht',\n    //          'filled-amount': '45941.53',\n    //          'price': '0.0000001401',\n    //          'created-at': 1597933260729,\n    //          'match-id': 100087455560,\n    //          'role': 'maker',\n    //          'trade-id': 100050305348\n    //     },\n    //\n    const marketId = this.safeString(trade, 'symbol');\n    const symbol = this.safeSymbol(marketId, market);\n    const timestamp = this.safeInteger2(trade, 'ts', 'created-at');\n    const order = this.safeString(trade, 'order-id');\n    let side = this.safeString(trade, 'direction');\n    let type = this.safeString(trade, 'type');\n\n    if (type !== undefined) {\n      const typeParts = type.split('-');\n      side = typeParts[0];\n      type = typeParts[1];\n    }\n\n    const takerOrMaker = this.safeString(trade, 'role');\n    const price = this.safeFloat(trade, 'price');\n    const amount = this.safeFloat2(trade, 'filled-amount', 'amount');\n    let cost = undefined;\n\n    if (price !== undefined) {\n      if (amount !== undefined) {\n        cost = amount * price;\n      }\n    }\n\n    let fee = undefined;\n    let feeCost = this.safeFloat(trade, 'filled-fees');\n    let feeCurrency = undefined;\n\n    if (market !== undefined) {\n      feeCurrency = this.safeCurrencyCode(this.safeString(trade, 'fee-currency'));\n    }\n\n    const filledPoints = this.safeFloat(trade, 'filled-points');\n\n    if (filledPoints !== undefined) {\n      if (feeCost === undefined || feeCost === 0.0) {\n        feeCost = filledPoints;\n        feeCurrency = this.safeCurrencyCode(this.safeString(trade, 'fee-deduct-currency'));\n      }\n    }\n\n    if (feeCost !== undefined) {\n      fee = {\n        'cost': feeCost,\n        'currency': feeCurrency\n      };\n    }\n\n    const tradeId = this.safeString2(trade, 'trade-id', 'tradeId');\n    const id = this.safeString(trade, 'id', tradeId);\n    return {\n      'id': id,\n      'info': trade,\n      'order': order,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'symbol': symbol,\n      'type': type,\n      'side': side,\n      'takerOrMaker': takerOrMaker,\n      'price': price,\n      'amount': amount,\n      'cost': cost,\n      'fee': fee\n    };\n  }\n\n  async fetchMyTrades(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    let market = undefined;\n    const request = {};\n\n    if (symbol !== undefined) {\n      market = this.market(symbol);\n      request['symbol'] = market['id'];\n    }\n\n    if (limit !== undefined) {\n      request['size'] = limit; // 1-100 orders, default is 100\n    }\n\n    if (since !== undefined) {\n      request['start-date'] = this.ymd(since); // a date within 61 days from today\n\n      request['end-date'] = this.ymd(this.sum(since, 86400000));\n    }\n\n    const response = await this.privateGetOrderMatchresults(this.extend(request, params));\n    const trades = this.parseTrades(response['data'], market, since, limit);\n    return trades;\n  }\n\n  async fetchTrades(symbol, since = undefined, limit = 1000, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'symbol': market['id']\n    };\n\n    if (limit !== undefined) {\n      request['size'] = limit;\n    }\n\n    const response = await this.marketGetHistoryTrade(this.extend(request, params)); //\n    //     {\n    //         \"status\": \"ok\",\n    //         \"ch\": \"market.btcusdt.trade.detail\",\n    //         \"ts\": 1583497692365,\n    //         \"data\": [\n    //             {\n    //                 \"id\": 105005170342,\n    //                 \"ts\": 1583497692182,\n    //                 \"data\": [\n    //                     {\n    //                         \"amount\": 0.010411000000000000,\n    //                         \"trade-id\": 102090736910,\n    //                         \"ts\": 1583497692182,\n    //                         \"id\": 10500517034273194594947,\n    //                         \"price\": 9096.050000000000000000,\n    //                         \"direction\": \"sell\"\n    //                     }\n    //                 ]\n    //             },\n    //             // ...\n    //         ]\n    //     }\n    //\n\n    const data = this.safeValue(response, 'data');\n    let result = [];\n\n    for (let i = 0; i < data.length; i++) {\n      const trades = this.safeValue(data[i], 'data', []);\n\n      for (let j = 0; j < trades.length; j++) {\n        const trade = this.parseTrade(trades[j], market);\n        result.push(trade);\n      }\n    }\n\n    result = this.sortBy(result, 'timestamp');\n    return this.filterBySymbolSinceLimit(result, symbol, since, limit);\n  }\n\n  parseOHLCV(ohlcv, market = undefined) {\n    //\n    //     {\n    //         \"amount\":1.2082,\n    //         \"open\":0.025096,\n    //         \"close\":0.025095,\n    //         \"high\":0.025096,\n    //         \"id\":1591515300,\n    //         \"count\":6,\n    //         \"low\":0.025095,\n    //         \"vol\":0.0303205097\n    //     }\n    //\n    return [this.safeTimestamp(ohlcv, 'id'), this.safeFloat(ohlcv, 'open'), this.safeFloat(ohlcv, 'high'), this.safeFloat(ohlcv, 'low'), this.safeFloat(ohlcv, 'close'), this.safeFloat(ohlcv, 'amount')];\n  }\n\n  async fetchOHLCV(symbol, timeframe = '1m', since = undefined, limit = 1000, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'symbol': market['id'],\n      'period': this.timeframes[timeframe]\n    };\n\n    if (limit !== undefined) {\n      request['size'] = limit;\n    }\n\n    const response = await this.marketGetHistoryKline(this.extend(request, params)); //\n    //     {\n    //         \"status\":\"ok\",\n    //         \"ch\":\"market.ethbtc.kline.1min\",\n    //         \"ts\":1591515374371,\n    //         \"data\":[\n    //             {\"amount\":0.0,\"open\":0.025095,\"close\":0.025095,\"high\":0.025095,\"id\":1591515360,\"count\":0,\"low\":0.025095,\"vol\":0.0},\n    //             {\"amount\":1.2082,\"open\":0.025096,\"close\":0.025095,\"high\":0.025096,\"id\":1591515300,\"count\":6,\"low\":0.025095,\"vol\":0.0303205097},\n    //             {\"amount\":0.0648,\"open\":0.025096,\"close\":0.025096,\"high\":0.025096,\"id\":1591515240,\"count\":2,\"low\":0.025096,\"vol\":0.0016262208},\n    //         ]\n    //     }\n    //\n\n    const data = this.safeValue(response, 'data', []);\n    return this.parseOHLCVs(data, market, timeframe, since, limit);\n  }\n\n  async fetchAccounts(params = {}) {\n    await this.loadMarkets();\n    const response = await this.privateGetAccountAccounts(params);\n    return response['data'];\n  }\n\n  async fetchCurrencies(params = {}) {\n    const request = {\n      'language': this.options['language']\n    };\n    const response = await this.publicGetSettingsCurrencys(this.extend(request, params));\n    const currencies = this.safeValue(response, 'data');\n    const result = {};\n\n    for (let i = 0; i < currencies.length; i++) {\n      const currency = currencies[i]; //\n      //  {                     name: \"ctxc\",\n      //              'display-name': \"CTXC\",\n      //        'withdraw-precision':  8,\n      //             'currency-type': \"eth\",\n      //        'currency-partition': \"pro\",\n      //             'support-sites':  null,\n      //                'otc-enable':  0,\n      //        'deposit-min-amount': \"2\",\n      //       'withdraw-min-amount': \"4\",\n      //            'show-precision': \"8\",\n      //                      weight: \"2988\",\n      //                     visible:  true,\n      //              'deposit-desc': \"Please don’t deposit any other digital assets except CTXC t…\",\n      //             'withdraw-desc': \"Minimum withdrawal amount: 4 CTXC. !>_<!For security reason…\",\n      //           'deposit-enabled':  true,\n      //          'withdraw-enabled':  true,\n      //    'currency-addr-with-tag':  false,\n      //             'fast-confirms':  15,\n      //             'safe-confirms':  30                                                             }\n      //\n\n      const id = this.safeValue(currency, 'name');\n      const precision = this.safeInteger(currency, 'withdraw-precision');\n      const code = this.safeCurrencyCode(id);\n      const active = currency['visible'] && currency['deposit-enabled'] && currency['withdraw-enabled'];\n      const name = this.safeString(currency, 'display-name');\n      result[code] = {\n        'id': id,\n        'code': code,\n        'type': 'crypto',\n        // 'payin': currency['deposit-enabled'],\n        // 'payout': currency['withdraw-enabled'],\n        // 'transfer': undefined,\n        'name': name,\n        'active': active,\n        'fee': undefined,\n        // todo need to fetch from fee endpoint\n        'precision': precision,\n        'limits': {\n          'amount': {\n            'min': Math.pow(10, -precision),\n            'max': Math.pow(10, precision)\n          },\n          'price': {\n            'min': Math.pow(10, -precision),\n            'max': Math.pow(10, precision)\n          },\n          'cost': {\n            'min': undefined,\n            'max': undefined\n          },\n          'deposit': {\n            'min': this.safeFloat(currency, 'deposit-min-amount'),\n            'max': Math.pow(10, precision)\n          },\n          'withdraw': {\n            'min': this.safeFloat(currency, 'withdraw-min-amount'),\n            'max': Math.pow(10, precision)\n          }\n        },\n        'info': currency\n      };\n    }\n\n    return result;\n  }\n\n  async fetchBalance(params = {}) {\n    await this.loadMarkets();\n    await this.loadAccounts();\n    const method = this.options['fetchBalanceMethod'];\n    const request = {\n      'id': this.accounts[0]['id']\n    };\n    const response = await this[method](this.extend(request, params));\n    const balances = this.safeValue(response['data'], 'list', []);\n    const result = {\n      'info': response\n    };\n\n    for (let i = 0; i < balances.length; i++) {\n      const balance = balances[i];\n      const currencyId = this.safeString(balance, 'currency');\n      const code = this.safeCurrencyCode(currencyId);\n      let account = undefined;\n\n      if (code in result) {\n        account = result[code];\n      } else {\n        account = this.account();\n      }\n\n      if (balance['type'] === 'trade') {\n        account['free'] = this.safeFloat(balance, 'balance');\n      }\n\n      if (balance['type'] === 'frozen') {\n        account['used'] = this.safeFloat(balance, 'balance');\n      }\n\n      result[code] = account;\n    }\n\n    return this.parseBalance(result);\n  }\n\n  async fetchOrdersByStates(states, symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    const request = {\n      'states': states\n    };\n    let market = undefined;\n\n    if (symbol !== undefined) {\n      market = this.market(symbol);\n      request['symbol'] = market['id'];\n    }\n\n    const method = this.safeString(this.options, 'fetchOrdersByStatesMethod', 'private_get_order_orders');\n    const response = await this[method](this.extend(request, params)); //\n    //     { status:   \"ok\",\n    //         data: [ {                  id:  13997833014,\n    //                                symbol: \"ethbtc\",\n    //                          'account-id':  3398321,\n    //                                amount: \"0.045000000000000000\",\n    //                                 price: \"0.034014000000000000\",\n    //                          'created-at':  1545836976871,\n    //                                  type: \"sell-limit\",\n    //                        'field-amount': \"0.045000000000000000\",\n    //                   'field-cash-amount': \"0.001530630000000000\",\n    //                          'field-fees': \"0.000003061260000000\",\n    //                         'finished-at':  1545837948214,\n    //                                source: \"spot-api\",\n    //                                 state: \"filled\",\n    //                         'canceled-at':  0                      }  ] }\n    //\n\n    return this.parseOrders(response['data'], market, since, limit);\n  }\n\n  async fetchOrder(id, symbol = undefined, params = {}) {\n    await this.loadMarkets();\n    const request = {\n      'id': id\n    };\n    const response = await this.privateGetOrderOrdersId(this.extend(request, params));\n    const order = this.safeValue(response, 'data');\n    return this.parseOrder(order);\n  }\n\n  async fetchOrders(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    return await this.fetchOrdersByStates('pre-submitted,submitted,partial-filled,filled,partial-canceled,canceled', symbol, since, limit, params);\n  }\n\n  async fetchOpenOrders(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    const method = this.safeString(this.options, 'fetchOpenOrdersMethod', 'fetch_open_orders_v1');\n    return await this[method](symbol, since, limit, params);\n  }\n\n  async fetchOpenOrdersV1(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    if (symbol === undefined) {\n      throw new ArgumentsRequired(this.id + ' fetchOpenOrdersV1 requires a symbol argument');\n    }\n\n    return await this.fetchOrdersByStates('pre-submitted,submitted,partial-filled', symbol, since, limit, params);\n  }\n\n  async fetchClosedOrders(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    return await this.fetchOrdersByStates('filled,partial-canceled,canceled', symbol, since, limit, params);\n  }\n\n  async fetchOpenOrdersV2(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n\n    if (symbol === undefined) {\n      throw new ArgumentsRequired(this.id + ' fetchOpenOrders requires a symbol argument');\n    }\n\n    const market = this.market(symbol);\n    let accountId = this.safeString(params, 'account-id');\n\n    if (accountId === undefined) {\n      // pick the first account\n      await this.loadAccounts();\n\n      for (let i = 0; i < this.accounts.length; i++) {\n        const account = this.accounts[i];\n\n        if (account['type'] === 'spot') {\n          accountId = this.safeString(account, 'id');\n\n          if (accountId !== undefined) {\n            break;\n          }\n        }\n      }\n    }\n\n    const request = {\n      'symbol': market['id'],\n      'account-id': accountId\n    };\n\n    if (limit !== undefined) {\n      request['size'] = limit;\n    }\n\n    const omitted = this.omit(params, 'account-id');\n    const response = await this.privateGetOrderOpenOrders(this.extend(request, omitted)); //\n    //     {\n    //         \"status\":\"ok\",\n    //         \"data\":[\n    //             {\n    //                 \"symbol\":\"ethusdt\",\n    //                 \"source\":\"api\",\n    //                 \"amount\":\"0.010000000000000000\",\n    //                 \"account-id\":1528640,\n    //                 \"created-at\":1561597491963,\n    //                 \"price\":\"400.000000000000000000\",\n    //                 \"filled-amount\":\"0.0\",\n    //                 \"filled-cash-amount\":\"0.0\",\n    //                 \"filled-fees\":\"0.0\",\n    //                 \"id\":38477101630,\n    //                 \"state\":\"submitted\",\n    //                 \"type\":\"sell-limit\"\n    //             }\n    //         ]\n    //     }\n    //\n\n    const data = this.safeValue(response, 'data', []);\n    return this.parseOrders(data, market, since, limit);\n  }\n\n  parseOrderStatus(status) {\n    const statuses = {\n      'partial-filled': 'open',\n      'partial-canceled': 'canceled',\n      'filled': 'closed',\n      'canceled': 'canceled',\n      'submitted': 'open'\n    };\n    return this.safeString(statuses, status, status);\n  }\n\n  parseOrder(order, market = undefined) {\n    //\n    //     {                  id:  13997833014,\n    //                    symbol: \"ethbtc\",\n    //              'account-id':  3398321,\n    //                    amount: \"0.045000000000000000\",\n    //                     price: \"0.034014000000000000\",\n    //              'created-at':  1545836976871,\n    //                      type: \"sell-limit\",\n    //            'field-amount': \"0.045000000000000000\", // they have fixed it for filled-amount\n    //       'field-cash-amount': \"0.001530630000000000\", // they have fixed it for filled-cash-amount\n    //              'field-fees': \"0.000003061260000000\", // they have fixed it for filled-fees\n    //             'finished-at':  1545837948214,\n    //                    source: \"spot-api\",\n    //                     state: \"filled\",\n    //             'canceled-at':  0                      }\n    //\n    //     {                  id:  20395337822,\n    //                    symbol: \"ethbtc\",\n    //              'account-id':  5685075,\n    //                    amount: \"0.001000000000000000\",\n    //                     price: \"0.0\",\n    //              'created-at':  1545831584023,\n    //                      type: \"buy-market\",\n    //            'field-amount': \"0.029100000000000000\", // they have fixed it for filled-amount\n    //       'field-cash-amount': \"0.000999788700000000\", // they have fixed it for filled-cash-amount\n    //              'field-fees': \"0.000058200000000000\", // they have fixed it for filled-fees\n    //             'finished-at':  1545831584181,\n    //                    source: \"spot-api\",\n    //                     state: \"filled\",\n    //             'canceled-at':  0                      }\n    //\n    const id = this.safeString(order, 'id');\n    let side = undefined;\n    let type = undefined;\n    let status = undefined;\n\n    if ('type' in order) {\n      const orderType = order['type'].split('-');\n      side = orderType[0];\n      type = orderType[1];\n      status = this.parseOrderStatus(this.safeString(order, 'state'));\n    }\n\n    const marketId = this.safeString(order, 'symbol');\n    const symbol = this.safeSymbol(marketId, market);\n    const timestamp = this.safeInteger(order, 'created-at');\n    let amount = this.safeFloat(order, 'amount');\n    const filled = this.safeFloat2(order, 'filled-amount', 'field-amount'); // typo in their API, filled amount\n\n    if (type === 'market' && side === 'buy') {\n      amount = status === 'closed' ? filled : undefined;\n    }\n\n    let price = this.safeFloat(order, 'price');\n\n    if (price === 0.0) {\n      price = undefined;\n    }\n\n    const cost = this.safeFloat2(order, 'filled-cash-amount', 'field-cash-amount'); // same typo\n\n    let remaining = undefined;\n    let average = undefined;\n\n    if (filled !== undefined) {\n      if (amount !== undefined) {\n        remaining = amount - filled;\n      } // if cost is defined and filled is not zero\n\n\n      if (cost !== undefined && filled > 0) {\n        average = cost / filled;\n      }\n    }\n\n    const feeCost = this.safeFloat2(order, 'filled-fees', 'field-fees'); // typo in their API, filled fees\n\n    let fee = undefined;\n\n    if (feeCost !== undefined) {\n      let feeCurrency = undefined;\n\n      if (market !== undefined) {\n        feeCurrency = side === 'sell' ? market['quote'] : market['base'];\n      }\n\n      fee = {\n        'cost': feeCost,\n        'currency': feeCurrency\n      };\n    }\n\n    return {\n      'info': order,\n      'id': id,\n      'clientOrderId': undefined,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'lastTradeTimestamp': undefined,\n      'symbol': symbol,\n      'type': type,\n      'timeInForce': undefined,\n      'postOnly': undefined,\n      'side': side,\n      'price': price,\n      'stopPrice': undefined,\n      'average': average,\n      'cost': cost,\n      'amount': amount,\n      'filled': filled,\n      'remaining': remaining,\n      'status': status,\n      'fee': fee,\n      'trades': undefined\n    };\n  }\n\n  async createOrder(symbol, type, side, amount, price = undefined, params = {}) {\n    await this.loadMarkets();\n    await this.loadAccounts();\n    const market = this.market(symbol);\n    const request = {\n      'account-id': this.accounts[0]['id'],\n      'symbol': market['id'],\n      'type': side + '-' + type\n    };\n\n    if (type === 'market' && side === 'buy') {\n      if (this.options['createMarketBuyOrderRequiresPrice']) {\n        if (price === undefined) {\n          throw new InvalidOrder(this.id + \" market buy order requires price argument to calculate cost (total amount of quote currency to spend for buying, amount * price). To switch off this warning exception and specify cost in the amount argument, set .options['createMarketBuyOrderRequiresPrice'] = false. Make sure you know what you're doing.\");\n        } else {\n          // despite that cost = amount * price is in quote currency and should have quote precision\n          // the exchange API requires the cost supplied in 'amount' to be of base precision\n          // more about it here:\n          // https://github.com/ccxt/ccxt/pull/4395\n          // https://github.com/ccxt/ccxt/issues/7611\n          // we use amountToPrecision here because the exchange requires cost in base precision\n          request['amount'] = this.costToPrecision(symbol, parseFloat(amount) * parseFloat(price));\n        }\n      } else {\n        request['amount'] = this.costToPrecision(symbol, amount);\n      }\n    } else {\n      request['amount'] = this.amountToPrecision(symbol, amount);\n    }\n\n    if (type === 'limit' || type === 'ioc' || type === 'limit-maker') {\n      request['price'] = this.priceToPrecision(symbol, price);\n    }\n\n    const method = this.options['createOrderMethod'];\n    const response = await this[method](this.extend(request, params));\n    const timestamp = this.milliseconds();\n    const id = this.safeString(response, 'data');\n    return {\n      'info': response,\n      'id': id,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'lastTradeTimestamp': undefined,\n      'status': undefined,\n      'symbol': symbol,\n      'type': type,\n      'side': side,\n      'price': price,\n      'amount': amount,\n      'filled': undefined,\n      'remaining': undefined,\n      'cost': undefined,\n      'trades': undefined,\n      'fee': undefined,\n      'clientOrderId': undefined,\n      'average': undefined\n    };\n  }\n\n  async cancelOrder(id, symbol = undefined, params = {}) {\n    const response = await this.privatePostOrderOrdersIdSubmitcancel({\n      'id': id\n    }); //\n    //     let response = {\n    //         'status': 'ok',\n    //         'data': '10138899000',\n    //     };\n    //\n\n    return this.extend(this.parseOrder(response), {\n      'id': id,\n      'status': 'canceled'\n    });\n  }\n\n  currencyToPrecision(currency, fee) {\n    return this.decimalToPrecision(fee, 0, this.currencies[currency]['precision']);\n  }\n\n  calculateFee(symbol, type, side, amount, price, takerOrMaker = 'taker', params = {}) {\n    const market = this.markets[symbol];\n    const rate = market[takerOrMaker];\n    let cost = amount * rate;\n    let key = 'quote';\n\n    if (side === 'sell') {\n      cost *= price;\n    } else {\n      key = 'base';\n    }\n\n    return {\n      'type': takerOrMaker,\n      'currency': market[key],\n      'rate': rate,\n      'cost': parseFloat(this.currencyToPrecision(market[key], cost))\n    };\n  }\n\n  parseDepositAddress(depositAddress, currency = undefined) {\n    //\n    //     {\n    //         currency: \"eth\",\n    //         address: \"0xf7292eb9ba7bc50358e27f0e025a4d225a64127b\",\n    //         addressTag: \"\",\n    //         chain: \"eth\"\n    //     }\n    //\n    const address = this.safeString(depositAddress, 'address');\n    const tag = this.safeString(depositAddress, 'addressTag');\n    const currencyId = this.safeString(depositAddress, 'currency');\n    const code = this.safeCurrencyCode(currencyId);\n    this.checkAddress(address);\n    return {\n      'currency': code,\n      'address': address,\n      'tag': tag,\n      'info': depositAddress\n    };\n  }\n\n  async fetchDepositAddress(code, params = {}) {\n    await this.loadMarkets();\n    const currency = this.currency(code);\n    const request = {\n      'currency': currency['id']\n    };\n    const response = await this.v2PrivateGetAccountDepositAddress(this.extend(request, params)); //\n    //     {\n    //         code: 200,\n    //         data: [\n    //             {\n    //                 currency: \"eth\",\n    //                 address: \"0xf7292eb9ba7bc50358e27f0e025a4d225a64127b\",\n    //                 addressTag: \"\",\n    //                 chain: \"eth\"\n    //             }\n    //         ]\n    //     }\n    //\n\n    const data = this.safeValue(response, 'data', []);\n    return this.parseDepositAddress(this.safeValue(data, 0, {}), currency);\n  }\n\n  async fetchDeposits(code = undefined, since = undefined, limit = undefined, params = {}) {\n    if (limit === undefined || limit > 100) {\n      limit = 100;\n    }\n\n    await this.loadMarkets();\n    let currency = undefined;\n\n    if (code !== undefined) {\n      currency = this.currency(code);\n    }\n\n    const request = {\n      'type': 'deposit',\n      'from': 0 // From 'id' ... if you want to get results after a particular transaction id, pass the id in params.from\n\n    };\n\n    if (currency !== undefined) {\n      request['currency'] = currency['id'];\n    }\n\n    if (limit !== undefined) {\n      request['size'] = limit; // max 100\n    }\n\n    const response = await this.privateGetQueryDepositWithdraw(this.extend(request, params)); // return response\n\n    return this.parseTransactions(response['data'], currency, since, limit);\n  }\n\n  async fetchWithdrawals(code = undefined, since = undefined, limit = undefined, params = {}) {\n    if (limit === undefined || limit > 100) {\n      limit = 100;\n    }\n\n    await this.loadMarkets();\n    let currency = undefined;\n\n    if (code !== undefined) {\n      currency = this.currency(code);\n    }\n\n    const request = {\n      'type': 'withdraw',\n      'from': 0 // From 'id' ... if you want to get results after a particular transaction id, pass the id in params.from\n\n    };\n\n    if (currency !== undefined) {\n      request['currency'] = currency['id'];\n    }\n\n    if (limit !== undefined) {\n      request['size'] = limit; // max 100\n    }\n\n    const response = await this.privateGetQueryDepositWithdraw(this.extend(request, params)); // return response\n\n    return this.parseTransactions(response['data'], currency, since, limit);\n  }\n\n  parseTransaction(transaction, currency = undefined) {\n    //\n    // fetchDeposits\n    //\n    //     {\n    //         'id': 8211029,\n    //         'type': 'deposit',\n    //         'currency': 'eth',\n    //         'chain': 'eth',\n    //         'tx-hash': 'bd315....',\n    //         'amount': 0.81162421,\n    //         'address': '4b8b....',\n    //         'address-tag': '',\n    //         'fee': 0,\n    //         'state': 'safe',\n    //         'created-at': 1542180380965,\n    //         'updated-at': 1542180788077\n    //     }\n    //\n    // fetchWithdrawals\n    //\n    //     {\n    //         'id': 6908275,\n    //         'type': 'withdraw',\n    //         'currency': 'btc',\n    //         'chain': 'btc',\n    //         'tx-hash': 'c1a1a....',\n    //         'amount': 0.80257005,\n    //         'address': '1QR....',\n    //         'address-tag': '',\n    //         'fee': 0.0005,\n    //         'state': 'confirmed',\n    //         'created-at': 1552107295685,\n    //         'updated-at': 1552108032859\n    //     }\n    //\n    const timestamp = this.safeInteger(transaction, 'created-at');\n    const updated = this.safeInteger(transaction, 'updated-at');\n    const code = this.safeCurrencyCode(this.safeString(transaction, 'currency'));\n    let type = this.safeString(transaction, 'type');\n\n    if (type === 'withdraw') {\n      type = 'withdrawal';\n    }\n\n    const status = this.parseTransactionStatus(this.safeString(transaction, 'state'));\n    const tag = this.safeString(transaction, 'address-tag');\n    let feeCost = this.safeFloat(transaction, 'fee');\n\n    if (feeCost !== undefined) {\n      feeCost = Math.abs(feeCost);\n    }\n\n    return {\n      'info': transaction,\n      'id': this.safeString(transaction, 'id'),\n      'txid': this.safeString(transaction, 'tx-hash'),\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'address': this.safeString(transaction, 'address'),\n      'tag': tag,\n      'type': type,\n      'amount': this.safeFloat(transaction, 'amount'),\n      'currency': code,\n      'status': status,\n      'updated': updated,\n      'fee': {\n        'currency': code,\n        'cost': feeCost,\n        'rate': undefined\n      }\n    };\n  }\n\n  parseTransactionStatus(status) {\n    const statuses = {\n      // deposit statuses\n      'unknown': 'failed',\n      'confirming': 'pending',\n      'confirmed': 'ok',\n      'safe': 'ok',\n      'orphan': 'failed',\n      // withdrawal statuses\n      'submitted': 'pending',\n      'canceled': 'canceled',\n      'reexamine': 'pending',\n      'reject': 'failed',\n      'pass': 'pending',\n      'wallet-reject': 'failed',\n      // 'confirmed': 'ok', // present in deposit statuses\n      'confirm-error': 'failed',\n      'repealed': 'failed',\n      'wallet-transfer': 'pending',\n      'pre-transfer': 'pending'\n    };\n    return this.safeString(statuses, status, status);\n  }\n\n  async withdraw(code, amount, address, tag = undefined, params = {}) {\n    await this.loadMarkets();\n    this.checkAddress(address);\n    const currency = this.currency(code);\n    const request = {\n      'address': address,\n      // only supports existing addresses in your withdraw address list\n      'amount': amount,\n      'currency': currency['id'].toLowerCase()\n    };\n\n    if (tag !== undefined) {\n      request['addr-tag'] = tag; // only for XRP?\n    }\n\n    const response = await this.privatePostDwWithdrawApiCreate(this.extend(request, params));\n    const id = this.safeString(response, 'data');\n    return {\n      'info': response,\n      'id': id\n    };\n  }\n\n  sign(path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n    let url = '/';\n\n    if (api === 'market') {\n      url += api;\n    } else if (api === 'public' || api === 'private') {\n      url += this.version;\n    } else if (api === 'v2Public' || api === 'v2Private') {\n      url += 'v2';\n    }\n\n    url += '/' + this.implodeParams(path, params);\n    const query = this.omit(params, this.extractParams(path));\n\n    if (api === 'private' || api === 'v2Private') {\n      this.checkRequiredCredentials();\n      const timestamp = this.ymdhms(this.milliseconds(), 'T');\n      let request = {\n        'SignatureMethod': 'HmacSHA256',\n        'SignatureVersion': '2',\n        'AccessKeyId': this.apiKey,\n        'Timestamp': timestamp\n      };\n\n      if (method !== 'POST') {\n        request = this.extend(request, query);\n      }\n\n      request = this.keysort(request);\n      let auth = this.urlencode(request); // unfortunately, PHP demands double quotes for the escaped newline symbol\n      // eslint-disable-next-line quotes\n\n      const payload = [method, this.hostname, url, auth].join(\"\\n\");\n      const signature = this.hmac(this.encode(payload), this.encode(this.secret), 'sha256', 'base64');\n      auth += '&' + this.urlencode({\n        'Signature': signature\n      });\n      url += '?' + auth;\n\n      if (method === 'POST') {\n        body = this.json(query);\n        headers = {\n          'Content-Type': 'application/json'\n        };\n      } else {\n        headers = {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        };\n      }\n    } else {\n      if (Object.keys(params).length) {\n        url += '?' + this.urlencode(params);\n      }\n    }\n\n    url = this.implodeParams(this.urls['api'][api], {\n      'hostname': this.hostname\n    }) + url;\n    return {\n      'url': url,\n      'method': method,\n      'body': body,\n      'headers': headers\n    };\n  }\n\n  handleErrors(httpCode, reason, url, method, headers, body, response, requestHeaders, requestBody) {\n    if (response === undefined) {\n      return; // fallback to default error handler\n    }\n\n    if ('status' in response) {\n      //\n      //     {\"status\":\"error\",\"err-code\":\"order-limitorder-amount-min-error\",\"err-msg\":\"limit order amount error, min: `0.001`\",\"data\":null}\n      //\n      const status = this.safeString(response, 'status');\n\n      if (status === 'error') {\n        const code = this.safeString(response, 'err-code');\n        const feedback = this.id + ' ' + body;\n        this.throwExactlyMatchedException(this.exceptions['exact'], code, feedback);\n        const message = this.safeString(response, 'err-msg');\n        this.throwExactlyMatchedException(this.exceptions['exact'], message, feedback);\n        throw new ExchangeError(feedback);\n      }\n    }\n  }\n\n};","map":{"version":3,"sources":["C:/Users/senya/Documents/Coding/React Projects/react-stock-ticker/node_modules/ccxt/js/huobipro.js"],"names":["Exchange","require","AuthenticationError","ExchangeError","PermissionDenied","ExchangeNotAvailable","OnMaintenance","InvalidOrder","OrderNotFound","InsufficientFunds","ArgumentsRequired","BadSymbol","BadRequest","RequestTimeout","NetworkError","TRUNCATE","module","exports","huobipro","describe","deepExtend","userAgents","undefined","fetchTradingLimits","symbols","params","loadMarkets","result","i","length","symbol","fetchTradingLimitsById","marketId","id","request","response","publicGetCommonExchange","extend","parseTradingLimits","safeValue","limits","safeFloat","costToPrecision","cost","decimalToPrecision","markets","precisionMode","fetchMarkets","method","options","numMarkets","json","market","baseId","safeString","quoteId","base","safeCurrencyCode","quote","precision","safeInteger","maker","taker","minAmount","Math","pow","maxAmount","minCost","state","active","push","parseTicker","ticker","timestamp","bid","bidVolume","ask","askVolume","Array","isArray","open","close","change","percentage","average","sum","baseVolume","quoteVolume","vwap","iso8601","fetchOrderBook","limit","marketGetDepth","tick","parseOrderBook","fetchTicker","marketGetDetailMerged","fetchTickers","marketGetTickers","tickers","safeMarket","filterByArray","parseTrade","trade","safeSymbol","safeInteger2","order","side","type","typeParts","split","takerOrMaker","price","amount","safeFloat2","fee","feeCost","feeCurrency","filledPoints","tradeId","safeString2","fetchMyTrades","since","ymd","privateGetOrderMatchresults","trades","parseTrades","fetchTrades","marketGetHistoryTrade","data","j","sortBy","filterBySymbolSinceLimit","parseOHLCV","ohlcv","safeTimestamp","fetchOHLCV","timeframe","timeframes","marketGetHistoryKline","parseOHLCVs","fetchAccounts","privateGetAccountAccounts","fetchCurrencies","publicGetSettingsCurrencys","currencies","currency","code","name","fetchBalance","loadAccounts","accounts","balances","balance","currencyId","account","parseBalance","fetchOrdersByStates","states","parseOrders","fetchOrder","privateGetOrderOrdersId","parseOrder","fetchOrders","fetchOpenOrders","fetchOpenOrdersV1","fetchClosedOrders","fetchOpenOrdersV2","accountId","omitted","omit","privateGetOrderOpenOrders","parseOrderStatus","status","statuses","orderType","filled","remaining","createOrder","parseFloat","amountToPrecision","priceToPrecision","milliseconds","cancelOrder","privatePostOrderOrdersIdSubmitcancel","currencyToPrecision","calculateFee","rate","key","parseDepositAddress","depositAddress","address","tag","checkAddress","fetchDepositAddress","v2PrivateGetAccountDepositAddress","fetchDeposits","privateGetQueryDepositWithdraw","parseTransactions","fetchWithdrawals","parseTransaction","transaction","updated","parseTransactionStatus","abs","withdraw","toLowerCase","privatePostDwWithdrawApiCreate","sign","path","api","headers","body","url","version","implodeParams","query","extractParams","checkRequiredCredentials","ymdhms","apiKey","keysort","auth","urlencode","payload","hostname","join","signature","hmac","encode","secret","Object","keys","urls","handleErrors","httpCode","reason","requestHeaders","requestBody","feedback","throwExactlyMatchedException","exceptions","message"],"mappings":"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","sourcesContent":["'use strict';\n\n//  ---------------------------------------------------------------------------\n\nconst Exchange = require ('./base/Exchange');\nconst { AuthenticationError, ExchangeError, PermissionDenied, ExchangeNotAvailable, OnMaintenance, InvalidOrder, OrderNotFound, InsufficientFunds, ArgumentsRequired, BadSymbol, BadRequest, RequestTimeout, NetworkError } = require ('./base/errors');\nconst { TRUNCATE } = require ('./base/functions/number');\n\n//  ---------------------------------------------------------------------------\n\nmodule.exports = class huobipro extends Exchange {\n    describe () {\n        return this.deepExtend (super.describe (), {\n            'id': 'huobipro',\n            'name': 'Huobi Pro',\n            'countries': [ 'CN' ],\n            'rateLimit': 2000,\n            'userAgent': this.userAgents['chrome39'],\n            'version': 'v1',\n            'accounts': undefined,\n            'accountsById': undefined,\n            'hostname': 'api.huobi.pro', // api.testnet.huobi.pro\n            'pro': true,\n            'has': {\n                'cancelOrder': true,\n                'CORS': false,\n                'createOrder': true,\n                'fetchBalance': true,\n                'fetchClosedOrders': true,\n                'fetchCurrencies': true,\n                'fetchDepositAddress': true,\n                'fetchDeposits': true,\n                'fetchMarkets': true,\n                'fetchMyTrades': true,\n                'fetchOHLCV': true,\n                'fetchOpenOrders': true,\n                'fetchOrder': true,\n                'fetchOrderBook': true,\n                'fetchOrders': true,\n                'fetchTicker': true,\n                'fetchTickers': true,\n                'fetchTrades': true,\n                'fetchTradingLimits': true,\n                'fetchWithdrawals': true,\n                'withdraw': true,\n            },\n            'timeframes': {\n                '1m': '1min',\n                '5m': '5min',\n                '15m': '15min',\n                '30m': '30min',\n                '1h': '60min',\n                '4h': '4hour',\n                '1d': '1day',\n                '1w': '1week',\n                '1M': '1mon',\n                '1y': '1year',\n            },\n            'urls': {\n                'test': {\n                    'market': 'https://api.testnet.huobi.pro',\n                    'public': 'https://api.testnet.huobi.pro',\n                    'private': 'https://api.testnet.huobi.pro',\n                },\n                'logo': 'https://user-images.githubusercontent.com/1294454/76137448-22748a80-604e-11ea-8069-6e389271911d.jpg',\n                'api': {\n                    'market': 'https://{hostname}',\n                    'public': 'https://{hostname}',\n                    'private': 'https://{hostname}',\n                    'v2Public': 'https://{hostname}',\n                    'v2Private': 'https://{hostname}',\n                },\n                'www': 'https://www.huobi.com',\n                'referral': 'https://www.huobi.com/en-us/topic/invited/?invite_code=rwrd3',\n                'doc': 'https://huobiapi.github.io/docs/spot/v1/cn/',\n                'fees': 'https://www.huobi.com/about/fee/',\n            },\n            'api': {\n                'v2Public': {\n                    'get': [\n                        'reference/currencies',\n                    ],\n                },\n                'v2Private': {\n                    'get': [\n                        'account/ledger',\n                        'account/withdraw/quota',\n                        'account/withdraw/address', // 提币地址查询(限母用户可用)\n                        'account/deposit/address',\n                        'reference/transact-fee-rate',\n                        'account/asset-valuation', // 获取账户资产估值\n                        'point/account', // 点卡余额查询\n                        'sub-user/user-list', // 获取子用户列表\n                        'sub-user/user-state', // 获取特定子用户的用户状态\n                        'sub-user/account-list', // 获取特定子用户的账户列表\n                        'sub-user/deposit-address', // 子用户充币地址查询\n                        'sub-user/query-deposit', // 子用户充币记录查询\n                        'user/api-key', // 母子用户API key信息查询\n                    ],\n                    'post': [\n                        'account/transfer',\n                        'point/transfer', // 点卡划转\n                        'sub-user/management', // 冻结/解冻子用户\n                        'sub-user/creation', // 子用户创建\n                        'sub-user/tradable-market', // 设置子用户交易权限\n                        'sub-user/transferability', // 设置子用户资产转出权限\n                        'sub-user/api-key-generation', // 子用户API key创建\n                        'sub-user/api-key-modification', // 修改子用户API key\n                        'sub-user/api-key-deletion', // 删除子用户API key\n                    ],\n                },\n                'market': {\n                    'get': [\n                        'history/kline', // 获取K线数据\n                        'detail/merged', // 获取聚合行情(Ticker)\n                        'depth', // 获取 Market Depth 数据\n                        'trade', // 获取 Trade Detail 数据\n                        'history/trade', // 批量获取最近的交易记录\n                        'detail', // 获取 Market Detail 24小时成交量数据\n                        'tickers',\n                    ],\n                },\n                'public': {\n                    'get': [\n                        'common/symbols', // 查询系统支持的所有交易对\n                        'common/currencys', // 查询系统支持的所有币种\n                        'common/timestamp', // 查询系统当前时间\n                        'common/exchange', // order limits\n                        'settings/currencys', // ?language=en-US\n                    ],\n                },\n                'private': {\n                    'get': [\n                        'account/accounts', // 查询当前用户的所有账户(即account-id)\n                        'account/accounts/{id}/balance', // 查询指定账户的余额\n                        'account/accounts/{sub-uid}',\n                        'account/history',\n                        'cross-margin/loan-info',\n                        'margin/loan-info', // 查询借币币息率及额度\n                        'fee/fee-rate/get',\n                        'order/openOrders',\n                        'order/orders',\n                        'order/orders/{id}', // 查询某个订单详情\n                        'order/orders/{id}/matchresults', // 查询某个订单的成交明细\n                        'order/orders/getClientOrder',\n                        'order/history', // 查询当前委托、历史委托\n                        'order/matchresults', // 查询当前成交、历史成交\n                        'dw/withdraw-virtual/addresses', // 查询虚拟币提现地址（Deprecated）\n                        'query/deposit-withdraw',\n                        'margin/loan-info',\n                        'margin/loan-orders', // 借贷订单\n                        'margin/accounts/balance', // 借贷账户详情\n                        'cross-margin/loan-orders', // 查询借币订单\n                        'cross-margin/accounts/balance', // 借币账户详情\n                        'points/actions',\n                        'points/orders',\n                        'subuser/aggregate-balance',\n                        'stable-coin/exchange_rate',\n                        'stable-coin/quote',\n                    ],\n                    'post': [\n                        'account/transfer', // 资产划转(该节点为母用户和子用户进行资产划转的通用接口。)\n                        'futures/transfer',\n                        'order/batch-orders',\n                        'order/orders/place', // 创建并执行一个新订单 (一步下单， 推荐使用)\n                        'order/orders/submitCancelClientOrder',\n                        'order/orders/batchCancelOpenOrders',\n                        'order/orders', // 创建一个新的订单请求 （仅创建订单，不执行下单）\n                        'order/orders/{id}/place', // 执行一个订单 （仅执行已创建的订单）\n                        'order/orders/{id}/submitcancel', // 申请撤销一个订单请求\n                        'order/orders/batchcancel', // 批量撤销订单\n                        'dw/balance/transfer', // 资产划转\n                        'dw/withdraw/api/create', // 申请提现虚拟币\n                        'dw/withdraw-virtual/create', // 申请提现虚拟币\n                        'dw/withdraw-virtual/{id}/place', // 确认申请虚拟币提现（Deprecated）\n                        'dw/withdraw-virtual/{id}/cancel', // 申请取消提现虚拟币\n                        'dw/transfer-in/margin', // 现货账户划入至借贷账户\n                        'dw/transfer-out/margin', // 借贷账户划出至现货账户\n                        'margin/orders', // 申请借贷\n                        'margin/orders/{id}/repay', // 归还借贷\n                        'cross-margin/transfer-in', // 资产划转\n                        'cross-margin/transfer-out', // 资产划转\n                        'cross-margin/orders', // 申请借币\n                        'cross-margin/orders/{id}/repay', // 归还借币\n                        'stable-coin/exchange',\n                        'subuser/transfer',\n                    ],\n                },\n            },\n            'fees': {\n                'trading': {\n                    'tierBased': false,\n                    'percentage': true,\n                    'maker': 0.002,\n                    'taker': 0.002,\n                },\n            },\n            'exceptions': {\n                'exact': {\n                    // err-code\n                    'bad-request': BadRequest,\n                    'base-date-limit-error': BadRequest, // {\"status\":\"error\",\"err-code\":\"base-date-limit-error\",\"err-msg\":\"date less than system limit\",\"data\":null}\n                    'api-not-support-temp-addr': PermissionDenied, // {\"status\":\"error\",\"err-code\":\"api-not-support-temp-addr\",\"err-msg\":\"API withdrawal does not support temporary addresses\",\"data\":null}\n                    'timeout': RequestTimeout, // {\"ts\":1571653730865,\"status\":\"error\",\"err-code\":\"timeout\",\"err-msg\":\"Request Timeout\"}\n                    'gateway-internal-error': ExchangeNotAvailable, // {\"status\":\"error\",\"err-code\":\"gateway-internal-error\",\"err-msg\":\"Failed to load data. Try again later.\",\"data\":null}\n                    'account-frozen-balance-insufficient-error': InsufficientFunds, // {\"status\":\"error\",\"err-code\":\"account-frozen-balance-insufficient-error\",\"err-msg\":\"trade account balance is not enough, left: `0.0027`\",\"data\":null}\n                    'invalid-amount': InvalidOrder, // eg \"Paramemter `amount` is invalid.\"\n                    'order-limitorder-amount-min-error': InvalidOrder, // limit order amount error, min: `0.001`\n                    'order-limitorder-amount-max-error': InvalidOrder, // market order amount error, max: `1000000`\n                    'order-marketorder-amount-min-error': InvalidOrder, // market order amount error, min: `0.01`\n                    'order-limitorder-price-min-error': InvalidOrder, // limit order price error\n                    'order-limitorder-price-max-error': InvalidOrder, // limit order price error\n                    'order-holding-limit-failed': InvalidOrder, // {\"status\":\"error\",\"err-code\":\"order-holding-limit-failed\",\"err-msg\":\"Order failed, exceeded the holding limit of this currency\",\"data\":null}\n                    'order-orderprice-precision-error': InvalidOrder, // {\"status\":\"error\",\"err-code\":\"order-orderprice-precision-error\",\"err-msg\":\"order price precision error, scale: `4`\",\"data\":null}\n                    'order-orderstate-error': OrderNotFound, // canceling an already canceled order\n                    'order-queryorder-invalid': OrderNotFound, // querying a non-existent order\n                    'order-update-error': ExchangeNotAvailable, // undocumented error\n                    'api-signature-check-failed': AuthenticationError,\n                    'api-signature-not-valid': AuthenticationError, // {\"status\":\"error\",\"err-code\":\"api-signature-not-valid\",\"err-msg\":\"Signature not valid: Incorrect Access key [Access key错误]\",\"data\":null}\n                    'base-record-invalid': OrderNotFound, // https://github.com/ccxt/ccxt/issues/5750\n                    'base-symbol-trade-disabled': BadSymbol, // {\"status\":\"error\",\"err-code\":\"base-symbol-trade-disabled\",\"err-msg\":\"Trading is disabled for this symbol\",\"data\":null}\n                    'base-symbol-error': BadSymbol, // {\"status\":\"error\",\"err-code\":\"base-symbol-error\",\"err-msg\":\"The symbol is invalid\",\"data\":null}\n                    'system-maintenance': OnMaintenance, // {\"status\": \"error\", \"err-code\": \"system-maintenance\", \"err-msg\": \"System is in maintenance!\", \"data\": null}\n                    // err-msg\n                    'invalid symbol': BadSymbol, // {\"ts\":1568813334794,\"status\":\"error\",\"err-code\":\"invalid-parameter\",\"err-msg\":\"invalid symbol\"}\n                    'symbol trade not open now': BadSymbol, // {\"ts\":1576210479343,\"status\":\"error\",\"err-code\":\"invalid-parameter\",\"err-msg\":\"symbol trade not open now\"}\n                },\n            },\n            'options': {\n                // https://github.com/ccxt/ccxt/issues/5376\n                'fetchOrdersByStatesMethod': 'private_get_order_orders', // 'private_get_order_history' // https://github.com/ccxt/ccxt/pull/5392\n                'fetchOpenOrdersMethod': 'fetch_open_orders_v1', // 'fetch_open_orders_v2' // https://github.com/ccxt/ccxt/issues/5388\n                'createMarketBuyOrderRequiresPrice': true,\n                'fetchMarketsMethod': 'publicGetCommonSymbols',\n                'fetchBalanceMethod': 'privateGetAccountAccountsIdBalance',\n                'createOrderMethod': 'privatePostOrderOrdersPlace',\n                'language': 'en-US',\n            },\n            'commonCurrencies': {\n                // https://github.com/ccxt/ccxt/issues/6081\n                // https://github.com/ccxt/ccxt/issues/3365\n                // https://github.com/ccxt/ccxt/issues/2873\n                'GET': 'Themis', // conflict with GET (Guaranteed Entrance Token, GET Protocol)\n                'HOT': 'Hydro Protocol', // conflict with HOT (Holo) https://github.com/ccxt/ccxt/issues/4929\n                // https://github.com/ccxt/ccxt/issues/7399\n                // https://coinmarketcap.com/currencies/pnetwork/\n                // https://coinmarketcap.com/currencies/penta/markets/\n                // https://en.cryptonomist.ch/blog/eidoo/the-edo-to-pnt-upgrade-what-you-need-to-know-updated/\n                'PNT': 'Penta',\n                'SBTC': 'Super Bitcoin',\n            },\n        });\n    }\n\n    async fetchTradingLimits (symbols = undefined, params = {}) {\n        // this method should not be called directly, use loadTradingLimits () instead\n        //  by default it will try load withdrawal fees of all currencies (with separate requests)\n        //  however if you define symbols = [ 'ETH/BTC', 'LTC/BTC' ] in args it will only load those\n        await this.loadMarkets ();\n        if (symbols === undefined) {\n            symbols = this.symbols;\n        }\n        const result = {};\n        for (let i = 0; i < symbols.length; i++) {\n            const symbol = symbols[i];\n            result[symbol] = await this.fetchTradingLimitsById (this.marketId (symbol), params);\n        }\n        return result;\n    }\n\n    async fetchTradingLimitsById (id, params = {}) {\n        const request = {\n            'symbol': id,\n        };\n        const response = await this.publicGetCommonExchange (this.extend (request, params));\n        //\n        //     { status:   \"ok\",\n        //         data: {                                  symbol: \"aidocbtc\",\n        //                              'buy-limit-must-less-than':  1.1,\n        //                          'sell-limit-must-greater-than':  0.9,\n        //                         'limit-order-must-greater-than':  1,\n        //                            'limit-order-must-less-than':  5000000,\n        //                    'market-buy-order-must-greater-than':  0.0001,\n        //                       'market-buy-order-must-less-than':  100,\n        //                   'market-sell-order-must-greater-than':  1,\n        //                      'market-sell-order-must-less-than':  500000,\n        //                       'circuit-break-when-greater-than':  10000,\n        //                          'circuit-break-when-less-than':  10,\n        //                 'market-sell-order-rate-must-less-than':  0.1,\n        //                  'market-buy-order-rate-must-less-than':  0.1        } }\n        //\n        return this.parseTradingLimits (this.safeValue (response, 'data', {}));\n    }\n\n    parseTradingLimits (limits, symbol = undefined, params = {}) {\n        //\n        //   {                                  symbol: \"aidocbtc\",\n        //                  'buy-limit-must-less-than':  1.1,\n        //              'sell-limit-must-greater-than':  0.9,\n        //             'limit-order-must-greater-than':  1,\n        //                'limit-order-must-less-than':  5000000,\n        //        'market-buy-order-must-greater-than':  0.0001,\n        //           'market-buy-order-must-less-than':  100,\n        //       'market-sell-order-must-greater-than':  1,\n        //          'market-sell-order-must-less-than':  500000,\n        //           'circuit-break-when-greater-than':  10000,\n        //              'circuit-break-when-less-than':  10,\n        //     'market-sell-order-rate-must-less-than':  0.1,\n        //      'market-buy-order-rate-must-less-than':  0.1        }\n        //\n        return {\n            'info': limits,\n            'limits': {\n                'amount': {\n                    'min': this.safeFloat (limits, 'limit-order-must-greater-than'),\n                    'max': this.safeFloat (limits, 'limit-order-must-less-than'),\n                },\n            },\n        };\n    }\n\n    costToPrecision (symbol, cost) {\n        return this.decimalToPrecision (cost, TRUNCATE, this.markets[symbol]['precision']['cost'], this.precisionMode);\n    }\n\n    async fetchMarkets (params = {}) {\n        const method = this.options['fetchMarketsMethod'];\n        const response = await this[method] (params);\n        const markets = this.safeValue (response, 'data');\n        const numMarkets = markets.length;\n        if (numMarkets < 1) {\n            throw new NetworkError (this.id + ' publicGetCommonSymbols returned empty response: ' + this.json (markets));\n        }\n        const result = [];\n        for (let i = 0; i < markets.length; i++) {\n            const market = markets[i];\n            const baseId = this.safeString (market, 'base-currency');\n            const quoteId = this.safeString (market, 'quote-currency');\n            const id = baseId + quoteId;\n            const base = this.safeCurrencyCode (baseId);\n            const quote = this.safeCurrencyCode (quoteId);\n            const symbol = base + '/' + quote;\n            const precision = {\n                'amount': this.safeInteger (market, 'amount-precision'),\n                'price': this.safeInteger (market, 'price-precision'),\n                'cost': this.safeInteger (market, 'value-precision'),\n            };\n            const maker = (base === 'OMG') ? 0 : 0.2 / 100;\n            const taker = (base === 'OMG') ? 0 : 0.2 / 100;\n            const minAmount = this.safeFloat (market, 'min-order-amt', Math.pow (10, -precision['amount']));\n            const maxAmount = this.safeFloat (market, 'max-order-amt');\n            const minCost = this.safeFloat (market, 'min-order-value', 0);\n            const state = this.safeString (market, 'state');\n            const active = (state === 'online');\n            result.push ({\n                'id': id,\n                'symbol': symbol,\n                'base': base,\n                'quote': quote,\n                'baseId': baseId,\n                'quoteId': quoteId,\n                'active': active,\n                'precision': precision,\n                'taker': taker,\n                'maker': maker,\n                'limits': {\n                    'amount': {\n                        'min': minAmount,\n                        'max': maxAmount,\n                    },\n                    'price': {\n                        'min': Math.pow (10, -precision['price']),\n                        'max': undefined,\n                    },\n                    'cost': {\n                        'min': minCost,\n                        'max': undefined,\n                    },\n                },\n                'info': market,\n            });\n        }\n        return result;\n    }\n\n    parseTicker (ticker, market = undefined) {\n        //\n        // fetchTicker\n        //\n        //     {\n        //         \"amount\": 26228.672978342216,\n        //         \"open\": 9078.95,\n        //         \"close\": 9146.86,\n        //         \"high\": 9155.41,\n        //         \"id\": 209988544334,\n        //         \"count\": 265846,\n        //         \"low\": 8988.0,\n        //         \"version\": 209988544334,\n        //         \"ask\": [ 9146.87, 0.156134 ],\n        //         \"vol\": 2.3822168242201668E8,\n        //         \"bid\": [ 9146.86, 0.080758 ],\n        //     }\n        //\n        // fetchTickers\n        //     {\n        //         symbol: \"bhdht\",\n        //         open:  2.3938,\n        //         high:  2.4151,\n        //         low:  2.3323,\n        //         close:  2.3909,\n        //         amount:  628.992,\n        //         vol:  1493.71841095,\n        //         count:  2088,\n        //         bid:  2.3643,\n        //         bidSize:  0.7136,\n        //         ask:  2.4061,\n        //         askSize:  0.4156\n        //     }\n        //\n        let symbol = undefined;\n        if (market !== undefined) {\n            symbol = market['symbol'];\n        }\n        const timestamp = this.safeInteger (ticker, 'ts');\n        let bid = undefined;\n        let bidVolume = undefined;\n        let ask = undefined;\n        let askVolume = undefined;\n        if ('bid' in ticker) {\n            if (Array.isArray (ticker['bid'])) {\n                bid = this.safeFloat (ticker['bid'], 0);\n                bidVolume = this.safeFloat (ticker['bid'], 1);\n            } else {\n                bid = this.safeFloat (ticker, 'bid');\n                bidVolume = this.safeValue (ticker, 'bidSize');\n            }\n        }\n        if ('ask' in ticker) {\n            if (Array.isArray (ticker['ask'])) {\n                ask = this.safeFloat (ticker['ask'], 0);\n                askVolume = this.safeFloat (ticker['ask'], 1);\n            } else {\n                ask = this.safeFloat (ticker, 'ask');\n                askVolume = this.safeValue (ticker, 'askSize');\n            }\n        }\n        const open = this.safeFloat (ticker, 'open');\n        const close = this.safeFloat (ticker, 'close');\n        let change = undefined;\n        let percentage = undefined;\n        let average = undefined;\n        if ((open !== undefined) && (close !== undefined)) {\n            change = close - open;\n            average = this.sum (open, close) / 2;\n            if ((close !== undefined) && (close > 0)) {\n                percentage = (change / open) * 100;\n            }\n        }\n        const baseVolume = this.safeFloat (ticker, 'amount');\n        const quoteVolume = this.safeFloat (ticker, 'vol');\n        const vwap = this.vwap (baseVolume, quoteVolume);\n        return {\n            'symbol': symbol,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'high': this.safeFloat (ticker, 'high'),\n            'low': this.safeFloat (ticker, 'low'),\n            'bid': bid,\n            'bidVolume': bidVolume,\n            'ask': ask,\n            'askVolume': askVolume,\n            'vwap': vwap,\n            'open': open,\n            'close': close,\n            'last': close,\n            'previousClose': undefined,\n            'change': change,\n            'percentage': percentage,\n            'average': average,\n            'baseVolume': baseVolume,\n            'quoteVolume': quoteVolume,\n            'info': ticker,\n        };\n    }\n\n    async fetchOrderBook (symbol, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'symbol': market['id'],\n            'type': 'step0',\n        };\n        const response = await this.marketGetDepth (this.extend (request, params));\n        //\n        //     {\n        //         \"status\": \"ok\",\n        //         \"ch\": \"market.btcusdt.depth.step0\",\n        //         \"ts\": 1583474832790,\n        //         \"tick\": {\n        //             \"bids\": [\n        //                 [ 9100.290000000000000000, 0.200000000000000000 ],\n        //                 [ 9099.820000000000000000, 0.200000000000000000 ],\n        //                 [ 9099.610000000000000000, 0.205000000000000000 ],\n        //             ],\n        //             \"asks\": [\n        //                 [ 9100.640000000000000000, 0.005904000000000000 ],\n        //                 [ 9101.010000000000000000, 0.287311000000000000 ],\n        //                 [ 9101.030000000000000000, 0.012121000000000000 ],\n        //             ],\n        //             \"ts\":1583474832008,\n        //             \"version\":104999698780\n        //         }\n        //     }\n        //\n        if ('tick' in response) {\n            if (!response['tick']) {\n                throw new BadSymbol (this.id + ' fetchOrderBook() returned empty response: ' + this.json (response));\n            }\n            const tick = this.safeValue (response, 'tick');\n            const timestamp = this.safeInteger (tick, 'ts', this.safeInteger (response, 'ts'));\n            const result = this.parseOrderBook (tick, timestamp);\n            result['nonce'] = this.safeInteger (tick, 'version');\n            return result;\n        }\n        throw new ExchangeError (this.id + ' fetchOrderBook() returned unrecognized response: ' + this.json (response));\n    }\n\n    async fetchTicker (symbol, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'symbol': market['id'],\n        };\n        const response = await this.marketGetDetailMerged (this.extend (request, params));\n        //\n        //     {\n        //         \"status\": \"ok\",\n        //         \"ch\": \"market.btcusdt.detail.merged\",\n        //         \"ts\": 1583494336669,\n        //         \"tick\": {\n        //             \"amount\": 26228.672978342216,\n        //             \"open\": 9078.95,\n        //             \"close\": 9146.86,\n        //             \"high\": 9155.41,\n        //             \"id\": 209988544334,\n        //             \"count\": 265846,\n        //             \"low\": 8988.0,\n        //             \"version\": 209988544334,\n        //             \"ask\": [ 9146.87, 0.156134 ],\n        //             \"vol\": 2.3822168242201668E8,\n        //             \"bid\": [ 9146.86, 0.080758 ],\n        //         }\n        //     }\n        //\n        const ticker = this.parseTicker (response['tick'], market);\n        const timestamp = this.safeValue (response, 'ts');\n        ticker['timestamp'] = timestamp;\n        ticker['datetime'] = this.iso8601 (timestamp);\n        return ticker;\n    }\n\n    async fetchTickers (symbols = undefined, params = {}) {\n        await this.loadMarkets ();\n        const response = await this.marketGetTickers (params);\n        const tickers = this.safeValue (response, 'data');\n        const timestamp = this.safeInteger (response, 'ts');\n        const result = {};\n        for (let i = 0; i < tickers.length; i++) {\n            const marketId = this.safeString (tickers[i], 'symbol');\n            const market = this.safeMarket (marketId);\n            const symbol = market['symbol'];\n            const ticker = this.parseTicker (tickers[i], market);\n            ticker['timestamp'] = timestamp;\n            ticker['datetime'] = this.iso8601 (timestamp);\n            result[symbol] = ticker;\n        }\n        return this.filterByArray (result, 'symbol', symbols);\n    }\n\n    parseTrade (trade, market = undefined) {\n        //\n        // fetchTrades (public)\n        //\n        //     {\n        //         \"amount\": 0.010411000000000000,\n        //         \"trade-id\": 102090736910,\n        //         \"ts\": 1583497692182,\n        //         \"id\": 10500517034273194594947,\n        //         \"price\": 9096.050000000000000000,\n        //         \"direction\": \"sell\"\n        //     }\n        //\n        // fetchMyTrades (private)\n        //\n        //     {\n        //          'symbol': 'swftcbtc',\n        //          'fee-currency': 'swftc',\n        //          'filled-fees': '0',\n        //          'source': 'spot-api',\n        //          'id': 83789509854000,\n        //          'type': 'buy-limit',\n        //          'order-id': 83711103204909,\n        //          'filled-points': '0.005826843283532154',\n        //          'fee-deduct-currency': 'ht',\n        //          'filled-amount': '45941.53',\n        //          'price': '0.0000001401',\n        //          'created-at': 1597933260729,\n        //          'match-id': 100087455560,\n        //          'role': 'maker',\n        //          'trade-id': 100050305348\n        //     },\n        //\n        const marketId = this.safeString (trade, 'symbol');\n        const symbol = this.safeSymbol (marketId, market);\n        const timestamp = this.safeInteger2 (trade, 'ts', 'created-at');\n        const order = this.safeString (trade, 'order-id');\n        let side = this.safeString (trade, 'direction');\n        let type = this.safeString (trade, 'type');\n        if (type !== undefined) {\n            const typeParts = type.split ('-');\n            side = typeParts[0];\n            type = typeParts[1];\n        }\n        const takerOrMaker = this.safeString (trade, 'role');\n        const price = this.safeFloat (trade, 'price');\n        const amount = this.safeFloat2 (trade, 'filled-amount', 'amount');\n        let cost = undefined;\n        if (price !== undefined) {\n            if (amount !== undefined) {\n                cost = amount * price;\n            }\n        }\n        let fee = undefined;\n        let feeCost = this.safeFloat (trade, 'filled-fees');\n        let feeCurrency = undefined;\n        if (market !== undefined) {\n            feeCurrency = this.safeCurrencyCode (this.safeString (trade, 'fee-currency'));\n        }\n        const filledPoints = this.safeFloat (trade, 'filled-points');\n        if (filledPoints !== undefined) {\n            if ((feeCost === undefined) || (feeCost === 0.0)) {\n                feeCost = filledPoints;\n                feeCurrency = this.safeCurrencyCode (this.safeString (trade, 'fee-deduct-currency'));\n            }\n        }\n        if (feeCost !== undefined) {\n            fee = {\n                'cost': feeCost,\n                'currency': feeCurrency,\n            };\n        }\n        const tradeId = this.safeString2 (trade, 'trade-id', 'tradeId');\n        const id = this.safeString (trade, 'id', tradeId);\n        return {\n            'id': id,\n            'info': trade,\n            'order': order,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'symbol': symbol,\n            'type': type,\n            'side': side,\n            'takerOrMaker': takerOrMaker,\n            'price': price,\n            'amount': amount,\n            'cost': cost,\n            'fee': fee,\n        };\n    }\n\n    async fetchMyTrades (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        let market = undefined;\n        const request = {};\n        if (symbol !== undefined) {\n            market = this.market (symbol);\n            request['symbol'] = market['id'];\n        }\n        if (limit !== undefined) {\n            request['size'] = limit; // 1-100 orders, default is 100\n        }\n        if (since !== undefined) {\n            request['start-date'] = this.ymd (since); // a date within 61 days from today\n            request['end-date'] = this.ymd (this.sum (since, 86400000));\n        }\n        const response = await this.privateGetOrderMatchresults (this.extend (request, params));\n        const trades = this.parseTrades (response['data'], market, since, limit);\n        return trades;\n    }\n\n    async fetchTrades (symbol, since = undefined, limit = 1000, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'symbol': market['id'],\n        };\n        if (limit !== undefined) {\n            request['size'] = limit;\n        }\n        const response = await this.marketGetHistoryTrade (this.extend (request, params));\n        //\n        //     {\n        //         \"status\": \"ok\",\n        //         \"ch\": \"market.btcusdt.trade.detail\",\n        //         \"ts\": 1583497692365,\n        //         \"data\": [\n        //             {\n        //                 \"id\": 105005170342,\n        //                 \"ts\": 1583497692182,\n        //                 \"data\": [\n        //                     {\n        //                         \"amount\": 0.010411000000000000,\n        //                         \"trade-id\": 102090736910,\n        //                         \"ts\": 1583497692182,\n        //                         \"id\": 10500517034273194594947,\n        //                         \"price\": 9096.050000000000000000,\n        //                         \"direction\": \"sell\"\n        //                     }\n        //                 ]\n        //             },\n        //             // ...\n        //         ]\n        //     }\n        //\n        const data = this.safeValue (response, 'data');\n        let result = [];\n        for (let i = 0; i < data.length; i++) {\n            const trades = this.safeValue (data[i], 'data', []);\n            for (let j = 0; j < trades.length; j++) {\n                const trade = this.parseTrade (trades[j], market);\n                result.push (trade);\n            }\n        }\n        result = this.sortBy (result, 'timestamp');\n        return this.filterBySymbolSinceLimit (result, symbol, since, limit);\n    }\n\n    parseOHLCV (ohlcv, market = undefined) {\n        //\n        //     {\n        //         \"amount\":1.2082,\n        //         \"open\":0.025096,\n        //         \"close\":0.025095,\n        //         \"high\":0.025096,\n        //         \"id\":1591515300,\n        //         \"count\":6,\n        //         \"low\":0.025095,\n        //         \"vol\":0.0303205097\n        //     }\n        //\n        return [\n            this.safeTimestamp (ohlcv, 'id'),\n            this.safeFloat (ohlcv, 'open'),\n            this.safeFloat (ohlcv, 'high'),\n            this.safeFloat (ohlcv, 'low'),\n            this.safeFloat (ohlcv, 'close'),\n            this.safeFloat (ohlcv, 'amount'),\n        ];\n    }\n\n    async fetchOHLCV (symbol, timeframe = '1m', since = undefined, limit = 1000, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'symbol': market['id'],\n            'period': this.timeframes[timeframe],\n        };\n        if (limit !== undefined) {\n            request['size'] = limit;\n        }\n        const response = await this.marketGetHistoryKline (this.extend (request, params));\n        //\n        //     {\n        //         \"status\":\"ok\",\n        //         \"ch\":\"market.ethbtc.kline.1min\",\n        //         \"ts\":1591515374371,\n        //         \"data\":[\n        //             {\"amount\":0.0,\"open\":0.025095,\"close\":0.025095,\"high\":0.025095,\"id\":1591515360,\"count\":0,\"low\":0.025095,\"vol\":0.0},\n        //             {\"amount\":1.2082,\"open\":0.025096,\"close\":0.025095,\"high\":0.025096,\"id\":1591515300,\"count\":6,\"low\":0.025095,\"vol\":0.0303205097},\n        //             {\"amount\":0.0648,\"open\":0.025096,\"close\":0.025096,\"high\":0.025096,\"id\":1591515240,\"count\":2,\"low\":0.025096,\"vol\":0.0016262208},\n        //         ]\n        //     }\n        //\n        const data = this.safeValue (response, 'data', []);\n        return this.parseOHLCVs (data, market, timeframe, since, limit);\n    }\n\n    async fetchAccounts (params = {}) {\n        await this.loadMarkets ();\n        const response = await this.privateGetAccountAccounts (params);\n        return response['data'];\n    }\n\n    async fetchCurrencies (params = {}) {\n        const request = {\n            'language': this.options['language'],\n        };\n        const response = await this.publicGetSettingsCurrencys (this.extend (request, params));\n        const currencies = this.safeValue (response, 'data');\n        const result = {};\n        for (let i = 0; i < currencies.length; i++) {\n            const currency = currencies[i];\n            //\n            //  {                     name: \"ctxc\",\n            //              'display-name': \"CTXC\",\n            //        'withdraw-precision':  8,\n            //             'currency-type': \"eth\",\n            //        'currency-partition': \"pro\",\n            //             'support-sites':  null,\n            //                'otc-enable':  0,\n            //        'deposit-min-amount': \"2\",\n            //       'withdraw-min-amount': \"4\",\n            //            'show-precision': \"8\",\n            //                      weight: \"2988\",\n            //                     visible:  true,\n            //              'deposit-desc': \"Please don’t deposit any other digital assets except CTXC t…\",\n            //             'withdraw-desc': \"Minimum withdrawal amount: 4 CTXC. !>_<!For security reason…\",\n            //           'deposit-enabled':  true,\n            //          'withdraw-enabled':  true,\n            //    'currency-addr-with-tag':  false,\n            //             'fast-confirms':  15,\n            //             'safe-confirms':  30                                                             }\n            //\n            const id = this.safeValue (currency, 'name');\n            const precision = this.safeInteger (currency, 'withdraw-precision');\n            const code = this.safeCurrencyCode (id);\n            const active = currency['visible'] && currency['deposit-enabled'] && currency['withdraw-enabled'];\n            const name = this.safeString (currency, 'display-name');\n            result[code] = {\n                'id': id,\n                'code': code,\n                'type': 'crypto',\n                // 'payin': currency['deposit-enabled'],\n                // 'payout': currency['withdraw-enabled'],\n                // 'transfer': undefined,\n                'name': name,\n                'active': active,\n                'fee': undefined, // todo need to fetch from fee endpoint\n                'precision': precision,\n                'limits': {\n                    'amount': {\n                        'min': Math.pow (10, -precision),\n                        'max': Math.pow (10, precision),\n                    },\n                    'price': {\n                        'min': Math.pow (10, -precision),\n                        'max': Math.pow (10, precision),\n                    },\n                    'cost': {\n                        'min': undefined,\n                        'max': undefined,\n                    },\n                    'deposit': {\n                        'min': this.safeFloat (currency, 'deposit-min-amount'),\n                        'max': Math.pow (10, precision),\n                    },\n                    'withdraw': {\n                        'min': this.safeFloat (currency, 'withdraw-min-amount'),\n                        'max': Math.pow (10, precision),\n                    },\n                },\n                'info': currency,\n            };\n        }\n        return result;\n    }\n\n    async fetchBalance (params = {}) {\n        await this.loadMarkets ();\n        await this.loadAccounts ();\n        const method = this.options['fetchBalanceMethod'];\n        const request = {\n            'id': this.accounts[0]['id'],\n        };\n        const response = await this[method] (this.extend (request, params));\n        const balances = this.safeValue (response['data'], 'list', []);\n        const result = { 'info': response };\n        for (let i = 0; i < balances.length; i++) {\n            const balance = balances[i];\n            const currencyId = this.safeString (balance, 'currency');\n            const code = this.safeCurrencyCode (currencyId);\n            let account = undefined;\n            if (code in result) {\n                account = result[code];\n            } else {\n                account = this.account ();\n            }\n            if (balance['type'] === 'trade') {\n                account['free'] = this.safeFloat (balance, 'balance');\n            }\n            if (balance['type'] === 'frozen') {\n                account['used'] = this.safeFloat (balance, 'balance');\n            }\n            result[code] = account;\n        }\n        return this.parseBalance (result);\n    }\n\n    async fetchOrdersByStates (states, symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        const request = {\n            'states': states,\n        };\n        let market = undefined;\n        if (symbol !== undefined) {\n            market = this.market (symbol);\n            request['symbol'] = market['id'];\n        }\n        const method = this.safeString (this.options, 'fetchOrdersByStatesMethod', 'private_get_order_orders');\n        const response = await this[method] (this.extend (request, params));\n        //\n        //     { status:   \"ok\",\n        //         data: [ {                  id:  13997833014,\n        //                                symbol: \"ethbtc\",\n        //                          'account-id':  3398321,\n        //                                amount: \"0.045000000000000000\",\n        //                                 price: \"0.034014000000000000\",\n        //                          'created-at':  1545836976871,\n        //                                  type: \"sell-limit\",\n        //                        'field-amount': \"0.045000000000000000\",\n        //                   'field-cash-amount': \"0.001530630000000000\",\n        //                          'field-fees': \"0.000003061260000000\",\n        //                         'finished-at':  1545837948214,\n        //                                source: \"spot-api\",\n        //                                 state: \"filled\",\n        //                         'canceled-at':  0                      }  ] }\n        //\n        return this.parseOrders (response['data'], market, since, limit);\n    }\n\n    async fetchOrder (id, symbol = undefined, params = {}) {\n        await this.loadMarkets ();\n        const request = {\n            'id': id,\n        };\n        const response = await this.privateGetOrderOrdersId (this.extend (request, params));\n        const order = this.safeValue (response, 'data');\n        return this.parseOrder (order);\n    }\n\n    async fetchOrders (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        return await this.fetchOrdersByStates ('pre-submitted,submitted,partial-filled,filled,partial-canceled,canceled', symbol, since, limit, params);\n    }\n\n    async fetchOpenOrders (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        const method = this.safeString (this.options, 'fetchOpenOrdersMethod', 'fetch_open_orders_v1');\n        return await this[method] (symbol, since, limit, params);\n    }\n\n    async fetchOpenOrdersV1 (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        if (symbol === undefined) {\n            throw new ArgumentsRequired (this.id + ' fetchOpenOrdersV1 requires a symbol argument');\n        }\n        return await this.fetchOrdersByStates ('pre-submitted,submitted,partial-filled', symbol, since, limit, params);\n    }\n\n    async fetchClosedOrders (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        return await this.fetchOrdersByStates ('filled,partial-canceled,canceled', symbol, since, limit, params);\n    }\n\n    async fetchOpenOrdersV2 (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        if (symbol === undefined) {\n            throw new ArgumentsRequired (this.id + ' fetchOpenOrders requires a symbol argument');\n        }\n        const market = this.market (symbol);\n        let accountId = this.safeString (params, 'account-id');\n        if (accountId === undefined) {\n            // pick the first account\n            await this.loadAccounts ();\n            for (let i = 0; i < this.accounts.length; i++) {\n                const account = this.accounts[i];\n                if (account['type'] === 'spot') {\n                    accountId = this.safeString (account, 'id');\n                    if (accountId !== undefined) {\n                        break;\n                    }\n                }\n            }\n        }\n        const request = {\n            'symbol': market['id'],\n            'account-id': accountId,\n        };\n        if (limit !== undefined) {\n            request['size'] = limit;\n        }\n        const omitted = this.omit (params, 'account-id');\n        const response = await this.privateGetOrderOpenOrders (this.extend (request, omitted));\n        //\n        //     {\n        //         \"status\":\"ok\",\n        //         \"data\":[\n        //             {\n        //                 \"symbol\":\"ethusdt\",\n        //                 \"source\":\"api\",\n        //                 \"amount\":\"0.010000000000000000\",\n        //                 \"account-id\":1528640,\n        //                 \"created-at\":1561597491963,\n        //                 \"price\":\"400.000000000000000000\",\n        //                 \"filled-amount\":\"0.0\",\n        //                 \"filled-cash-amount\":\"0.0\",\n        //                 \"filled-fees\":\"0.0\",\n        //                 \"id\":38477101630,\n        //                 \"state\":\"submitted\",\n        //                 \"type\":\"sell-limit\"\n        //             }\n        //         ]\n        //     }\n        //\n        const data = this.safeValue (response, 'data', []);\n        return this.parseOrders (data, market, since, limit);\n    }\n\n    parseOrderStatus (status) {\n        const statuses = {\n            'partial-filled': 'open',\n            'partial-canceled': 'canceled',\n            'filled': 'closed',\n            'canceled': 'canceled',\n            'submitted': 'open',\n        };\n        return this.safeString (statuses, status, status);\n    }\n\n    parseOrder (order, market = undefined) {\n        //\n        //     {                  id:  13997833014,\n        //                    symbol: \"ethbtc\",\n        //              'account-id':  3398321,\n        //                    amount: \"0.045000000000000000\",\n        //                     price: \"0.034014000000000000\",\n        //              'created-at':  1545836976871,\n        //                      type: \"sell-limit\",\n        //            'field-amount': \"0.045000000000000000\", // they have fixed it for filled-amount\n        //       'field-cash-amount': \"0.001530630000000000\", // they have fixed it for filled-cash-amount\n        //              'field-fees': \"0.000003061260000000\", // they have fixed it for filled-fees\n        //             'finished-at':  1545837948214,\n        //                    source: \"spot-api\",\n        //                     state: \"filled\",\n        //             'canceled-at':  0                      }\n        //\n        //     {                  id:  20395337822,\n        //                    symbol: \"ethbtc\",\n        //              'account-id':  5685075,\n        //                    amount: \"0.001000000000000000\",\n        //                     price: \"0.0\",\n        //              'created-at':  1545831584023,\n        //                      type: \"buy-market\",\n        //            'field-amount': \"0.029100000000000000\", // they have fixed it for filled-amount\n        //       'field-cash-amount': \"0.000999788700000000\", // they have fixed it for filled-cash-amount\n        //              'field-fees': \"0.000058200000000000\", // they have fixed it for filled-fees\n        //             'finished-at':  1545831584181,\n        //                    source: \"spot-api\",\n        //                     state: \"filled\",\n        //             'canceled-at':  0                      }\n        //\n        const id = this.safeString (order, 'id');\n        let side = undefined;\n        let type = undefined;\n        let status = undefined;\n        if ('type' in order) {\n            const orderType = order['type'].split ('-');\n            side = orderType[0];\n            type = orderType[1];\n            status = this.parseOrderStatus (this.safeString (order, 'state'));\n        }\n        const marketId = this.safeString (order, 'symbol');\n        const symbol = this.safeSymbol (marketId, market);\n        const timestamp = this.safeInteger (order, 'created-at');\n        let amount = this.safeFloat (order, 'amount');\n        const filled = this.safeFloat2 (order, 'filled-amount', 'field-amount'); // typo in their API, filled amount\n        if ((type === 'market') && (side === 'buy')) {\n            amount = (status === 'closed') ? filled : undefined;\n        }\n        let price = this.safeFloat (order, 'price');\n        if (price === 0.0) {\n            price = undefined;\n        }\n        const cost = this.safeFloat2 (order, 'filled-cash-amount', 'field-cash-amount'); // same typo\n        let remaining = undefined;\n        let average = undefined;\n        if (filled !== undefined) {\n            if (amount !== undefined) {\n                remaining = amount - filled;\n            }\n            // if cost is defined and filled is not zero\n            if ((cost !== undefined) && (filled > 0)) {\n                average = cost / filled;\n            }\n        }\n        const feeCost = this.safeFloat2 (order, 'filled-fees', 'field-fees'); // typo in their API, filled fees\n        let fee = undefined;\n        if (feeCost !== undefined) {\n            let feeCurrency = undefined;\n            if (market !== undefined) {\n                feeCurrency = (side === 'sell') ? market['quote'] : market['base'];\n            }\n            fee = {\n                'cost': feeCost,\n                'currency': feeCurrency,\n            };\n        }\n        return {\n            'info': order,\n            'id': id,\n            'clientOrderId': undefined,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'lastTradeTimestamp': undefined,\n            'symbol': symbol,\n            'type': type,\n            'timeInForce': undefined,\n            'postOnly': undefined,\n            'side': side,\n            'price': price,\n            'stopPrice': undefined,\n            'average': average,\n            'cost': cost,\n            'amount': amount,\n            'filled': filled,\n            'remaining': remaining,\n            'status': status,\n            'fee': fee,\n            'trades': undefined,\n        };\n    }\n\n    async createOrder (symbol, type, side, amount, price = undefined, params = {}) {\n        await this.loadMarkets ();\n        await this.loadAccounts ();\n        const market = this.market (symbol);\n        const request = {\n            'account-id': this.accounts[0]['id'],\n            'symbol': market['id'],\n            'type': side + '-' + type,\n        };\n        if ((type === 'market') && (side === 'buy')) {\n            if (this.options['createMarketBuyOrderRequiresPrice']) {\n                if (price === undefined) {\n                    throw new InvalidOrder (this.id + \" market buy order requires price argument to calculate cost (total amount of quote currency to spend for buying, amount * price). To switch off this warning exception and specify cost in the amount argument, set .options['createMarketBuyOrderRequiresPrice'] = false. Make sure you know what you're doing.\");\n                } else {\n                    // despite that cost = amount * price is in quote currency and should have quote precision\n                    // the exchange API requires the cost supplied in 'amount' to be of base precision\n                    // more about it here:\n                    // https://github.com/ccxt/ccxt/pull/4395\n                    // https://github.com/ccxt/ccxt/issues/7611\n                    // we use amountToPrecision here because the exchange requires cost in base precision\n                    request['amount'] = this.costToPrecision (symbol, parseFloat (amount) * parseFloat (price));\n                }\n            } else {\n                request['amount'] = this.costToPrecision (symbol, amount);\n            }\n        } else {\n            request['amount'] = this.amountToPrecision (symbol, amount);\n        }\n        if (type === 'limit' || type === 'ioc' || type === 'limit-maker') {\n            request['price'] = this.priceToPrecision (symbol, price);\n        }\n        const method = this.options['createOrderMethod'];\n        const response = await this[method] (this.extend (request, params));\n        const timestamp = this.milliseconds ();\n        const id = this.safeString (response, 'data');\n        return {\n            'info': response,\n            'id': id,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'lastTradeTimestamp': undefined,\n            'status': undefined,\n            'symbol': symbol,\n            'type': type,\n            'side': side,\n            'price': price,\n            'amount': amount,\n            'filled': undefined,\n            'remaining': undefined,\n            'cost': undefined,\n            'trades': undefined,\n            'fee': undefined,\n            'clientOrderId': undefined,\n            'average': undefined,\n        };\n    }\n\n    async cancelOrder (id, symbol = undefined, params = {}) {\n        const response = await this.privatePostOrderOrdersIdSubmitcancel ({ 'id': id });\n        //\n        //     let response = {\n        //         'status': 'ok',\n        //         'data': '10138899000',\n        //     };\n        //\n        return this.extend (this.parseOrder (response), {\n            'id': id,\n            'status': 'canceled',\n        });\n    }\n\n    currencyToPrecision (currency, fee) {\n        return this.decimalToPrecision (fee, 0, this.currencies[currency]['precision']);\n    }\n\n    calculateFee (symbol, type, side, amount, price, takerOrMaker = 'taker', params = {}) {\n        const market = this.markets[symbol];\n        const rate = market[takerOrMaker];\n        let cost = amount * rate;\n        let key = 'quote';\n        if (side === 'sell') {\n            cost *= price;\n        } else {\n            key = 'base';\n        }\n        return {\n            'type': takerOrMaker,\n            'currency': market[key],\n            'rate': rate,\n            'cost': parseFloat (this.currencyToPrecision (market[key], cost)),\n        };\n    }\n\n    parseDepositAddress (depositAddress, currency = undefined) {\n        //\n        //     {\n        //         currency: \"eth\",\n        //         address: \"0xf7292eb9ba7bc50358e27f0e025a4d225a64127b\",\n        //         addressTag: \"\",\n        //         chain: \"eth\"\n        //     }\n        //\n        const address = this.safeString (depositAddress, 'address');\n        const tag = this.safeString (depositAddress, 'addressTag');\n        const currencyId = this.safeString (depositAddress, 'currency');\n        const code = this.safeCurrencyCode (currencyId);\n        this.checkAddress (address);\n        return {\n            'currency': code,\n            'address': address,\n            'tag': tag,\n            'info': depositAddress,\n        };\n    }\n\n    async fetchDepositAddress (code, params = {}) {\n        await this.loadMarkets ();\n        const currency = this.currency (code);\n        const request = {\n            'currency': currency['id'],\n        };\n        const response = await this.v2PrivateGetAccountDepositAddress (this.extend (request, params));\n        //\n        //     {\n        //         code: 200,\n        //         data: [\n        //             {\n        //                 currency: \"eth\",\n        //                 address: \"0xf7292eb9ba7bc50358e27f0e025a4d225a64127b\",\n        //                 addressTag: \"\",\n        //                 chain: \"eth\"\n        //             }\n        //         ]\n        //     }\n        //\n        const data = this.safeValue (response, 'data', []);\n        return this.parseDepositAddress (this.safeValue (data, 0, {}), currency);\n    }\n\n    async fetchDeposits (code = undefined, since = undefined, limit = undefined, params = {}) {\n        if (limit === undefined || limit > 100) {\n            limit = 100;\n        }\n        await this.loadMarkets ();\n        let currency = undefined;\n        if (code !== undefined) {\n            currency = this.currency (code);\n        }\n        const request = {\n            'type': 'deposit',\n            'from': 0, // From 'id' ... if you want to get results after a particular transaction id, pass the id in params.from\n        };\n        if (currency !== undefined) {\n            request['currency'] = currency['id'];\n        }\n        if (limit !== undefined) {\n            request['size'] = limit; // max 100\n        }\n        const response = await this.privateGetQueryDepositWithdraw (this.extend (request, params));\n        // return response\n        return this.parseTransactions (response['data'], currency, since, limit);\n    }\n\n    async fetchWithdrawals (code = undefined, since = undefined, limit = undefined, params = {}) {\n        if (limit === undefined || limit > 100) {\n            limit = 100;\n        }\n        await this.loadMarkets ();\n        let currency = undefined;\n        if (code !== undefined) {\n            currency = this.currency (code);\n        }\n        const request = {\n            'type': 'withdraw',\n            'from': 0, // From 'id' ... if you want to get results after a particular transaction id, pass the id in params.from\n        };\n        if (currency !== undefined) {\n            request['currency'] = currency['id'];\n        }\n        if (limit !== undefined) {\n            request['size'] = limit; // max 100\n        }\n        const response = await this.privateGetQueryDepositWithdraw (this.extend (request, params));\n        // return response\n        return this.parseTransactions (response['data'], currency, since, limit);\n    }\n\n    parseTransaction (transaction, currency = undefined) {\n        //\n        // fetchDeposits\n        //\n        //     {\n        //         'id': 8211029,\n        //         'type': 'deposit',\n        //         'currency': 'eth',\n        //         'chain': 'eth',\n        //         'tx-hash': 'bd315....',\n        //         'amount': 0.81162421,\n        //         'address': '4b8b....',\n        //         'address-tag': '',\n        //         'fee': 0,\n        //         'state': 'safe',\n        //         'created-at': 1542180380965,\n        //         'updated-at': 1542180788077\n        //     }\n        //\n        // fetchWithdrawals\n        //\n        //     {\n        //         'id': 6908275,\n        //         'type': 'withdraw',\n        //         'currency': 'btc',\n        //         'chain': 'btc',\n        //         'tx-hash': 'c1a1a....',\n        //         'amount': 0.80257005,\n        //         'address': '1QR....',\n        //         'address-tag': '',\n        //         'fee': 0.0005,\n        //         'state': 'confirmed',\n        //         'created-at': 1552107295685,\n        //         'updated-at': 1552108032859\n        //     }\n        //\n        const timestamp = this.safeInteger (transaction, 'created-at');\n        const updated = this.safeInteger (transaction, 'updated-at');\n        const code = this.safeCurrencyCode (this.safeString (transaction, 'currency'));\n        let type = this.safeString (transaction, 'type');\n        if (type === 'withdraw') {\n            type = 'withdrawal';\n        }\n        const status = this.parseTransactionStatus (this.safeString (transaction, 'state'));\n        const tag = this.safeString (transaction, 'address-tag');\n        let feeCost = this.safeFloat (transaction, 'fee');\n        if (feeCost !== undefined) {\n            feeCost = Math.abs (feeCost);\n        }\n        return {\n            'info': transaction,\n            'id': this.safeString (transaction, 'id'),\n            'txid': this.safeString (transaction, 'tx-hash'),\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'address': this.safeString (transaction, 'address'),\n            'tag': tag,\n            'type': type,\n            'amount': this.safeFloat (transaction, 'amount'),\n            'currency': code,\n            'status': status,\n            'updated': updated,\n            'fee': {\n                'currency': code,\n                'cost': feeCost,\n                'rate': undefined,\n            },\n        };\n    }\n\n    parseTransactionStatus (status) {\n        const statuses = {\n            // deposit statuses\n            'unknown': 'failed',\n            'confirming': 'pending',\n            'confirmed': 'ok',\n            'safe': 'ok',\n            'orphan': 'failed',\n            // withdrawal statuses\n            'submitted': 'pending',\n            'canceled': 'canceled',\n            'reexamine': 'pending',\n            'reject': 'failed',\n            'pass': 'pending',\n            'wallet-reject': 'failed',\n            // 'confirmed': 'ok', // present in deposit statuses\n            'confirm-error': 'failed',\n            'repealed': 'failed',\n            'wallet-transfer': 'pending',\n            'pre-transfer': 'pending',\n        };\n        return this.safeString (statuses, status, status);\n    }\n\n    async withdraw (code, amount, address, tag = undefined, params = {}) {\n        await this.loadMarkets ();\n        this.checkAddress (address);\n        const currency = this.currency (code);\n        const request = {\n            'address': address, // only supports existing addresses in your withdraw address list\n            'amount': amount,\n            'currency': currency['id'].toLowerCase (),\n        };\n        if (tag !== undefined) {\n            request['addr-tag'] = tag; // only for XRP?\n        }\n        const response = await this.privatePostDwWithdrawApiCreate (this.extend (request, params));\n        const id = this.safeString (response, 'data');\n        return {\n            'info': response,\n            'id': id,\n        };\n    }\n\n    sign (path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n        let url = '/';\n        if (api === 'market') {\n            url += api;\n        } else if ((api === 'public') || (api === 'private')) {\n            url += this.version;\n        } else if ((api === 'v2Public') || (api === 'v2Private')) {\n            url += 'v2';\n        }\n        url += '/' + this.implodeParams (path, params);\n        const query = this.omit (params, this.extractParams (path));\n        if (api === 'private' || api === 'v2Private') {\n            this.checkRequiredCredentials ();\n            const timestamp = this.ymdhms (this.milliseconds (), 'T');\n            let request = {\n                'SignatureMethod': 'HmacSHA256',\n                'SignatureVersion': '2',\n                'AccessKeyId': this.apiKey,\n                'Timestamp': timestamp,\n            };\n            if (method !== 'POST') {\n                request = this.extend (request, query);\n            }\n            request = this.keysort (request);\n            let auth = this.urlencode (request);\n            // unfortunately, PHP demands double quotes for the escaped newline symbol\n            // eslint-disable-next-line quotes\n            const payload = [ method, this.hostname, url, auth ].join (\"\\n\");\n            const signature = this.hmac (this.encode (payload), this.encode (this.secret), 'sha256', 'base64');\n            auth += '&' + this.urlencode ({ 'Signature': signature });\n            url += '?' + auth;\n            if (method === 'POST') {\n                body = this.json (query);\n                headers = {\n                    'Content-Type': 'application/json',\n                };\n            } else {\n                headers = {\n                    'Content-Type': 'application/x-www-form-urlencoded',\n                };\n            }\n        } else {\n            if (Object.keys (params).length) {\n                url += '?' + this.urlencode (params);\n            }\n        }\n        url = this.implodeParams (this.urls['api'][api], {\n            'hostname': this.hostname,\n        }) + url;\n        return { 'url': url, 'method': method, 'body': body, 'headers': headers };\n    }\n\n    handleErrors (httpCode, reason, url, method, headers, body, response, requestHeaders, requestBody) {\n        if (response === undefined) {\n            return; // fallback to default error handler\n        }\n        if ('status' in response) {\n            //\n            //     {\"status\":\"error\",\"err-code\":\"order-limitorder-amount-min-error\",\"err-msg\":\"limit order amount error, min: `0.001`\",\"data\":null}\n            //\n            const status = this.safeString (response, 'status');\n            if (status === 'error') {\n                const code = this.safeString (response, 'err-code');\n                const feedback = this.id + ' ' + body;\n                this.throwExactlyMatchedException (this.exceptions['exact'], code, feedback);\n                const message = this.safeString (response, 'err-msg');\n                this.throwExactlyMatchedException (this.exceptions['exact'], message, feedback);\n                throw new ExchangeError (feedback);\n            }\n        }\n    }\n};\n"]},"metadata":{},"sourceType":"script"}