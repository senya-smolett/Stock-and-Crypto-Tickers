{"ast":null,"code":"'use strict'; //  ---------------------------------------------------------------------------\n\nconst Exchange = require('./base/Exchange');\n\nconst {\n  ExchangeError,\n  ArgumentsRequired\n} = require('./base/errors'); //  ---------------------------------------------------------------------------\n\n\nmodule.exports = class luno extends Exchange {\n  describe() {\n    return this.deepExtend(super.describe(), {\n      'id': 'luno',\n      'name': 'luno',\n      'countries': ['GB', 'SG', 'ZA'],\n      'rateLimit': 1000,\n      'version': '1',\n      'has': {\n        'cancelOrder': true,\n        'CORS': false,\n        'createOrder': true,\n        'fetchAccounts': true,\n        'fetchBalance': true,\n        'fetchClosedOrders': true,\n        'fetchLedger': true,\n        'fetchMarkets': true,\n        'fetchMyTrades': true,\n        'fetchOpenOrders': true,\n        'fetchOrder': true,\n        'fetchOrderBook': true,\n        'fetchOrders': true,\n        'fetchTicker': true,\n        'fetchTickers': true,\n        'fetchTrades': true,\n        'fetchTradingFee': true,\n        'fetchTradingFees': true\n      },\n      'urls': {\n        'referral': 'https://www.luno.com/invite/44893A',\n        'logo': 'https://user-images.githubusercontent.com/1294454/27766607-8c1a69d8-5ede-11e7-930c-540b5eb9be24.jpg',\n        'api': {\n          'public': 'https://api.luno.com/api',\n          'private': 'https://api.luno.com/api',\n          'exchange': 'https://api.luno.com/api/exchange'\n        },\n        'www': 'https://www.luno.com',\n        'doc': ['https://www.luno.com/en/api', 'https://npmjs.org/package/bitx', 'https://github.com/bausmeier/node-bitx']\n      },\n      'api': {\n        'exchange': {\n          'get': ['markets']\n        },\n        'public': {\n          'get': ['orderbook', 'orderbook_top', 'ticker', 'tickers', 'trades']\n        },\n        'private': {\n          'get': ['accounts/{id}/pending', 'accounts/{id}/transactions', 'balance', 'beneficiaries', 'fee_info', 'funding_address', 'listorders', 'listtrades', 'orders/{id}', 'quotes/{id}', 'withdrawals', 'withdrawals/{id}'],\n          'post': ['accounts', 'accounts/{id}/name', 'postorder', 'marketorder', 'stoporder', 'funding_address', 'withdrawals', 'send', 'quotes', 'oauth2/grant'],\n          'put': ['accounts/{id}/name', 'quotes/{id}'],\n          'delete': ['quotes/{id}', 'withdrawals/{id}']\n        }\n      }\n    });\n  }\n\n  async fetchMarkets(params = {}) {\n    const response = await this.exchangeGetMarkets(params); //\n    //     {\n    //         \"markets\":[\n    //             {\n    //                 \"market_id\":\"BCHXBT\",\n    //                 \"trading_status\":\"ACTIVE\",\n    //                 \"base_currency\":\"BCH\",\n    //                 \"counter_currency\":\"XBT\",\n    //                 \"min_volume\":\"0.01\",\n    //                 \"max_volume\":\"100.00\",\n    //                 \"volume_scale\":2,\n    //                 \"min_price\":\"0.0001\",\n    //                 \"max_price\":\"1.00\",\n    //                 \"price_scale\":6,\n    //                 \"fee_scale\":8,\n    //             },\n    //         ]\n    //     }\n    //\n\n    const result = [];\n    const markets = this.safeValue(response, 'markets', []);\n\n    for (let i = 0; i < markets.length; i++) {\n      const market = markets[i];\n      const id = this.safeString(market, 'market_id');\n      const baseId = this.safeString(market, 'base_currency');\n      const quoteId = this.safeString(market, 'counter_currency');\n      const base = this.safeCurrencyCode(baseId);\n      const quote = this.safeCurrencyCode(quoteId);\n      const symbol = base + '/' + quote;\n      const status = this.safeString(market, 'trading_status');\n      const active = status === 'ACTIVE';\n      const precision = {\n        'amount': this.safeInteger(market, 'volume_scale'),\n        'price': this.safeInteger(market, 'price_scale')\n      };\n      result.push({\n        'id': id,\n        'symbol': symbol,\n        'base': base,\n        'quote': quote,\n        'baseId': baseId,\n        'quoteId': quoteId,\n        'active': active,\n        'precision': precision,\n        'limits': {\n          'amount': {\n            'min': this.safeFloat(market, 'min_volume'),\n            'max': this.safeFloat(market, 'max_volume')\n          },\n          'price': {\n            'min': this.safeFloat(market, 'min_price'),\n            'max': this.safeFloat(market, 'max_price')\n          },\n          'cost': {\n            'min': undefined,\n            'max': undefined\n          }\n        },\n        'info': market\n      });\n    }\n\n    return result;\n  }\n\n  async fetchAccounts(params = {}) {\n    const response = await this.privateGetBalance(params);\n    const wallets = this.safeValue(response, 'balance', []);\n    const result = [];\n\n    for (let i = 0; i < wallets.length; i++) {\n      const account = wallets[i];\n      const accountId = this.safeString(account, 'account_id');\n      const currencyId = this.safeString(account, 'asset');\n      const code = this.safeCurrencyCode(currencyId);\n      result.push({\n        'id': accountId,\n        'type': undefined,\n        'currency': code,\n        'info': account\n      });\n    }\n\n    return result;\n  }\n\n  async fetchBalance(params = {}) {\n    await this.loadMarkets();\n    const response = await this.privateGetBalance(params); //\n    //     {\n    //         'balance': [\n    //             {'account_id': '119...1336','asset': 'XBT','balance': '0.00','reserved': '0.00','unconfirmed': '0.00'},\n    //             {'account_id': '66...289','asset': 'XBT','balance': '0.00','reserved': '0.00','unconfirmed': '0.00'},\n    //             {'account_id': '718...5300','asset': 'ETH','balance': '0.00','reserved': '0.00','unconfirmed': '0.00'},\n    //             {'account_id': '818...7072','asset': 'ZAR','balance': '0.001417','reserved': '0.00','unconfirmed': '0.00'}]}\n    //         ]\n    //     }\n    //\n\n    const wallets = this.safeValue(response, 'balance', []);\n    const result = {\n      'info': response\n    };\n\n    for (let i = 0; i < wallets.length; i++) {\n      const wallet = wallets[i];\n      const currencyId = this.safeString(wallet, 'asset');\n      const code = this.safeCurrencyCode(currencyId);\n      const reserved = this.safeFloat(wallet, 'reserved');\n      const unconfirmed = this.safeFloat(wallet, 'unconfirmed');\n      const balance = this.safeFloat(wallet, 'balance');\n\n      if (code in result) {\n        result[code]['used'] = this.sum(result[code]['used'], reserved, unconfirmed);\n        result[code]['total'] = this.sum(result[code]['total'], balance, unconfirmed);\n      } else {\n        const account = this.account();\n        account['used'] = this.sum(reserved, unconfirmed);\n        account['total'] = this.sum(balance, unconfirmed);\n        result[code] = account;\n      }\n    }\n\n    return this.parseBalance(result);\n  }\n\n  async fetchOrderBook(symbol, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    let method = 'publicGetOrderbook';\n\n    if (limit !== undefined) {\n      if (limit <= 100) {\n        method += 'Top'; // get just the top of the orderbook when limit is low\n      }\n    }\n\n    const request = {\n      'pair': this.marketId(symbol)\n    };\n    const response = await this[method](this.extend(request, params));\n    const timestamp = this.safeInteger(response, 'timestamp');\n    return this.parseOrderBook(response, timestamp, 'bids', 'asks', 'price', 'volume');\n  }\n\n  parseOrderStatus(status) {\n    const statuses = {\n      // todo add other statuses\n      'PENDING': 'open'\n    };\n    return this.safeString(statuses, status, status);\n  }\n\n  parseOrder(order, market = undefined) {\n    //\n    //     {\n    //         \"base\": \"string\",\n    //         \"completed_timestamp\": \"string\",\n    //         \"counter\": \"string\",\n    //         \"creation_timestamp\": \"string\",\n    //         \"expiration_timestamp\": \"string\",\n    //         \"fee_base\": \"string\",\n    //         \"fee_counter\": \"string\",\n    //         \"limit_price\": \"string\",\n    //         \"limit_volume\": \"string\",\n    //         \"order_id\": \"string\",\n    //         \"pair\": \"string\",\n    //         \"state\": \"PENDING\",\n    //         \"type\": \"BID\"\n    //     }\n    //\n    const timestamp = this.safeInteger(order, 'creation_timestamp');\n    let status = this.parseOrderStatus(this.safeString(order, 'state'));\n    status = status === 'open' ? status : status;\n    const side = order['type'] === 'ASK' ? 'sell' : 'buy';\n    const marketId = this.safeString(order, 'pair');\n    const symbol = this.safeSymbol(marketId, market);\n    const price = this.safeFloat(order, 'limit_price');\n    const amount = this.safeFloat(order, 'limit_volume');\n    const quoteFee = this.safeFloat(order, 'fee_counter');\n    const baseFee = this.safeFloat(order, 'fee_base');\n    const filled = this.safeFloat(order, 'base');\n    const cost = this.safeFloat(order, 'counter');\n    let remaining = undefined;\n\n    if (amount !== undefined) {\n      if (filled !== undefined) {\n        remaining = Math.max(0, amount - filled);\n      }\n    }\n\n    const fee = {\n      'currency': undefined\n    };\n\n    if (quoteFee) {\n      fee['cost'] = quoteFee;\n\n      if (market !== undefined) {\n        fee['currency'] = market['quote'];\n      }\n    } else {\n      fee['cost'] = baseFee;\n\n      if (market !== undefined) {\n        fee['currency'] = market['base'];\n      }\n    }\n\n    const id = this.safeString(order, 'order_id');\n    return {\n      'id': id,\n      'clientOrderId': undefined,\n      'datetime': this.iso8601(timestamp),\n      'timestamp': timestamp,\n      'lastTradeTimestamp': undefined,\n      'status': status,\n      'symbol': symbol,\n      'type': undefined,\n      'timeInForce': undefined,\n      'postOnly': undefined,\n      'side': side,\n      'price': price,\n      'stopPrice': undefined,\n      'amount': amount,\n      'filled': filled,\n      'cost': cost,\n      'remaining': remaining,\n      'trades': undefined,\n      'fee': fee,\n      'info': order,\n      'average': undefined\n    };\n  }\n\n  async fetchOrder(id, symbol = undefined, params = {}) {\n    await this.loadMarkets();\n    const request = {\n      'id': id\n    };\n    const response = await this.privateGetOrdersId(this.extend(request, params));\n    return this.parseOrder(response);\n  }\n\n  async fetchOrdersByState(state = undefined, symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    const request = {};\n    let market = undefined;\n\n    if (state !== undefined) {\n      request['state'] = state;\n    }\n\n    if (symbol !== undefined) {\n      market = this.market(symbol);\n      request['pair'] = market['id'];\n    }\n\n    const response = await this.privateGetListorders(this.extend(request, params));\n    const orders = this.safeValue(response, 'orders', []);\n    return this.parseOrders(orders, market, since, limit);\n  }\n\n  async fetchOrders(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    return await this.fetchOrdersByState(undefined, symbol, since, limit, params);\n  }\n\n  async fetchOpenOrders(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    return await this.fetchOrdersByState('PENDING', symbol, since, limit, params);\n  }\n\n  async fetchClosedOrders(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    return await this.fetchOrdersByState('COMPLETE', symbol, since, limit, params);\n  }\n\n  parseTicker(ticker, market = undefined) {\n    const timestamp = this.safeInteger(ticker, 'timestamp');\n    let symbol = undefined;\n\n    if (market) {\n      symbol = market['symbol'];\n    }\n\n    const last = this.safeFloat(ticker, 'last_trade');\n    return {\n      'symbol': symbol,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'high': undefined,\n      'low': undefined,\n      'bid': this.safeFloat(ticker, 'bid'),\n      'bidVolume': undefined,\n      'ask': this.safeFloat(ticker, 'ask'),\n      'askVolume': undefined,\n      'vwap': undefined,\n      'open': undefined,\n      'close': last,\n      'last': last,\n      'previousClose': undefined,\n      'change': undefined,\n      'percentage': undefined,\n      'average': undefined,\n      'baseVolume': this.safeFloat(ticker, 'rolling_24_hour_volume'),\n      'quoteVolume': undefined,\n      'info': ticker\n    };\n  }\n\n  async fetchTickers(symbols = undefined, params = {}) {\n    await this.loadMarkets();\n    const response = await this.publicGetTickers(params);\n    const tickers = this.indexBy(response['tickers'], 'pair');\n    const ids = Object.keys(tickers);\n    const result = {};\n\n    for (let i = 0; i < ids.length; i++) {\n      const id = ids[i];\n      const market = this.safeMarket(id);\n      const symbol = market['symbol'];\n      const ticker = tickers[id];\n      result[symbol] = this.parseTicker(ticker, market);\n    }\n\n    return this.filterByArray(result, 'symbol', symbols);\n  }\n\n  async fetchTicker(symbol, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'pair': market['id']\n    };\n    const response = await this.publicGetTicker(this.extend(request, params));\n    return this.parseTicker(response, market);\n  }\n\n  parseTrade(trade, market) {\n    // For public trade data (is_buy === True) indicates 'buy' side but for private trade data\n    // is_buy indicates maker or taker. The value of \"type\" (ASK/BID) indicate sell/buy side.\n    // Private trade data includes ID field which public trade data does not.\n    const orderId = this.safeString(trade, 'order_id');\n    let takerOrMaker = undefined;\n    let side = undefined;\n\n    if (orderId !== undefined) {\n      side = trade['type'] === 'ASK' ? 'sell' : 'buy';\n\n      if (side === 'sell' && trade['is_buy']) {\n        takerOrMaker = 'maker';\n      } else if (side === 'buy' && !trade['is_buy']) {\n        takerOrMaker = 'maker';\n      } else {\n        takerOrMaker = 'taker';\n      }\n    } else {\n      side = trade['is_buy'] ? 'buy' : 'sell';\n    }\n\n    const feeBase = this.safeFloat(trade, 'fee_base');\n    const feeCounter = this.safeFloat(trade, 'fee_counter');\n    let feeCurrency = undefined;\n    let feeCost = undefined;\n\n    if (feeBase !== undefined) {\n      if (feeBase !== 0.0) {\n        feeCurrency = market['base'];\n        feeCost = feeBase;\n      }\n    } else if (feeCounter !== undefined) {\n      if (feeCounter !== 0.0) {\n        feeCurrency = market['quote'];\n        feeCost = feeCounter;\n      }\n    }\n\n    const timestamp = this.safeInteger(trade, 'timestamp');\n    return {\n      'info': trade,\n      'id': undefined,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'symbol': market['symbol'],\n      'order': orderId,\n      'type': undefined,\n      'side': side,\n      'takerOrMaker': takerOrMaker,\n      'price': this.safeFloat(trade, 'price'),\n      'amount': this.safeFloat(trade, 'volume'),\n      // Does not include potential fee costs\n      'cost': this.safeFloat(trade, 'counter'),\n      'fee': {\n        'cost': feeCost,\n        'currency': feeCurrency\n      }\n    };\n  }\n\n  async fetchTrades(symbol, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'pair': market['id']\n    };\n\n    if (since !== undefined) {\n      request['since'] = since;\n    }\n\n    const response = await this.publicGetTrades(this.extend(request, params));\n    const trades = this.safeValue(response, 'trades', []);\n    return this.parseTrades(trades, market, since, limit);\n  }\n\n  async fetchMyTrades(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    if (symbol === undefined) {\n      throw new ArgumentsRequired(this.id + ' fetchMyTrades requires a symbol argument');\n    }\n\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'pair': market['id']\n    };\n\n    if (since !== undefined) {\n      request['since'] = since;\n    }\n\n    if (limit !== undefined) {\n      request['limit'] = limit;\n    }\n\n    const response = await this.privateGetListtrades(this.extend(request, params));\n    const trades = this.safeValue(response, 'trades', []);\n    return this.parseTrades(trades, market, since, limit);\n  }\n\n  async fetchTradingFees(params = {}) {\n    await this.loadMarkets();\n    const response = await this.privateGetFeeInfo(params);\n    return {\n      'info': response,\n      'maker': this.safeFloat(response, 'maker_fee'),\n      'taker': this.safeFloat(response, 'taker_fee')\n    };\n  }\n\n  async createOrder(symbol, type, side, amount, price = undefined, params = {}) {\n    await this.loadMarkets();\n    let method = 'privatePost';\n    const request = {\n      'pair': this.marketId(symbol)\n    };\n\n    if (type === 'market') {\n      method += 'Marketorder';\n      request['type'] = side.toUpperCase();\n\n      if (side === 'buy') {\n        request['counter_volume'] = amount;\n      } else {\n        request['base_volume'] = amount;\n      }\n    } else {\n      method += 'Postorder';\n      request['volume'] = amount;\n      request['price'] = price;\n      request['type'] = side === 'buy' ? 'BID' : 'ASK';\n    }\n\n    const response = await this[method](this.extend(request, params));\n    return {\n      'info': response,\n      'id': response['order_id']\n    };\n  }\n\n  async cancelOrder(id, symbol = undefined, params = {}) {\n    await this.loadMarkets();\n    const request = {\n      'order_id': id\n    };\n    return await this.privatePostStoporder(this.extend(request, params));\n  }\n\n  async fetchLedgerByEntries(code = undefined, entry = -1, limit = 1, params = {}) {\n    // by default without entry number or limit number, return most recent entry\n    const since = undefined;\n    const request = {\n      'min_row': entry,\n      'max_row': this.sum(entry, limit)\n    };\n    return await this.fetchLedger(code, since, limit, this.extend(request, params));\n  }\n\n  async fetchLedger(code = undefined, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    await this.loadAccounts();\n    let currency = undefined;\n    let id = this.safeString(params, 'id'); // account id\n\n    let min_row = this.safeValue(params, 'min_row');\n    let max_row = this.safeValue(params, 'max_row');\n\n    if (id === undefined) {\n      if (code === undefined) {\n        throw new ArgumentsRequired(this.id + ' fetchLedger() requires a currency code argument if no account id specified in params');\n      }\n\n      currency = this.currency(code);\n      const accountsByCurrencyCode = this.indexBy(this.accounts, 'currency');\n      const account = this.safeValue(accountsByCurrencyCode, code);\n\n      if (account === undefined) {\n        throw new ExchangeError(this.id + ' fetchLedger() could not find account id for ' + code);\n      }\n\n      id = account['id'];\n    }\n\n    if (min_row === undefined && max_row === undefined) {\n      max_row = 0; // Default to most recent transactions\n\n      min_row = -1000; // Maximum number of records supported\n    } else if (min_row === undefined || max_row === undefined) {\n      throw new ExchangeError(this.id + \" fetchLedger() require both params 'max_row' and 'min_row' or neither to be defined\");\n    }\n\n    if (limit !== undefined && max_row - min_row > limit) {\n      if (max_row <= 0) {\n        min_row = max_row - limit;\n      } else if (min_row > 0) {\n        max_row = min_row + limit;\n      }\n    }\n\n    if (max_row - min_row > 1000) {\n      throw new ExchangeError(this.id + \" fetchLedger() requires the params 'max_row' - 'min_row' <= 1000\");\n    }\n\n    const request = {\n      'id': id,\n      'min_row': min_row,\n      'max_row': max_row\n    };\n    const response = await this.privateGetAccountsIdTransactions(this.extend(params, request));\n    const entries = this.safeValue(response, 'transactions', []);\n    return this.parseLedger(entries, currency, since, limit);\n  }\n\n  parseLedgerComment(comment) {\n    const words = comment.split(' ');\n    const types = {\n      'Withdrawal': 'fee',\n      'Trading': 'fee',\n      'Payment': 'transaction',\n      'Sent': 'transaction',\n      'Deposit': 'transaction',\n      'Received': 'transaction',\n      'Released': 'released',\n      'Reserved': 'reserved',\n      'Sold': 'trade',\n      'Bought': 'trade',\n      'Failure': 'failed'\n    };\n    let referenceId = undefined;\n    const firstWord = this.safeString(words, 0);\n    const thirdWord = this.safeString(words, 2);\n    const fourthWord = this.safeString(words, 3);\n    let type = this.safeString(types, firstWord, undefined);\n\n    if (type === undefined && thirdWord === 'fee') {\n      type = 'fee';\n    }\n\n    if (type === 'reserved' && fourthWord === 'order') {\n      referenceId = this.safeString(words, 4);\n    }\n\n    return {\n      'type': type,\n      'referenceId': referenceId\n    };\n  }\n\n  parseLedgerEntry(entry, currency = undefined) {\n    // const details = this.safeValue (entry, 'details', {});\n    const id = this.safeString(entry, 'row_index');\n    const account_id = this.safeString(entry, 'account_id');\n    const timestamp = this.safeValue(entry, 'timestamp');\n    const currencyId = this.safeString(entry, 'currency');\n    const code = this.safeCurrencyCode(currencyId, currency);\n    const available_delta = this.safeFloat(entry, 'available_delta');\n    const balance_delta = this.safeFloat(entry, 'balance_delta');\n    const after = this.safeFloat(entry, 'balance');\n    const comment = this.safeString(entry, 'description');\n    let before = after;\n    let amount = 0.0;\n    const result = this.parseLedgerComment(comment);\n    const type = result['type'];\n    const referenceId = result['referenceId'];\n    let direction = undefined;\n    let status = undefined;\n\n    if (balance_delta !== 0.0) {\n      before = after - balance_delta; // TODO: float precision\n\n      status = 'ok';\n      amount = Math.abs(balance_delta);\n    } else if (available_delta < 0.0) {\n      status = 'pending';\n      amount = Math.abs(available_delta);\n    } else if (available_delta > 0.0) {\n      status = 'canceled';\n      amount = Math.abs(available_delta);\n    }\n\n    if (balance_delta > 0 || available_delta > 0) {\n      direction = 'in';\n    } else if (balance_delta < 0 || available_delta < 0) {\n      direction = 'out';\n    }\n\n    return {\n      'id': id,\n      'direction': direction,\n      'account': account_id,\n      'referenceId': referenceId,\n      'referenceAccount': undefined,\n      'type': type,\n      'currency': code,\n      'amount': amount,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'before': before,\n      'after': after,\n      'status': status,\n      'fee': undefined,\n      'info': entry\n    };\n  }\n\n  sign(path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n    let url = this.urls['api'][api] + '/' + this.version + '/' + this.implodeParams(path, params);\n    const query = this.omit(params, this.extractParams(path));\n\n    if (Object.keys(query).length) {\n      url += '?' + this.urlencode(query);\n    }\n\n    if (api === 'private') {\n      this.checkRequiredCredentials();\n      const auth = this.stringToBase64(this.apiKey + ':' + this.secret);\n      headers = {\n        'Authorization': 'Basic ' + this.decode(auth)\n      };\n    }\n\n    return {\n      'url': url,\n      'method': method,\n      'body': body,\n      'headers': headers\n    };\n  }\n\n  async request(path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n    const response = await this.fetch2(path, api, method, params, headers, body);\n\n    if ('error' in response) {\n      throw new ExchangeError(this.id + ' ' + this.json(response));\n    }\n\n    return response;\n  }\n\n};","map":{"version":3,"sources":["C:/Users/senya/Documents/Coding/React Projects/react-stock-ticker/node_modules/ccxt/js/luno.js"],"names":["Exchange","require","ExchangeError","ArgumentsRequired","module","exports","luno","describe","deepExtend","fetchMarkets","params","response","exchangeGetMarkets","result","markets","safeValue","i","length","market","id","safeString","baseId","quoteId","base","safeCurrencyCode","quote","symbol","status","active","precision","safeInteger","push","safeFloat","undefined","fetchAccounts","privateGetBalance","wallets","account","accountId","currencyId","code","fetchBalance","loadMarkets","wallet","reserved","unconfirmed","balance","sum","parseBalance","fetchOrderBook","limit","method","request","marketId","extend","timestamp","parseOrderBook","parseOrderStatus","statuses","parseOrder","order","side","safeSymbol","price","amount","quoteFee","baseFee","filled","cost","remaining","Math","max","fee","iso8601","fetchOrder","privateGetOrdersId","fetchOrdersByState","state","since","privateGetListorders","orders","parseOrders","fetchOrders","fetchOpenOrders","fetchClosedOrders","parseTicker","ticker","last","fetchTickers","symbols","publicGetTickers","tickers","indexBy","ids","Object","keys","safeMarket","filterByArray","fetchTicker","publicGetTicker","parseTrade","trade","orderId","takerOrMaker","feeBase","feeCounter","feeCurrency","feeCost","fetchTrades","publicGetTrades","trades","parseTrades","fetchMyTrades","privateGetListtrades","fetchTradingFees","privateGetFeeInfo","createOrder","type","toUpperCase","cancelOrder","privatePostStoporder","fetchLedgerByEntries","entry","fetchLedger","loadAccounts","currency","min_row","max_row","accountsByCurrencyCode","accounts","privateGetAccountsIdTransactions","entries","parseLedger","parseLedgerComment","comment","words","split","types","referenceId","firstWord","thirdWord","fourthWord","parseLedgerEntry","account_id","available_delta","balance_delta","after","before","direction","abs","sign","path","api","headers","body","url","urls","version","implodeParams","query","omit","extractParams","urlencode","checkRequiredCredentials","auth","stringToBase64","apiKey","secret","decode","fetch2","json"],"mappings":"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","sourcesContent":["'use strict';\n\n//  ---------------------------------------------------------------------------\n\nconst Exchange = require ('./base/Exchange');\nconst { ExchangeError, ArgumentsRequired } = require ('./base/errors');\n\n//  ---------------------------------------------------------------------------\n\nmodule.exports = class luno extends Exchange {\n    describe () {\n        return this.deepExtend (super.describe (), {\n            'id': 'luno',\n            'name': 'luno',\n            'countries': [ 'GB', 'SG', 'ZA' ],\n            'rateLimit': 1000,\n            'version': '1',\n            'has': {\n                'cancelOrder': true,\n                'CORS': false,\n                'createOrder': true,\n                'fetchAccounts': true,\n                'fetchBalance': true,\n                'fetchClosedOrders': true,\n                'fetchLedger': true,\n                'fetchMarkets': true,\n                'fetchMyTrades': true,\n                'fetchOpenOrders': true,\n                'fetchOrder': true,\n                'fetchOrderBook': true,\n                'fetchOrders': true,\n                'fetchTicker': true,\n                'fetchTickers': true,\n                'fetchTrades': true,\n                'fetchTradingFee': true,\n                'fetchTradingFees': true,\n            },\n            'urls': {\n                'referral': 'https://www.luno.com/invite/44893A',\n                'logo': 'https://user-images.githubusercontent.com/1294454/27766607-8c1a69d8-5ede-11e7-930c-540b5eb9be24.jpg',\n                'api': {\n                    'public': 'https://api.luno.com/api',\n                    'private': 'https://api.luno.com/api',\n                    'exchange': 'https://api.luno.com/api/exchange',\n                },\n                'www': 'https://www.luno.com',\n                'doc': [\n                    'https://www.luno.com/en/api',\n                    'https://npmjs.org/package/bitx',\n                    'https://github.com/bausmeier/node-bitx',\n                ],\n            },\n            'api': {\n                'exchange': {\n                    'get': [\n                        'markets',\n                    ],\n                },\n                'public': {\n                    'get': [\n                        'orderbook',\n                        'orderbook_top',\n                        'ticker',\n                        'tickers',\n                        'trades',\n                    ],\n                },\n                'private': {\n                    'get': [\n                        'accounts/{id}/pending',\n                        'accounts/{id}/transactions',\n                        'balance',\n                        'beneficiaries',\n                        'fee_info',\n                        'funding_address',\n                        'listorders',\n                        'listtrades',\n                        'orders/{id}',\n                        'quotes/{id}',\n                        'withdrawals',\n                        'withdrawals/{id}',\n                    ],\n                    'post': [\n                        'accounts',\n                        'accounts/{id}/name',\n                        'postorder',\n                        'marketorder',\n                        'stoporder',\n                        'funding_address',\n                        'withdrawals',\n                        'send',\n                        'quotes',\n                        'oauth2/grant',\n                    ],\n                    'put': [\n                        'accounts/{id}/name',\n                        'quotes/{id}',\n                    ],\n                    'delete': [\n                        'quotes/{id}',\n                        'withdrawals/{id}',\n                    ],\n                },\n            },\n        });\n    }\n\n    async fetchMarkets (params = {}) {\n        const response = await this.exchangeGetMarkets (params);\n        //\n        //     {\n        //         \"markets\":[\n        //             {\n        //                 \"market_id\":\"BCHXBT\",\n        //                 \"trading_status\":\"ACTIVE\",\n        //                 \"base_currency\":\"BCH\",\n        //                 \"counter_currency\":\"XBT\",\n        //                 \"min_volume\":\"0.01\",\n        //                 \"max_volume\":\"100.00\",\n        //                 \"volume_scale\":2,\n        //                 \"min_price\":\"0.0001\",\n        //                 \"max_price\":\"1.00\",\n        //                 \"price_scale\":6,\n        //                 \"fee_scale\":8,\n        //             },\n        //         ]\n        //     }\n        //\n        const result = [];\n        const markets = this.safeValue (response, 'markets', []);\n        for (let i = 0; i < markets.length; i++) {\n            const market = markets[i];\n            const id = this.safeString (market, 'market_id');\n            const baseId = this.safeString (market, 'base_currency');\n            const quoteId = this.safeString (market, 'counter_currency');\n            const base = this.safeCurrencyCode (baseId);\n            const quote = this.safeCurrencyCode (quoteId);\n            const symbol = base + '/' + quote;\n            const status = this.safeString (market, 'trading_status');\n            const active = (status === 'ACTIVE');\n            const precision = {\n                'amount': this.safeInteger (market, 'volume_scale'),\n                'price': this.safeInteger (market, 'price_scale'),\n            };\n            result.push ({\n                'id': id,\n                'symbol': symbol,\n                'base': base,\n                'quote': quote,\n                'baseId': baseId,\n                'quoteId': quoteId,\n                'active': active,\n                'precision': precision,\n                'limits': {\n                    'amount': {\n                        'min': this.safeFloat (market, 'min_volume'),\n                        'max': this.safeFloat (market, 'max_volume'),\n                    },\n                    'price': {\n                        'min': this.safeFloat (market, 'min_price'),\n                        'max': this.safeFloat (market, 'max_price'),\n                    },\n                    'cost': {\n                        'min': undefined,\n                        'max': undefined,\n                    },\n                },\n                'info': market,\n            });\n        }\n        return result;\n    }\n\n    async fetchAccounts (params = {}) {\n        const response = await this.privateGetBalance (params);\n        const wallets = this.safeValue (response, 'balance', []);\n        const result = [];\n        for (let i = 0; i < wallets.length; i++) {\n            const account = wallets[i];\n            const accountId = this.safeString (account, 'account_id');\n            const currencyId = this.safeString (account, 'asset');\n            const code = this.safeCurrencyCode (currencyId);\n            result.push ({\n                'id': accountId,\n                'type': undefined,\n                'currency': code,\n                'info': account,\n            });\n        }\n        return result;\n    }\n\n    async fetchBalance (params = {}) {\n        await this.loadMarkets ();\n        const response = await this.privateGetBalance (params);\n        //\n        //     {\n        //         'balance': [\n        //             {'account_id': '119...1336','asset': 'XBT','balance': '0.00','reserved': '0.00','unconfirmed': '0.00'},\n        //             {'account_id': '66...289','asset': 'XBT','balance': '0.00','reserved': '0.00','unconfirmed': '0.00'},\n        //             {'account_id': '718...5300','asset': 'ETH','balance': '0.00','reserved': '0.00','unconfirmed': '0.00'},\n        //             {'account_id': '818...7072','asset': 'ZAR','balance': '0.001417','reserved': '0.00','unconfirmed': '0.00'}]}\n        //         ]\n        //     }\n        //\n        const wallets = this.safeValue (response, 'balance', []);\n        const result = { 'info': response };\n        for (let i = 0; i < wallets.length; i++) {\n            const wallet = wallets[i];\n            const currencyId = this.safeString (wallet, 'asset');\n            const code = this.safeCurrencyCode (currencyId);\n            const reserved = this.safeFloat (wallet, 'reserved');\n            const unconfirmed = this.safeFloat (wallet, 'unconfirmed');\n            const balance = this.safeFloat (wallet, 'balance');\n            if (code in result) {\n                result[code]['used'] = this.sum (result[code]['used'], reserved, unconfirmed);\n                result[code]['total'] = this.sum (result[code]['total'], balance, unconfirmed);\n            } else {\n                const account = this.account ();\n                account['used'] = this.sum (reserved, unconfirmed);\n                account['total'] = this.sum (balance, unconfirmed);\n                result[code] = account;\n            }\n        }\n        return this.parseBalance (result);\n    }\n\n    async fetchOrderBook (symbol, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        let method = 'publicGetOrderbook';\n        if (limit !== undefined) {\n            if (limit <= 100) {\n                method += 'Top'; // get just the top of the orderbook when limit is low\n            }\n        }\n        const request = {\n            'pair': this.marketId (symbol),\n        };\n        const response = await this[method] (this.extend (request, params));\n        const timestamp = this.safeInteger (response, 'timestamp');\n        return this.parseOrderBook (response, timestamp, 'bids', 'asks', 'price', 'volume');\n    }\n\n    parseOrderStatus (status) {\n        const statuses = {\n            // todo add other statuses\n            'PENDING': 'open',\n        };\n        return this.safeString (statuses, status, status);\n    }\n\n    parseOrder (order, market = undefined) {\n        //\n        //     {\n        //         \"base\": \"string\",\n        //         \"completed_timestamp\": \"string\",\n        //         \"counter\": \"string\",\n        //         \"creation_timestamp\": \"string\",\n        //         \"expiration_timestamp\": \"string\",\n        //         \"fee_base\": \"string\",\n        //         \"fee_counter\": \"string\",\n        //         \"limit_price\": \"string\",\n        //         \"limit_volume\": \"string\",\n        //         \"order_id\": \"string\",\n        //         \"pair\": \"string\",\n        //         \"state\": \"PENDING\",\n        //         \"type\": \"BID\"\n        //     }\n        //\n        const timestamp = this.safeInteger (order, 'creation_timestamp');\n        let status = this.parseOrderStatus (this.safeString (order, 'state'));\n        status = (status === 'open') ? status : status;\n        const side = (order['type'] === 'ASK') ? 'sell' : 'buy';\n        const marketId = this.safeString (order, 'pair');\n        const symbol = this.safeSymbol (marketId, market);\n        const price = this.safeFloat (order, 'limit_price');\n        const amount = this.safeFloat (order, 'limit_volume');\n        const quoteFee = this.safeFloat (order, 'fee_counter');\n        const baseFee = this.safeFloat (order, 'fee_base');\n        const filled = this.safeFloat (order, 'base');\n        const cost = this.safeFloat (order, 'counter');\n        let remaining = undefined;\n        if (amount !== undefined) {\n            if (filled !== undefined) {\n                remaining = Math.max (0, amount - filled);\n            }\n        }\n        const fee = { 'currency': undefined };\n        if (quoteFee) {\n            fee['cost'] = quoteFee;\n            if (market !== undefined) {\n                fee['currency'] = market['quote'];\n            }\n        } else {\n            fee['cost'] = baseFee;\n            if (market !== undefined) {\n                fee['currency'] = market['base'];\n            }\n        }\n        const id = this.safeString (order, 'order_id');\n        return {\n            'id': id,\n            'clientOrderId': undefined,\n            'datetime': this.iso8601 (timestamp),\n            'timestamp': timestamp,\n            'lastTradeTimestamp': undefined,\n            'status': status,\n            'symbol': symbol,\n            'type': undefined,\n            'timeInForce': undefined,\n            'postOnly': undefined,\n            'side': side,\n            'price': price,\n            'stopPrice': undefined,\n            'amount': amount,\n            'filled': filled,\n            'cost': cost,\n            'remaining': remaining,\n            'trades': undefined,\n            'fee': fee,\n            'info': order,\n            'average': undefined,\n        };\n    }\n\n    async fetchOrder (id, symbol = undefined, params = {}) {\n        await this.loadMarkets ();\n        const request = {\n            'id': id,\n        };\n        const response = await this.privateGetOrdersId (this.extend (request, params));\n        return this.parseOrder (response);\n    }\n\n    async fetchOrdersByState (state = undefined, symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        const request = {};\n        let market = undefined;\n        if (state !== undefined) {\n            request['state'] = state;\n        }\n        if (symbol !== undefined) {\n            market = this.market (symbol);\n            request['pair'] = market['id'];\n        }\n        const response = await this.privateGetListorders (this.extend (request, params));\n        const orders = this.safeValue (response, 'orders', []);\n        return this.parseOrders (orders, market, since, limit);\n    }\n\n    async fetchOrders (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        return await this.fetchOrdersByState (undefined, symbol, since, limit, params);\n    }\n\n    async fetchOpenOrders (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        return await this.fetchOrdersByState ('PENDING', symbol, since, limit, params);\n    }\n\n    async fetchClosedOrders (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        return await this.fetchOrdersByState ('COMPLETE', symbol, since, limit, params);\n    }\n\n    parseTicker (ticker, market = undefined) {\n        const timestamp = this.safeInteger (ticker, 'timestamp');\n        let symbol = undefined;\n        if (market) {\n            symbol = market['symbol'];\n        }\n        const last = this.safeFloat (ticker, 'last_trade');\n        return {\n            'symbol': symbol,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'high': undefined,\n            'low': undefined,\n            'bid': this.safeFloat (ticker, 'bid'),\n            'bidVolume': undefined,\n            'ask': this.safeFloat (ticker, 'ask'),\n            'askVolume': undefined,\n            'vwap': undefined,\n            'open': undefined,\n            'close': last,\n            'last': last,\n            'previousClose': undefined,\n            'change': undefined,\n            'percentage': undefined,\n            'average': undefined,\n            'baseVolume': this.safeFloat (ticker, 'rolling_24_hour_volume'),\n            'quoteVolume': undefined,\n            'info': ticker,\n        };\n    }\n\n    async fetchTickers (symbols = undefined, params = {}) {\n        await this.loadMarkets ();\n        const response = await this.publicGetTickers (params);\n        const tickers = this.indexBy (response['tickers'], 'pair');\n        const ids = Object.keys (tickers);\n        const result = {};\n        for (let i = 0; i < ids.length; i++) {\n            const id = ids[i];\n            const market = this.safeMarket (id);\n            const symbol = market['symbol'];\n            const ticker = tickers[id];\n            result[symbol] = this.parseTicker (ticker, market);\n        }\n        return this.filterByArray (result, 'symbol', symbols);\n    }\n\n    async fetchTicker (symbol, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'pair': market['id'],\n        };\n        const response = await this.publicGetTicker (this.extend (request, params));\n        return this.parseTicker (response, market);\n    }\n\n    parseTrade (trade, market) {\n        // For public trade data (is_buy === True) indicates 'buy' side but for private trade data\n        // is_buy indicates maker or taker. The value of \"type\" (ASK/BID) indicate sell/buy side.\n        // Private trade data includes ID field which public trade data does not.\n        const orderId = this.safeString (trade, 'order_id');\n        let takerOrMaker = undefined;\n        let side = undefined;\n        if (orderId !== undefined) {\n            side = (trade['type'] === 'ASK') ? 'sell' : 'buy';\n            if (side === 'sell' && trade['is_buy']) {\n                takerOrMaker = 'maker';\n            } else if (side === 'buy' && !trade['is_buy']) {\n                takerOrMaker = 'maker';\n            } else {\n                takerOrMaker = 'taker';\n            }\n        } else {\n            side = trade['is_buy'] ? 'buy' : 'sell';\n        }\n        const feeBase = this.safeFloat (trade, 'fee_base');\n        const feeCounter = this.safeFloat (trade, 'fee_counter');\n        let feeCurrency = undefined;\n        let feeCost = undefined;\n        if (feeBase !== undefined) {\n            if (feeBase !== 0.0) {\n                feeCurrency = market['base'];\n                feeCost = feeBase;\n            }\n        } else if (feeCounter !== undefined) {\n            if (feeCounter !== 0.0) {\n                feeCurrency = market['quote'];\n                feeCost = feeCounter;\n            }\n        }\n        const timestamp = this.safeInteger (trade, 'timestamp');\n        return {\n            'info': trade,\n            'id': undefined,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'symbol': market['symbol'],\n            'order': orderId,\n            'type': undefined,\n            'side': side,\n            'takerOrMaker': takerOrMaker,\n            'price': this.safeFloat (trade, 'price'),\n            'amount': this.safeFloat (trade, 'volume'),\n            // Does not include potential fee costs\n            'cost': this.safeFloat (trade, 'counter'),\n            'fee': {\n                'cost': feeCost,\n                'currency': feeCurrency,\n            },\n        };\n    }\n\n    async fetchTrades (symbol, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'pair': market['id'],\n        };\n        if (since !== undefined) {\n            request['since'] = since;\n        }\n        const response = await this.publicGetTrades (this.extend (request, params));\n        const trades = this.safeValue (response, 'trades', []);\n        return this.parseTrades (trades, market, since, limit);\n    }\n\n    async fetchMyTrades (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        if (symbol === undefined) {\n            throw new ArgumentsRequired (this.id + ' fetchMyTrades requires a symbol argument');\n        }\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'pair': market['id'],\n        };\n        if (since !== undefined) {\n            request['since'] = since;\n        }\n        if (limit !== undefined) {\n            request['limit'] = limit;\n        }\n        const response = await this.privateGetListtrades (this.extend (request, params));\n        const trades = this.safeValue (response, 'trades', []);\n        return this.parseTrades (trades, market, since, limit);\n    }\n\n    async fetchTradingFees (params = {}) {\n        await this.loadMarkets ();\n        const response = await this.privateGetFeeInfo (params);\n        return {\n            'info': response,\n            'maker': this.safeFloat (response, 'maker_fee'),\n            'taker': this.safeFloat (response, 'taker_fee'),\n        };\n    }\n\n    async createOrder (symbol, type, side, amount, price = undefined, params = {}) {\n        await this.loadMarkets ();\n        let method = 'privatePost';\n        const request = {\n            'pair': this.marketId (symbol),\n        };\n        if (type === 'market') {\n            method += 'Marketorder';\n            request['type'] = side.toUpperCase ();\n            if (side === 'buy') {\n                request['counter_volume'] = amount;\n            } else {\n                request['base_volume'] = amount;\n            }\n        } else {\n            method += 'Postorder';\n            request['volume'] = amount;\n            request['price'] = price;\n            request['type'] = (side === 'buy') ? 'BID' : 'ASK';\n        }\n        const response = await this[method] (this.extend (request, params));\n        return {\n            'info': response,\n            'id': response['order_id'],\n        };\n    }\n\n    async cancelOrder (id, symbol = undefined, params = {}) {\n        await this.loadMarkets ();\n        const request = {\n            'order_id': id,\n        };\n        return await this.privatePostStoporder (this.extend (request, params));\n    }\n\n    async fetchLedgerByEntries (code = undefined, entry = -1, limit = 1, params = {}) {\n        // by default without entry number or limit number, return most recent entry\n        const since = undefined;\n        const request = {\n            'min_row': entry,\n            'max_row': this.sum (entry, limit),\n        };\n        return await this.fetchLedger (code, since, limit, this.extend (request, params));\n    }\n\n    async fetchLedger (code = undefined, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        await this.loadAccounts ();\n        let currency = undefined;\n        let id = this.safeString (params, 'id'); // account id\n        let min_row = this.safeValue (params, 'min_row');\n        let max_row = this.safeValue (params, 'max_row');\n        if (id === undefined) {\n            if (code === undefined) {\n                throw new ArgumentsRequired (this.id + ' fetchLedger() requires a currency code argument if no account id specified in params');\n            }\n            currency = this.currency (code);\n            const accountsByCurrencyCode = this.indexBy (this.accounts, 'currency');\n            const account = this.safeValue (accountsByCurrencyCode, code);\n            if (account === undefined) {\n                throw new ExchangeError (this.id + ' fetchLedger() could not find account id for ' + code);\n            }\n            id = account['id'];\n        }\n        if (min_row === undefined && max_row === undefined) {\n            max_row = 0; // Default to most recent transactions\n            min_row = -1000; // Maximum number of records supported\n        } else if (min_row === undefined || max_row === undefined) {\n            throw new ExchangeError (this.id + \" fetchLedger() require both params 'max_row' and 'min_row' or neither to be defined\");\n        }\n        if (limit !== undefined && max_row - min_row > limit) {\n            if (max_row <= 0) {\n                min_row = max_row - limit;\n            } else if (min_row > 0) {\n                max_row = min_row + limit;\n            }\n        }\n        if (max_row - min_row > 1000) {\n            throw new ExchangeError (this.id + \" fetchLedger() requires the params 'max_row' - 'min_row' <= 1000\");\n        }\n        const request = {\n            'id': id,\n            'min_row': min_row,\n            'max_row': max_row,\n        };\n        const response = await this.privateGetAccountsIdTransactions (this.extend (params, request));\n        const entries = this.safeValue (response, 'transactions', []);\n        return this.parseLedger (entries, currency, since, limit);\n    }\n\n    parseLedgerComment (comment) {\n        const words = comment.split (' ');\n        const types = {\n            'Withdrawal': 'fee',\n            'Trading': 'fee',\n            'Payment': 'transaction',\n            'Sent': 'transaction',\n            'Deposit': 'transaction',\n            'Received': 'transaction',\n            'Released': 'released',\n            'Reserved': 'reserved',\n            'Sold': 'trade',\n            'Bought': 'trade',\n            'Failure': 'failed',\n        };\n        let referenceId = undefined;\n        const firstWord = this.safeString (words, 0);\n        const thirdWord = this.safeString (words, 2);\n        const fourthWord = this.safeString (words, 3);\n        let type = this.safeString (types, firstWord, undefined);\n        if ((type === undefined) && (thirdWord === 'fee')) {\n            type = 'fee';\n        }\n        if ((type === 'reserved') && (fourthWord === 'order')) {\n            referenceId = this.safeString (words, 4);\n        }\n        return {\n            'type': type,\n            'referenceId': referenceId,\n        };\n    }\n\n    parseLedgerEntry (entry, currency = undefined) {\n        // const details = this.safeValue (entry, 'details', {});\n        const id = this.safeString (entry, 'row_index');\n        const account_id = this.safeString (entry, 'account_id');\n        const timestamp = this.safeValue (entry, 'timestamp');\n        const currencyId = this.safeString (entry, 'currency');\n        const code = this.safeCurrencyCode (currencyId, currency);\n        const available_delta = this.safeFloat (entry, 'available_delta');\n        const balance_delta = this.safeFloat (entry, 'balance_delta');\n        const after = this.safeFloat (entry, 'balance');\n        const comment = this.safeString (entry, 'description');\n        let before = after;\n        let amount = 0.0;\n        const result = this.parseLedgerComment (comment);\n        const type = result['type'];\n        const referenceId = result['referenceId'];\n        let direction = undefined;\n        let status = undefined;\n        if (balance_delta !== 0.0) {\n            before = after - balance_delta; // TODO: float precision\n            status = 'ok';\n            amount = Math.abs (balance_delta);\n        } else if (available_delta < 0.0) {\n            status = 'pending';\n            amount = Math.abs (available_delta);\n        } else if (available_delta > 0.0) {\n            status = 'canceled';\n            amount = Math.abs (available_delta);\n        }\n        if (balance_delta > 0 || available_delta > 0) {\n            direction = 'in';\n        } else if (balance_delta < 0 || available_delta < 0) {\n            direction = 'out';\n        }\n        return {\n            'id': id,\n            'direction': direction,\n            'account': account_id,\n            'referenceId': referenceId,\n            'referenceAccount': undefined,\n            'type': type,\n            'currency': code,\n            'amount': amount,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'before': before,\n            'after': after,\n            'status': status,\n            'fee': undefined,\n            'info': entry,\n        };\n    }\n\n    sign (path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n        let url = this.urls['api'][api] + '/' + this.version + '/' + this.implodeParams (path, params);\n        const query = this.omit (params, this.extractParams (path));\n        if (Object.keys (query).length) {\n            url += '?' + this.urlencode (query);\n        }\n        if (api === 'private') {\n            this.checkRequiredCredentials ();\n            const auth = this.stringToBase64 (this.apiKey + ':' + this.secret);\n            headers = {\n                'Authorization': 'Basic ' + this.decode (auth),\n            };\n        }\n        return { 'url': url, 'method': method, 'body': body, 'headers': headers };\n    }\n\n    async request (path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n        const response = await this.fetch2 (path, api, method, params, headers, body);\n        if ('error' in response) {\n            throw new ExchangeError (this.id + ' ' + this.json (response));\n        }\n        return response;\n    }\n};\n"]},"metadata":{},"sourceType":"script"}