{"ast":null,"code":"var os = require('os');\n\nvar util = require('util');\n\nvar _ = require('lodash');\n\nvar S = require('string');\n\nvar moment = require('moment');\n\nvar Promise = require('bluebird');\n\nvar _constants = require('./constants');\n\nvar _fields = require('./snapshotFields');\n\nvar _utils = require('./utils');\n\nvar getCrumb = require('./yahooCrumb').getCrumb;\n\nvar dateFields = require('./quote').dateFields;\n\nvar FIELDS_MAP_GITHUB_URL = 'https://github.com/pilwon/node-yahoo-finance/blob/master/lib/snapshotFields.js#L111'; // Fields from the old API that can be mapped to the current data\n\nvar mappedFields = _.filter(_.keys(_fields._map), function (field) {\n  return !!_fields._map[field];\n});\n\nvar requiredModuleForField = {};\n\n_.each(mappedFields, function (field) {\n  requiredModuleForField[field] = _fields._map[field].split('.')[0];\n}); // Given a list of fields, return the names of all the modules needed to\n// supply them.\n\n\nfunction requiredModulesForFields(fields) {\n  var modules = [];\n\n  _.each(fields, function (field) {\n    var module = requiredModuleForField[field];\n    if (modules.indexOf(module) === -1) modules.push(module);\n  });\n\n  return modules;\n}\n\nvar shownWarning = false;\n\nfunction _sanitizeSnapshotOptions(options) {\n  if (!_.isPlainObject(options)) {\n    throw new Error('\"options\" must be a plain object.');\n  }\n\n  if (_.isUndefined(options.symbol) && _.isUndefined(options.symbols)) {\n    throw new Error('Either \"options.symbol\" or \"options.symbols\" must be defined.');\n  }\n\n  if (!_.isUndefined(options.symbol) && !_.isUndefined(options.symbols)) {\n    throw new Error('Either \"options.symbol\" or \"options.symbols\" must be undefined.');\n  }\n\n  if (!_.isUndefined(options.symbol)) {\n    if (!_.isString(options.symbol) || _.isEmpty(options.symbol)) {\n      throw new Error('\"options.symbol\" must be a non-empty string.');\n    }\n  } else {\n    if (!_.isArray(options.symbols) || _.isEmpty(options.symbols)) {\n      throw new Error('\"options.symbols\" must be a non-empty string array.');\n    }\n  }\n\n  if ((!_.isArray(options.fields) || _.isEmpty(options.fields)) && !_.isUndefined(options.fields)) {\n    throw new Error('\"options.fields\" must be a non-empty string array or undefined.');\n  }\n\n  if (options.fields) {\n    var unavailable = _.difference(options.fields, mappedFields);\n\n    if (unavailable.length) throw new Error(\"[yahoo-finance] snapshot(): The following fields \" + \"are no longer available in Yahoo's new API: \" + JSON.stringify(unavailable) + \".  See if you can find something similar in the new quote() API, \" + \"otherwise unfortunately, you are out of luck.  Yahoo ended support \" + \"for their developer API some time ago and made no guarantees to \" + \"maintain that API.  You may want to also check our mapping function \" + \"at \" + FIELDS_MAP_GITHUB_URL);\n\n    if (!shownWarning) {\n      console.warn(\"[yahoo-finance] snapshot() has been deprecated.  The \" + \"Yahoo Finance API has fundamentally changed recently.  We will \" + \"attempt to map the requested fields from the new API according to \" + FIELDS_MAP_GITHUB_URL + \".  Please double check this map and your results to ensure \" + \"consistency.  This warning will only be shown once.\");\n      shownWarning = true;\n    }\n  } else {\n    if (!options.ignoreAllFieldsWarning) {\n      throw new Error(\"[yahoo-finance] snapshot(): No `fields` property was \" + \"given.  This used to return all fields available, but not all these \" + \"fields are available in Yahoo's new API.  We suggest you update \" + \"your code to use the new quote() API instead.  However, you can \" + \"simply specify the exact fields you need, and they'll be fetched if \" + \"available.  Alternative, pass { ignoreAllFieldsWarning: true } and \" + \"all available fields (from the new API) will be returned.  You can \" + \"see the full list of available mappings at \" + FIELDS_MAP_GITHUB_URL);\n    } else {\n      // fetch all fields if undefined\n      options.fields = mappedFields;\n    }\n  }\n\n  options.modules = requiredModulesForFields(options.fields);\n}\n\nfunction _transformSnapshot(fields, symbols, data) {\n  var quoteSummary = data.quoteSummary;\n  if (!quoteSummary || quoteSummary.error) throw new Error(quoteSummary.error);\n  var result = quoteSummary.result;\n  if (!_.isArray(result) || result.length > 1) throw new Error(\"quoteSummary format has changed, please report this.\");\n  result = result[0]; // for 'n', store 'name' from result.price.name, etc.\n  // for arrays like 'c', combine values into an array\n\n  var out = {};\n\n  _.each(fields, function (field) {\n    // map { c: 'price.regularMarketChange,price.regularMarketChangePercent' }\n    if (_fields._map[field].indexOf(',') > 0) {\n      var dest = out[_utils.camelize(_fields[field])] = [];\n\n      _.map(_fields._map[field].split(','), function (map) {\n        // 'price.symbol' => ['price','symbol']\n        map = map.split('.');\n        dest.push(result[map[0]][map[1]]); // Assumption: no arrays use date fields (currently true)\n      });\n    } else {\n      // 'price.symbol' => ['price','symbol']\n      var map = _fields._map[field].split('.');\n\n      var value = result[map[0]][map[1]];\n      if (dateFields[map[0]] && dateFields[map[0]].indexOf(map[1]) !== -1) value = new Date(value * 1000);\n      out[_utils.camelize(_fields[field])] = value;\n    }\n  });\n\n  return out;\n}\n\nfunction snapshot(options, optionalHttpRequestOptions, cb) {\n  var symbols = options.symbols || _.flatten([options.symbol]);\n\n  options = _.clone(options);\n\n  _sanitizeSnapshotOptions(options);\n\n  if (optionalHttpRequestOptions && typeof optionalHttpRequestOptions == 'function') {\n    cb = optionalHttpRequestOptions;\n    optionalHttpRequestOptions = {};\n  } else if (!optionalHttpRequestOptions) {\n    optionalHttpRequestOptions = {};\n  }\n\n  optionalHttpRequestOptions.json = true;\n  return getCrumb(symbols[0]).then(function (crumb) {\n    return Promise.map(symbols, function (symbol) {\n      var url = _constants.SNAPSHOT_URL.replace(/\\$SYMBOL/, symbol);\n\n      return _utils.download(url, {\n        formatted: 'false',\n        crumb: crumb,\n        modules: options.modules.join(','),\n        corsDomain: 'finance.yahoo.com'\n      }, optionalHttpRequestOptions).then(function (data) {\n        return _transformSnapshot(options.fields, symbols, data);\n      });\n    }, {\n      concurrency: options.maxConcurrentSymbols || os.cpus().length\n    }).then(function (results) {\n      if (options.symbols) {\n        return _.zipObject(symbols, results);\n      } else {\n        return results[0];\n      }\n    }).catch(function (err) {\n      throw new Error(util.format('Failed to download data (%s)', err.message));\n    }).nodeify(cb);\n  });\n} // API (ES6 syntax with default export)\n\n\nexports.__esModule = true;\nexports.default = snapshot; // For testing\n\nexports.mappedFields = mappedFields;","map":{"version":3,"sources":["C:/Users/senya/Documents/Coding/React Projects/react-stock-ticker/node_modules/yahoo-finance/lib/snapshot.js"],"names":["os","require","util","_","S","moment","Promise","_constants","_fields","_utils","getCrumb","dateFields","FIELDS_MAP_GITHUB_URL","mappedFields","filter","keys","_map","field","requiredModuleForField","each","split","requiredModulesForFields","fields","modules","module","indexOf","push","shownWarning","_sanitizeSnapshotOptions","options","isPlainObject","Error","isUndefined","symbol","symbols","isString","isEmpty","isArray","unavailable","difference","length","JSON","stringify","console","warn","ignoreAllFieldsWarning","_transformSnapshot","data","quoteSummary","error","result","out","dest","camelize","map","value","Date","snapshot","optionalHttpRequestOptions","cb","flatten","clone","json","then","crumb","url","SNAPSHOT_URL","replace","download","formatted","join","corsDomain","concurrency","maxConcurrentSymbols","cpus","results","zipObject","catch","err","format","message","nodeify","exports","__esModule","default"],"mappings":"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","sourcesContent":["var os = require('os');\nvar util = require('util');\n\nvar _ = require('lodash');\nvar S = require('string');\nvar moment = require('moment');\nvar Promise = require('bluebird');\n\nvar _constants = require('./constants');\nvar _fields = require('./snapshotFields');\nvar _utils = require('./utils');\nvar getCrumb = require('./yahooCrumb').getCrumb;\n\nvar dateFields = require('./quote').dateFields;\n\nvar FIELDS_MAP_GITHUB_URL = 'https://github.com/pilwon/node-yahoo-finance/blob/master/lib/snapshotFields.js#L111';\n\n// Fields from the old API that can be mapped to the current data\nvar mappedFields = _.filter(_.keys(_fields._map), function(field) {\n  return !!_fields._map[field]\n});\n\nvar requiredModuleForField = {};\n_.each(mappedFields, function(field) {\n  requiredModuleForField[field] = _fields._map[field].split('.')[0];\n});\n\n// Given a list of fields, return the names of all the modules needed to\n// supply them.\nfunction requiredModulesForFields(fields) {\n  var modules = [];\n  _.each(fields, function(field) {\n    var module = requiredModuleForField[field];\n    if (modules.indexOf(module) === -1)\n      modules.push(module);\n  });\n  return modules;\n}\n\nvar shownWarning = false;\n\nfunction _sanitizeSnapshotOptions(options) {\n  if (!_.isPlainObject(options)) {\n    throw new Error('\"options\" must be a plain object.');\n  }\n  if (_.isUndefined(options.symbol) && _.isUndefined(options.symbols)) {\n    throw new Error('Either \"options.symbol\" or \"options.symbols\" must be defined.');\n  }\n  if (!_.isUndefined(options.symbol) && !_.isUndefined(options.symbols)) {\n    throw new Error('Either \"options.symbol\" or \"options.symbols\" must be undefined.');\n  }\n\n  if (!_.isUndefined(options.symbol)) {\n    if (!_.isString(options.symbol) || _.isEmpty(options.symbol)) {\n      throw new Error('\"options.symbol\" must be a non-empty string.');\n    }\n  } else {\n    if (!_.isArray(options.symbols) || _.isEmpty(options.symbols)) {\n      throw new Error('\"options.symbols\" must be a non-empty string array.');\n    }\n  }\n\n  if ((!_.isArray(options.fields) || _.isEmpty(options.fields)) && !_.isUndefined(options.fields)) {\n    throw new Error('\"options.fields\" must be a non-empty string array or undefined.');\n  }\n\n  if (options.fields) {\n\n    var unavailable = _.difference(options.fields, mappedFields);\n    if (unavailable.length)\n      throw new Error(\"[yahoo-finance] snapshot(): The following fields \" +\n        \"are no longer available in Yahoo's new API: \" +\n        JSON.stringify(unavailable) +\n        \".  See if you can find something similar in the new quote() API, \" +\n        \"otherwise unfortunately, you are out of luck.  Yahoo ended support \" +\n        \"for their developer API some time ago and made no guarantees to \" +\n        \"maintain that API.  You may want to also check our mapping function \" +\n        \"at \" + FIELDS_MAP_GITHUB_URL);\n\n    if (!shownWarning) {\n      console.warn(\"[yahoo-finance] snapshot() has been deprecated.  The \" +\n        \"Yahoo Finance API has fundamentally changed recently.  We will \" +\n        \"attempt to map the requested fields from the new API according to \" +\n        FIELDS_MAP_GITHUB_URL +\n        \".  Please double check this map and your results to ensure \" +\n        \"consistency.  This warning will only be shown once.\");\n      shownWarning = true;\n    }\n\n  } else {\n\n    if (!options.ignoreAllFieldsWarning) {\n      throw new Error(\"[yahoo-finance] snapshot(): No `fields` property was \" +\n        \"given.  This used to return all fields available, but not all these \" +\n        \"fields are available in Yahoo's new API.  We suggest you update \" +\n        \"your code to use the new quote() API instead.  However, you can \" +\n        \"simply specify the exact fields you need, and they'll be fetched if \" +\n        \"available.  Alternative, pass { ignoreAllFieldsWarning: true } and \" +\n        \"all available fields (from the new API) will be returned.  You can \" +\n        \"see the full list of available mappings at \" + FIELDS_MAP_GITHUB_URL);\n    } else {\n      // fetch all fields if undefined\n      options.fields = mappedFields;\n    }\n\n  }\n\n  options.modules = requiredModulesForFields(options.fields);\n}\n\nfunction _transformSnapshot(fields, symbols, data) {\n  var quoteSummary = data.quoteSummary;\n  if (!quoteSummary || quoteSummary.error)\n    throw new Error(quoteSummary.error);\n\n  var result = quoteSummary.result;\n  if (!_.isArray(result) || result.length > 1)\n    throw new Error(\"quoteSummary format has changed, please report this.\");\n\n  result = result[0];\n\n  // for 'n', store 'name' from result.price.name, etc.\n  // for arrays like 'c', combine values into an array\n  var out = {};\n  _.each(fields, function(field) {\n    // map { c: 'price.regularMarketChange,price.regularMarketChangePercent' }\n    if (_fields._map[field].indexOf(',') > 0) {\n      var dest = out[_utils.camelize(_fields[field])] = [];\n      _.map(_fields._map[field].split(','), function(map) {\n        // 'price.symbol' => ['price','symbol']\n        map = map.split('.');\n        dest.push(result[map[0]][map[1]]);\n        // Assumption: no arrays use date fields (currently true)\n      });\n    } else {\n      // 'price.symbol' => ['price','symbol']\n      var map = _fields._map[field].split('.');\n      var value = result[map[0]][map[1]];\n\n      if (dateFields[map[0]] && dateFields[map[0]].indexOf(map[1]) !== -1)\n        value = new Date(value * 1000);\n\n      out[_utils.camelize(_fields[field])] = value;\n    }\n  });\n\n  return out;\n}\n\nfunction snapshot(options, optionalHttpRequestOptions, cb) {\n  var symbols = options.symbols || _.flatten([options.symbol]);\n  options = _.clone(options);\n  _sanitizeSnapshotOptions(options);\n\n  if(optionalHttpRequestOptions && typeof optionalHttpRequestOptions == 'function') {\n    cb = optionalHttpRequestOptions;\n    optionalHttpRequestOptions = {};\n  } else if (!optionalHttpRequestOptions) {\n    optionalHttpRequestOptions = {};\n  }\n\n  optionalHttpRequestOptions.json = true;\n\n  return getCrumb(symbols[0])\n    .then(function(crumb) {\n      return Promise.map(symbols, function (symbol) {\n        var url = _constants.SNAPSHOT_URL.replace(/\\$SYMBOL/, symbol);\n        return _utils.download(url, {\n            formatted: 'false',\n            crumb: crumb,\n            modules: options.modules.join(','),\n            corsDomain: 'finance.yahoo.com'\n          }, optionalHttpRequestOptions)\n          .then(function (data) {\n            return _transformSnapshot(options.fields, symbols, data);\n          })\n      }, {concurrency: options.maxConcurrentSymbols || os.cpus().length})\n      .then(function (results) {\n        if (options.symbols) {\n          return _.zipObject(symbols, results);\n        } else {\n          return results[0];\n        }\n      })\n      .catch(function (err) {\n        throw new Error(util.format('Failed to download data (%s)', err.message));\n      })\n      .nodeify(cb);\n    });\n}\n\n// API (ES6 syntax with default export)\nexports.__esModule = true;\nexports.default = snapshot;\n\n// For testing\nexports.mappedFields = mappedFields;\n"]},"metadata":{},"sourceType":"script"}