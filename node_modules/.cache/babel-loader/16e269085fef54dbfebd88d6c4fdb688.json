{"ast":null,"code":"'use strict'; //  ---------------------------------------------------------------------------\n\nconst Exchange = require('./base/Exchange');\n\nconst {\n  ExchangeError,\n  InvalidNonce,\n  AuthenticationError,\n  OrderNotFound\n} = require('./base/errors');\n\nconst {\n  TICK_SIZE\n} = require('./base/functions/number'); //  ---------------------------------------------------------------------------\n\n\nmodule.exports = class bitso extends Exchange {\n  describe() {\n    return this.deepExtend(super.describe(), {\n      'id': 'bitso',\n      'name': 'Bitso',\n      'countries': ['MX'],\n      // Mexico\n      'rateLimit': 2000,\n      // 30 requests per minute\n      'version': 'v3',\n      'has': {\n        'cancelOrder': true,\n        'CORS': false,\n        'createOrder': true,\n        'fetchBalance': true,\n        'fetchDepositAddress': true,\n        'fetchMarkets': true,\n        'fetchMyTrades': true,\n        'fetchOpenOrders': true,\n        'fetchOrder': true,\n        'fetchOrderBook': true,\n        'fetchOrderTrades': true,\n        'fetchTicker': true,\n        'fetchTrades': true,\n        'withdraw': true\n      },\n      'urls': {\n        'logo': 'https://user-images.githubusercontent.com/51840849/87295554-11f98280-c50e-11ea-80d6-15b3bafa8cbf.jpg',\n        'api': 'https://api.bitso.com',\n        'www': 'https://bitso.com',\n        'doc': 'https://bitso.com/api_info',\n        'fees': 'https://bitso.com/fees',\n        'referral': 'https://bitso.com/?ref=itej'\n      },\n      'precisionMode': TICK_SIZE,\n      'options': {\n        'precision': {\n          'XRP': 0.000001,\n          'MXN': 0.01,\n          'TUSD': 0.01\n        },\n        'defaultPrecision': 0.00000001\n      },\n      'api': {\n        'public': {\n          'get': ['available_books', 'ticker', 'order_book', 'trades']\n        },\n        'private': {\n          'get': ['account_status', 'balance', 'fees', 'fundings', 'fundings/{fid}', 'funding_destination', 'kyc_documents', 'ledger', 'ledger/trades', 'ledger/fees', 'ledger/fundings', 'ledger/withdrawals', 'mx_bank_codes', 'open_orders', 'order_trades/{oid}', 'orders/{oid}', 'user_trades', 'user_trades/{tid}', 'withdrawals/', 'withdrawals/{wid}'],\n          'post': ['bitcoin_withdrawal', 'debit_card_withdrawal', 'ether_withdrawal', 'ripple_withdrawal', 'bcash_withdrawal', 'litecoin_withdrawal', 'orders', 'phone_number', 'phone_verification', 'phone_withdrawal', 'spei_withdrawal', 'ripple_withdrawal', 'bcash_withdrawal', 'litecoin_withdrawal'],\n          'delete': ['orders/{oid}', 'orders/all']\n        }\n      },\n      'exceptions': {\n        '0201': AuthenticationError,\n        // Invalid Nonce or Invalid Credentials\n        '104': InvalidNonce // Cannot perform request - nonce must be higher than 1520307203724237\n\n      }\n    });\n  }\n\n  async fetchMarkets(params = {}) {\n    const response = await this.publicGetAvailableBooks(params); //\n    //     {\n    //         \"success\":true,\n    //         \"payload\":[\n    //             {\n    //                 \"book\":\"btc_mxn\",\n    //                 \"minimum_price\":\"500\",\n    //                 \"maximum_price\":\"10000000\",\n    //                 \"minimum_amount\":\"0.00005\",\n    //                 \"maximum_amount\":\"500\",\n    //                 \"minimum_value\":\"5\",\n    //                 \"maximum_value\":\"10000000\",\n    //                 \"tick_size\":\"0.01\",\n    //                 \"fees\":{\n    //                     \"flat_rate\":{\"maker\":\"0.500\",\"taker\":\"0.650\"},\n    //                     \"structure\":[\n    //                         {\"volume\":\"1500000\",\"maker\":\"0.00500\",\"taker\":\"0.00650\"},\n    //                         {\"volume\":\"2000000\",\"maker\":\"0.00490\",\"taker\":\"0.00637\"},\n    //                         {\"volume\":\"5000000\",\"maker\":\"0.00480\",\"taker\":\"0.00624\"},\n    //                         {\"volume\":\"7000000\",\"maker\":\"0.00440\",\"taker\":\"0.00572\"},\n    //                         {\"volume\":\"10000000\",\"maker\":\"0.00420\",\"taker\":\"0.00546\"},\n    //                         {\"volume\":\"15000000\",\"maker\":\"0.00400\",\"taker\":\"0.00520\"},\n    //                         {\"volume\":\"35000000\",\"maker\":\"0.00370\",\"taker\":\"0.00481\"},\n    //                         {\"volume\":\"50000000\",\"maker\":\"0.00300\",\"taker\":\"0.00390\"},\n    //                         {\"volume\":\"150000000\",\"maker\":\"0.00200\",\"taker\":\"0.00260\"},\n    //                         {\"volume\":\"250000000\",\"maker\":\"0.00100\",\"taker\":\"0.00130\"},\n    //                         {\"volume\":\"9999999999\",\"maker\":\"0.00000\",\"taker\":\"0.00130\"},\n    //                     ]\n    //                 }\n    //             },\n    //         ]\n    //     }\n\n    const markets = this.safeValue(response, 'payload');\n    const result = [];\n\n    for (let i = 0; i < markets.length; i++) {\n      const market = markets[i];\n      const id = this.safeString(market, 'book');\n      const [baseId, quoteId] = id.split('_');\n      let base = baseId.toUpperCase();\n      let quote = quoteId.toUpperCase();\n      base = this.safeCurrencyCode(base);\n      quote = this.safeCurrencyCode(quote);\n      const symbol = base + '/' + quote;\n      const limits = {\n        'amount': {\n          'min': this.safeFloat(market, 'minimum_amount'),\n          'max': this.safeFloat(market, 'maximum_amount')\n        },\n        'price': {\n          'min': this.safeFloat(market, 'minimum_price'),\n          'max': this.safeFloat(market, 'maximum_price')\n        },\n        'cost': {\n          'min': this.safeFloat(market, 'minimum_value'),\n          'max': this.safeFloat(market, 'maximum_value')\n        }\n      };\n      const defaultPricePrecision = this.safeFloat(this.options['precision'], quote, this.options['defaultPrecision']);\n      const pricePrecision = this.safeFloat(market, 'tick_size', defaultPricePrecision);\n      const precision = {\n        'amount': this.safeFloat(this.options['precision'], base, this.options['defaultPrecision']),\n        'price': pricePrecision\n      };\n      const fees = this.safeValue(market, 'fees', {});\n      const flatRate = this.safeValue(fees, 'flat_rate', {});\n      const maker = this.safeFloat(flatRate, 'maker');\n      const taker = this.safeFloat(flatRate, 'taker');\n      const feeTiers = this.safeValue(fees, 'structure', []);\n      const fee = {\n        'maker': maker,\n        'taker': taker,\n        'percentage': true,\n        'tierBased': true\n      };\n      const takerFees = [];\n      const makerFees = [];\n\n      for (let j = 0; j < feeTiers.length; j++) {\n        const tier = feeTiers[j];\n        const volume = this.safeFloat(tier, 'volume');\n        const takerFee = this.safeFloat(tier, 'taker');\n        const makerFee = this.safeFloat(tier, 'maker');\n        takerFees.push([volume, takerFee]);\n        makerFees.push([volume, makerFee]);\n\n        if (j === 0) {\n          fee['taker'] = taker;\n          fee['maker'] = maker;\n        }\n      }\n\n      const tiers = {\n        'taker': takerFees,\n        'maker': makerFees\n      };\n      fee['tiers'] = tiers;\n      result.push(this.extend({\n        'id': id,\n        'symbol': symbol,\n        'base': base,\n        'quote': quote,\n        'baseId': baseId,\n        'quoteId': quoteId,\n        'info': market,\n        'limits': limits,\n        'precision': precision,\n        'active': undefined\n      }, fee));\n    }\n\n    return result;\n  }\n\n  async fetchBalance(params = {}) {\n    await this.loadMarkets();\n    const response = await this.privateGetBalance(params);\n    const balances = this.safeValue(response['payload'], 'balances');\n    const result = {\n      'info': response\n    };\n\n    for (let i = 0; i < balances.length; i++) {\n      const balance = balances[i];\n      const currencyId = this.safeString(balance, 'currency');\n      const code = this.safeCurrencyCode(currencyId);\n      const account = {\n        'free': this.safeFloat(balance, 'available'),\n        'used': this.safeFloat(balance, 'locked'),\n        'total': this.safeFloat(balance, 'total')\n      };\n      result[code] = account;\n    }\n\n    return this.parseBalance(result);\n  }\n\n  async fetchOrderBook(symbol, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    const request = {\n      'book': this.marketId(symbol)\n    };\n    const response = await this.publicGetOrderBook(this.extend(request, params));\n    const orderbook = this.safeValue(response, 'payload');\n    const timestamp = this.parse8601(this.safeString(orderbook, 'updated_at'));\n    return this.parseOrderBook(orderbook, timestamp, 'bids', 'asks', 'price', 'amount');\n  }\n\n  async fetchTicker(symbol, params = {}) {\n    await this.loadMarkets();\n    const request = {\n      'book': this.marketId(symbol)\n    };\n    const response = await this.publicGetTicker(this.extend(request, params));\n    const ticker = this.safeValue(response, 'payload');\n    const timestamp = this.parse8601(this.safeString(ticker, 'created_at'));\n    const vwap = this.safeFloat(ticker, 'vwap');\n    const baseVolume = this.safeFloat(ticker, 'volume');\n    let quoteVolume = undefined;\n\n    if (baseVolume !== undefined && vwap !== undefined) {\n      quoteVolume = baseVolume * vwap;\n    }\n\n    const last = this.safeFloat(ticker, 'last');\n    return {\n      'symbol': symbol,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'high': this.safeFloat(ticker, 'high'),\n      'low': this.safeFloat(ticker, 'low'),\n      'bid': this.safeFloat(ticker, 'bid'),\n      'bidVolume': undefined,\n      'ask': this.safeFloat(ticker, 'ask'),\n      'askVolume': undefined,\n      'vwap': vwap,\n      'open': undefined,\n      'close': last,\n      'last': last,\n      'previousClose': undefined,\n      'change': undefined,\n      'percentage': undefined,\n      'average': undefined,\n      'baseVolume': baseVolume,\n      'quoteVolume': quoteVolume,\n      'info': ticker\n    };\n  }\n\n  parseTrade(trade, market = undefined) {\n    const timestamp = this.parse8601(this.safeString(trade, 'created_at'));\n    const marketId = this.safeString(trade, 'book');\n    const symbol = this.safeSymbol(marketId, market, '_');\n    const side = this.safeString2(trade, 'side', 'maker_side');\n    let amount = this.safeFloat2(trade, 'amount', 'major');\n\n    if (amount !== undefined) {\n      amount = Math.abs(amount);\n    }\n\n    let fee = undefined;\n    const feeCost = this.safeFloat(trade, 'fees_amount');\n\n    if (feeCost !== undefined) {\n      const feeCurrencyId = this.safeString(trade, 'fees_currency');\n      const feeCurrency = this.safeCurrencyCode(feeCurrencyId);\n      fee = {\n        'cost': feeCost,\n        'currency': feeCurrency\n      };\n    }\n\n    let cost = this.safeFloat(trade, 'minor');\n\n    if (cost !== undefined) {\n      cost = Math.abs(cost);\n    }\n\n    const price = this.safeFloat(trade, 'price');\n    const orderId = this.safeString(trade, 'oid');\n    const id = this.safeString(trade, 'tid');\n    return {\n      'id': id,\n      'info': trade,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'symbol': symbol,\n      'order': orderId,\n      'type': undefined,\n      'side': side,\n      'takerOrMaker': undefined,\n      'price': price,\n      'amount': amount,\n      'cost': cost,\n      'fee': fee\n    };\n  }\n\n  async fetchTrades(symbol, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'book': market['id']\n    };\n    const response = await this.publicGetTrades(this.extend(request, params));\n    return this.parseTrades(response['payload'], market, since, limit);\n  }\n\n  async fetchMyTrades(symbol = undefined, since = undefined, limit = 25, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol); // the don't support fetching trades starting from a date yet\n    // use the `marker` extra param for that\n    // this is not a typo, the variable name is 'marker' (don't confuse with 'market')\n\n    const markerInParams = ('marker' in params); // warn the user with an exception if the user wants to filter\n    // starting from since timestamp, but does not set the trade id with an extra 'marker' param\n\n    if (since !== undefined && !markerInParams) {\n      throw new ExchangeError(this.id + ' fetchMyTrades does not support fetching trades starting from a timestamp with the `since` argument, use the `marker` extra param to filter starting from an integer trade id');\n    } // convert it to an integer unconditionally\n\n\n    if (markerInParams) {\n      params = this.extend(params, {\n        'marker': parseInt(params['marker'])\n      });\n    }\n\n    const request = {\n      'book': market['id'],\n      'limit': limit // default = 25, max = 100\n      // 'sort': 'desc', // default = desc\n      // 'marker': id, // integer id to start from\n\n    };\n    const response = await this.privateGetUserTrades(this.extend(request, params));\n    return this.parseTrades(response['payload'], market, since, limit);\n  }\n\n  async createOrder(symbol, type, side, amount, price = undefined, params = {}) {\n    await this.loadMarkets();\n    const request = {\n      'book': this.marketId(symbol),\n      'side': side,\n      'type': type,\n      'major': this.amountToPrecision(symbol, amount)\n    };\n\n    if (type === 'limit') {\n      request['price'] = this.priceToPrecision(symbol, price);\n    }\n\n    const response = await this.privatePostOrders(this.extend(request, params));\n    const id = this.safeString(response['payload'], 'oid');\n    return {\n      'info': response,\n      'id': id\n    };\n  }\n\n  async cancelOrder(id, symbol = undefined, params = {}) {\n    await this.loadMarkets();\n    const request = {\n      'oid': id\n    };\n    return await this.privateDeleteOrdersOid(this.extend(request, params));\n  }\n\n  parseOrderStatus(status) {\n    const statuses = {\n      'partial-fill': 'open',\n      // this is a common substitution in ccxt\n      'completed': 'closed'\n    };\n    return this.safeString(statuses, status, status);\n  }\n\n  parseOrder(order, market = undefined) {\n    const id = this.safeString(order, 'oid');\n    const side = this.safeString(order, 'side');\n    const status = this.parseOrderStatus(this.safeString(order, 'status'));\n    const marketId = this.safeString(order, 'book');\n    const symbol = this.safeSymbol(marketId, market, '_');\n    const orderType = this.safeString(order, 'type');\n    const timestamp = this.parse8601(this.safeString(order, 'created_at'));\n    const price = this.safeFloat(order, 'price');\n    const amount = this.safeFloat(order, 'original_amount');\n    const remaining = this.safeFloat(order, 'unfilled_amount');\n    let filled = undefined;\n\n    if (amount !== undefined) {\n      if (remaining !== undefined) {\n        filled = amount - remaining;\n      }\n    }\n\n    const clientOrderId = this.safeString(order, 'client_id');\n    return {\n      'info': order,\n      'id': id,\n      'clientOrderId': clientOrderId,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'lastTradeTimestamp': undefined,\n      'symbol': symbol,\n      'type': orderType,\n      'timeInForce': undefined,\n      'postOnly': undefined,\n      'side': side,\n      'price': price,\n      'stopPrice': undefined,\n      'amount': amount,\n      'cost': undefined,\n      'remaining': remaining,\n      'filled': filled,\n      'status': status,\n      'fee': undefined,\n      'average': undefined,\n      'trades': undefined\n    };\n  }\n\n  async fetchOpenOrders(symbol = undefined, since = undefined, limit = 25, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol); // the don't support fetching trades starting from a date yet\n    // use the `marker` extra param for that\n    // this is not a typo, the variable name is 'marker' (don't confuse with 'market')\n\n    const markerInParams = ('marker' in params); // warn the user with an exception if the user wants to filter\n    // starting from since timestamp, but does not set the trade id with an extra 'marker' param\n\n    if (since !== undefined && !markerInParams) {\n      throw new ExchangeError(this.id + ' fetchOpenOrders does not support fetching orders starting from a timestamp with the `since` argument, use the `marker` extra param to filter starting from an integer trade id');\n    } // convert it to an integer unconditionally\n\n\n    if (markerInParams) {\n      params = this.extend(params, {\n        'marker': parseInt(params['marker'])\n      });\n    }\n\n    const request = {\n      'book': market['id'],\n      'limit': limit // default = 25, max = 100\n      // 'sort': 'desc', // default = desc\n      // 'marker': id, // integer id to start from\n\n    };\n    const response = await this.privateGetOpenOrders(this.extend(request, params));\n    const orders = this.parseOrders(response['payload'], market, since, limit);\n    return orders;\n  }\n\n  async fetchOrder(id, symbol = undefined, params = {}) {\n    await this.loadMarkets();\n    const response = await this.privateGetOrdersOid({\n      'oid': id\n    });\n    const payload = this.safeValue(response, 'payload');\n\n    if (Array.isArray(payload)) {\n      const numOrders = response['payload'].length;\n\n      if (numOrders === 1) {\n        return this.parseOrder(payload[0]);\n      }\n    }\n\n    throw new OrderNotFound(this.id + ': The order ' + id + ' not found.');\n  }\n\n  async fetchOrderTrades(id, symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'oid': id\n    };\n    const response = await this.privateGetOrderTradesOid(this.extend(request, params));\n    return this.parseTrades(response['payload'], market);\n  }\n\n  async fetchDepositAddress(code, params = {}) {\n    await this.loadMarkets();\n    const currency = this.currency(code);\n    const request = {\n      'fund_currency': currency['id']\n    };\n    const response = await this.privateGetFundingDestination(this.extend(request, params));\n    let address = this.safeString(response['payload'], 'account_identifier');\n    let tag = undefined;\n\n    if (address.indexOf('?dt=') >= 0) {\n      const parts = address.split('?dt=');\n      address = this.safeString(parts, 0);\n      tag = this.safeString(parts, 1);\n    }\n\n    this.checkAddress(address);\n    return {\n      'currency': code,\n      'address': address,\n      'tag': tag,\n      'info': response\n    };\n  }\n\n  async withdraw(code, amount, address, tag = undefined, params = {}) {\n    this.checkAddress(address);\n    await this.loadMarkets();\n    const methods = {\n      'BTC': 'Bitcoin',\n      'ETH': 'Ether',\n      'XRP': 'Ripple',\n      'BCH': 'Bcash',\n      'LTC': 'Litecoin'\n    };\n    const method = code in methods ? methods[code] : undefined;\n\n    if (method === undefined) {\n      throw new ExchangeError(this.id + ' not valid withdraw coin: ' + code);\n    }\n\n    const request = {\n      'amount': amount,\n      'address': address,\n      'destination_tag': tag\n    };\n    const classMethod = 'privatePost' + method + 'Withdrawal';\n    const response = await this[classMethod](this.extend(request, params));\n    return {\n      'info': response,\n      'id': this.safeString(response['payload'], 'wid')\n    };\n  }\n\n  sign(path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n    let endpoint = '/' + this.version + '/' + this.implodeParams(path, params);\n    const query = this.omit(params, this.extractParams(path));\n\n    if (method === 'GET') {\n      if (Object.keys(query).length) {\n        endpoint += '?' + this.urlencode(query);\n      }\n    }\n\n    const url = this.urls['api'] + endpoint;\n\n    if (api === 'private') {\n      this.checkRequiredCredentials();\n      const nonce = this.nonce().toString();\n      let request = [nonce, method, endpoint].join('');\n\n      if (method !== 'GET') {\n        if (Object.keys(query).length) {\n          body = this.json(query);\n          request += body;\n        }\n      }\n\n      const signature = this.hmac(this.encode(request), this.encode(this.secret));\n      const auth = this.apiKey + ':' + nonce + ':' + signature;\n      headers = {\n        'Authorization': 'Bitso ' + auth,\n        'Content-Type': 'application/json'\n      };\n    }\n\n    return {\n      'url': url,\n      'method': method,\n      'body': body,\n      'headers': headers\n    };\n  }\n\n  handleErrors(httpCode, reason, url, method, headers, body, response, requestHeaders, requestBody) {\n    if (response === undefined) {\n      return; // fallback to default error handler\n    }\n\n    if ('success' in response) {\n      //\n      //     {\"success\":false,\"error\":{\"code\":104,\"message\":\"Cannot perform request - nonce must be higher than 1520307203724237\"}}\n      //\n      let success = this.safeValue(response, 'success', false);\n\n      if (typeof success === 'string') {\n        if (success === 'true' || success === '1') {\n          success = true;\n        } else {\n          success = false;\n        }\n      }\n\n      if (!success) {\n        const feedback = this.id + ' ' + this.json(response);\n        const error = this.safeValue(response, 'error');\n\n        if (error === undefined) {\n          throw new ExchangeError(feedback);\n        }\n\n        const code = this.safeString(error, 'code');\n        this.throwExactlyMatchedException(this.exceptions, code, feedback);\n        throw new ExchangeError(feedback);\n      }\n    }\n  }\n\n  async request(path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n    const response = await this.fetch2(path, api, method, params, headers, body);\n\n    if ('success' in response) {\n      if (response['success']) {\n        return response;\n      }\n    }\n\n    throw new ExchangeError(this.id + ' ' + this.json(response));\n  }\n\n};","map":{"version":3,"sources":["C:/Users/senya/Documents/Coding/React Projects/react-stock-ticker/node_modules/ccxt/js/bitso.js"],"names":["Exchange","require","ExchangeError","InvalidNonce","AuthenticationError","OrderNotFound","TICK_SIZE","module","exports","bitso","describe","deepExtend","fetchMarkets","params","response","publicGetAvailableBooks","markets","safeValue","result","i","length","market","id","safeString","baseId","quoteId","split","base","toUpperCase","quote","safeCurrencyCode","symbol","limits","safeFloat","defaultPricePrecision","options","pricePrecision","precision","fees","flatRate","maker","taker","feeTiers","fee","takerFees","makerFees","j","tier","volume","takerFee","makerFee","push","tiers","extend","undefined","fetchBalance","loadMarkets","privateGetBalance","balances","balance","currencyId","code","account","parseBalance","fetchOrderBook","limit","request","marketId","publicGetOrderBook","orderbook","timestamp","parse8601","parseOrderBook","fetchTicker","publicGetTicker","ticker","vwap","baseVolume","quoteVolume","last","iso8601","parseTrade","trade","safeSymbol","side","safeString2","amount","safeFloat2","Math","abs","feeCost","feeCurrencyId","feeCurrency","cost","price","orderId","fetchTrades","since","publicGetTrades","parseTrades","fetchMyTrades","markerInParams","parseInt","privateGetUserTrades","createOrder","type","amountToPrecision","priceToPrecision","privatePostOrders","cancelOrder","privateDeleteOrdersOid","parseOrderStatus","status","statuses","parseOrder","order","orderType","remaining","filled","clientOrderId","fetchOpenOrders","privateGetOpenOrders","orders","parseOrders","fetchOrder","privateGetOrdersOid","payload","Array","isArray","numOrders","fetchOrderTrades","privateGetOrderTradesOid","fetchDepositAddress","currency","privateGetFundingDestination","address","tag","indexOf","parts","checkAddress","withdraw","methods","method","classMethod","sign","path","api","headers","body","endpoint","version","implodeParams","query","omit","extractParams","Object","keys","urlencode","url","urls","checkRequiredCredentials","nonce","toString","join","json","signature","hmac","encode","secret","auth","apiKey","handleErrors","httpCode","reason","requestHeaders","requestBody","success","feedback","error","throwExactlyMatchedException","exceptions","fetch2"],"mappings":"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","sourcesContent":["'use strict';\n\n//  ---------------------------------------------------------------------------\n\nconst Exchange = require ('./base/Exchange');\nconst { ExchangeError, InvalidNonce, AuthenticationError, OrderNotFound } = require ('./base/errors');\nconst { TICK_SIZE } = require ('./base/functions/number');\n\n//  ---------------------------------------------------------------------------\n\nmodule.exports = class bitso extends Exchange {\n    describe () {\n        return this.deepExtend (super.describe (), {\n            'id': 'bitso',\n            'name': 'Bitso',\n            'countries': [ 'MX' ], // Mexico\n            'rateLimit': 2000, // 30 requests per minute\n            'version': 'v3',\n            'has': {\n                'cancelOrder': true,\n                'CORS': false,\n                'createOrder': true,\n                'fetchBalance': true,\n                'fetchDepositAddress': true,\n                'fetchMarkets': true,\n                'fetchMyTrades': true,\n                'fetchOpenOrders': true,\n                'fetchOrder': true,\n                'fetchOrderBook': true,\n                'fetchOrderTrades': true,\n                'fetchTicker': true,\n                'fetchTrades': true,\n                'withdraw': true,\n            },\n            'urls': {\n                'logo': 'https://user-images.githubusercontent.com/51840849/87295554-11f98280-c50e-11ea-80d6-15b3bafa8cbf.jpg',\n                'api': 'https://api.bitso.com',\n                'www': 'https://bitso.com',\n                'doc': 'https://bitso.com/api_info',\n                'fees': 'https://bitso.com/fees',\n                'referral': 'https://bitso.com/?ref=itej',\n            },\n            'precisionMode': TICK_SIZE,\n            'options': {\n                'precision': {\n                    'XRP': 0.000001,\n                    'MXN': 0.01,\n                    'TUSD': 0.01,\n                },\n                'defaultPrecision': 0.00000001,\n            },\n            'api': {\n                'public': {\n                    'get': [\n                        'available_books',\n                        'ticker',\n                        'order_book',\n                        'trades',\n                    ],\n                },\n                'private': {\n                    'get': [\n                        'account_status',\n                        'balance',\n                        'fees',\n                        'fundings',\n                        'fundings/{fid}',\n                        'funding_destination',\n                        'kyc_documents',\n                        'ledger',\n                        'ledger/trades',\n                        'ledger/fees',\n                        'ledger/fundings',\n                        'ledger/withdrawals',\n                        'mx_bank_codes',\n                        'open_orders',\n                        'order_trades/{oid}',\n                        'orders/{oid}',\n                        'user_trades',\n                        'user_trades/{tid}',\n                        'withdrawals/',\n                        'withdrawals/{wid}',\n                    ],\n                    'post': [\n                        'bitcoin_withdrawal',\n                        'debit_card_withdrawal',\n                        'ether_withdrawal',\n                        'ripple_withdrawal',\n                        'bcash_withdrawal',\n                        'litecoin_withdrawal',\n                        'orders',\n                        'phone_number',\n                        'phone_verification',\n                        'phone_withdrawal',\n                        'spei_withdrawal',\n                        'ripple_withdrawal',\n                        'bcash_withdrawal',\n                        'litecoin_withdrawal',\n                    ],\n                    'delete': [\n                        'orders/{oid}',\n                        'orders/all',\n                    ],\n                },\n            },\n            'exceptions': {\n                '0201': AuthenticationError, // Invalid Nonce or Invalid Credentials\n                '104': InvalidNonce, // Cannot perform request - nonce must be higher than 1520307203724237\n            },\n        });\n    }\n\n    async fetchMarkets (params = {}) {\n        const response = await this.publicGetAvailableBooks (params);\n        //\n        //     {\n        //         \"success\":true,\n        //         \"payload\":[\n        //             {\n        //                 \"book\":\"btc_mxn\",\n        //                 \"minimum_price\":\"500\",\n        //                 \"maximum_price\":\"10000000\",\n        //                 \"minimum_amount\":\"0.00005\",\n        //                 \"maximum_amount\":\"500\",\n        //                 \"minimum_value\":\"5\",\n        //                 \"maximum_value\":\"10000000\",\n        //                 \"tick_size\":\"0.01\",\n        //                 \"fees\":{\n        //                     \"flat_rate\":{\"maker\":\"0.500\",\"taker\":\"0.650\"},\n        //                     \"structure\":[\n        //                         {\"volume\":\"1500000\",\"maker\":\"0.00500\",\"taker\":\"0.00650\"},\n        //                         {\"volume\":\"2000000\",\"maker\":\"0.00490\",\"taker\":\"0.00637\"},\n        //                         {\"volume\":\"5000000\",\"maker\":\"0.00480\",\"taker\":\"0.00624\"},\n        //                         {\"volume\":\"7000000\",\"maker\":\"0.00440\",\"taker\":\"0.00572\"},\n        //                         {\"volume\":\"10000000\",\"maker\":\"0.00420\",\"taker\":\"0.00546\"},\n        //                         {\"volume\":\"15000000\",\"maker\":\"0.00400\",\"taker\":\"0.00520\"},\n        //                         {\"volume\":\"35000000\",\"maker\":\"0.00370\",\"taker\":\"0.00481\"},\n        //                         {\"volume\":\"50000000\",\"maker\":\"0.00300\",\"taker\":\"0.00390\"},\n        //                         {\"volume\":\"150000000\",\"maker\":\"0.00200\",\"taker\":\"0.00260\"},\n        //                         {\"volume\":\"250000000\",\"maker\":\"0.00100\",\"taker\":\"0.00130\"},\n        //                         {\"volume\":\"9999999999\",\"maker\":\"0.00000\",\"taker\":\"0.00130\"},\n        //                     ]\n        //                 }\n        //             },\n        //         ]\n        //     }\n        const markets = this.safeValue (response, 'payload');\n        const result = [];\n        for (let i = 0; i < markets.length; i++) {\n            const market = markets[i];\n            const id = this.safeString (market, 'book');\n            const [ baseId, quoteId ] = id.split ('_');\n            let base = baseId.toUpperCase ();\n            let quote = quoteId.toUpperCase ();\n            base = this.safeCurrencyCode (base);\n            quote = this.safeCurrencyCode (quote);\n            const symbol = base + '/' + quote;\n            const limits = {\n                'amount': {\n                    'min': this.safeFloat (market, 'minimum_amount'),\n                    'max': this.safeFloat (market, 'maximum_amount'),\n                },\n                'price': {\n                    'min': this.safeFloat (market, 'minimum_price'),\n                    'max': this.safeFloat (market, 'maximum_price'),\n                },\n                'cost': {\n                    'min': this.safeFloat (market, 'minimum_value'),\n                    'max': this.safeFloat (market, 'maximum_value'),\n                },\n            };\n            const defaultPricePrecision = this.safeFloat (this.options['precision'], quote, this.options['defaultPrecision']);\n            const pricePrecision = this.safeFloat (market, 'tick_size', defaultPricePrecision);\n            const precision = {\n                'amount': this.safeFloat (this.options['precision'], base, this.options['defaultPrecision']),\n                'price': pricePrecision,\n            };\n            const fees = this.safeValue (market, 'fees', {});\n            const flatRate = this.safeValue (fees, 'flat_rate', {});\n            const maker = this.safeFloat (flatRate, 'maker');\n            const taker = this.safeFloat (flatRate, 'taker');\n            const feeTiers = this.safeValue (fees, 'structure', []);\n            const fee = {\n                'maker': maker,\n                'taker': taker,\n                'percentage': true,\n                'tierBased': true,\n            };\n            const takerFees = [];\n            const makerFees = [];\n            for (let j = 0; j < feeTiers.length; j++) {\n                const tier = feeTiers[j];\n                const volume = this.safeFloat (tier, 'volume');\n                const takerFee = this.safeFloat (tier, 'taker');\n                const makerFee = this.safeFloat (tier, 'maker');\n                takerFees.push ([ volume, takerFee ]);\n                makerFees.push ([ volume, makerFee ]);\n                if (j === 0) {\n                    fee['taker'] = taker;\n                    fee['maker'] = maker;\n                }\n            }\n            const tiers = {\n                'taker': takerFees,\n                'maker': makerFees,\n            };\n            fee['tiers'] = tiers;\n            result.push (this.extend ({\n                'id': id,\n                'symbol': symbol,\n                'base': base,\n                'quote': quote,\n                'baseId': baseId,\n                'quoteId': quoteId,\n                'info': market,\n                'limits': limits,\n                'precision': precision,\n                'active': undefined,\n            }, fee));\n        }\n        return result;\n    }\n\n    async fetchBalance (params = {}) {\n        await this.loadMarkets ();\n        const response = await this.privateGetBalance (params);\n        const balances = this.safeValue (response['payload'], 'balances');\n        const result = { 'info': response };\n        for (let i = 0; i < balances.length; i++) {\n            const balance = balances[i];\n            const currencyId = this.safeString (balance, 'currency');\n            const code = this.safeCurrencyCode (currencyId);\n            const account = {\n                'free': this.safeFloat (balance, 'available'),\n                'used': this.safeFloat (balance, 'locked'),\n                'total': this.safeFloat (balance, 'total'),\n            };\n            result[code] = account;\n        }\n        return this.parseBalance (result);\n    }\n\n    async fetchOrderBook (symbol, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        const request = {\n            'book': this.marketId (symbol),\n        };\n        const response = await this.publicGetOrderBook (this.extend (request, params));\n        const orderbook = this.safeValue (response, 'payload');\n        const timestamp = this.parse8601 (this.safeString (orderbook, 'updated_at'));\n        return this.parseOrderBook (orderbook, timestamp, 'bids', 'asks', 'price', 'amount');\n    }\n\n    async fetchTicker (symbol, params = {}) {\n        await this.loadMarkets ();\n        const request = {\n            'book': this.marketId (symbol),\n        };\n        const response = await this.publicGetTicker (this.extend (request, params));\n        const ticker = this.safeValue (response, 'payload');\n        const timestamp = this.parse8601 (this.safeString (ticker, 'created_at'));\n        const vwap = this.safeFloat (ticker, 'vwap');\n        const baseVolume = this.safeFloat (ticker, 'volume');\n        let quoteVolume = undefined;\n        if (baseVolume !== undefined && vwap !== undefined) {\n            quoteVolume = baseVolume * vwap;\n        }\n        const last = this.safeFloat (ticker, 'last');\n        return {\n            'symbol': symbol,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'high': this.safeFloat (ticker, 'high'),\n            'low': this.safeFloat (ticker, 'low'),\n            'bid': this.safeFloat (ticker, 'bid'),\n            'bidVolume': undefined,\n            'ask': this.safeFloat (ticker, 'ask'),\n            'askVolume': undefined,\n            'vwap': vwap,\n            'open': undefined,\n            'close': last,\n            'last': last,\n            'previousClose': undefined,\n            'change': undefined,\n            'percentage': undefined,\n            'average': undefined,\n            'baseVolume': baseVolume,\n            'quoteVolume': quoteVolume,\n            'info': ticker,\n        };\n    }\n\n    parseTrade (trade, market = undefined) {\n        const timestamp = this.parse8601 (this.safeString (trade, 'created_at'));\n        const marketId = this.safeString (trade, 'book');\n        const symbol = this.safeSymbol (marketId, market, '_');\n        const side = this.safeString2 (trade, 'side', 'maker_side');\n        let amount = this.safeFloat2 (trade, 'amount', 'major');\n        if (amount !== undefined) {\n            amount = Math.abs (amount);\n        }\n        let fee = undefined;\n        const feeCost = this.safeFloat (trade, 'fees_amount');\n        if (feeCost !== undefined) {\n            const feeCurrencyId = this.safeString (trade, 'fees_currency');\n            const feeCurrency = this.safeCurrencyCode (feeCurrencyId);\n            fee = {\n                'cost': feeCost,\n                'currency': feeCurrency,\n            };\n        }\n        let cost = this.safeFloat (trade, 'minor');\n        if (cost !== undefined) {\n            cost = Math.abs (cost);\n        }\n        const price = this.safeFloat (trade, 'price');\n        const orderId = this.safeString (trade, 'oid');\n        const id = this.safeString (trade, 'tid');\n        return {\n            'id': id,\n            'info': trade,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'symbol': symbol,\n            'order': orderId,\n            'type': undefined,\n            'side': side,\n            'takerOrMaker': undefined,\n            'price': price,\n            'amount': amount,\n            'cost': cost,\n            'fee': fee,\n        };\n    }\n\n    async fetchTrades (symbol, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'book': market['id'],\n        };\n        const response = await this.publicGetTrades (this.extend (request, params));\n        return this.parseTrades (response['payload'], market, since, limit);\n    }\n\n    async fetchMyTrades (symbol = undefined, since = undefined, limit = 25, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        // the don't support fetching trades starting from a date yet\n        // use the `marker` extra param for that\n        // this is not a typo, the variable name is 'marker' (don't confuse with 'market')\n        const markerInParams = ('marker' in params);\n        // warn the user with an exception if the user wants to filter\n        // starting from since timestamp, but does not set the trade id with an extra 'marker' param\n        if ((since !== undefined) && !markerInParams) {\n            throw new ExchangeError (this.id + ' fetchMyTrades does not support fetching trades starting from a timestamp with the `since` argument, use the `marker` extra param to filter starting from an integer trade id');\n        }\n        // convert it to an integer unconditionally\n        if (markerInParams) {\n            params = this.extend (params, {\n                'marker': parseInt (params['marker']),\n            });\n        }\n        const request = {\n            'book': market['id'],\n            'limit': limit, // default = 25, max = 100\n            // 'sort': 'desc', // default = desc\n            // 'marker': id, // integer id to start from\n        };\n        const response = await this.privateGetUserTrades (this.extend (request, params));\n        return this.parseTrades (response['payload'], market, since, limit);\n    }\n\n    async createOrder (symbol, type, side, amount, price = undefined, params = {}) {\n        await this.loadMarkets ();\n        const request = {\n            'book': this.marketId (symbol),\n            'side': side,\n            'type': type,\n            'major': this.amountToPrecision (symbol, amount),\n        };\n        if (type === 'limit') {\n            request['price'] = this.priceToPrecision (symbol, price);\n        }\n        const response = await this.privatePostOrders (this.extend (request, params));\n        const id = this.safeString (response['payload'], 'oid');\n        return {\n            'info': response,\n            'id': id,\n        };\n    }\n\n    async cancelOrder (id, symbol = undefined, params = {}) {\n        await this.loadMarkets ();\n        const request = {\n            'oid': id,\n        };\n        return await this.privateDeleteOrdersOid (this.extend (request, params));\n    }\n\n    parseOrderStatus (status) {\n        const statuses = {\n            'partial-fill': 'open', // this is a common substitution in ccxt\n            'completed': 'closed',\n        };\n        return this.safeString (statuses, status, status);\n    }\n\n    parseOrder (order, market = undefined) {\n        const id = this.safeString (order, 'oid');\n        const side = this.safeString (order, 'side');\n        const status = this.parseOrderStatus (this.safeString (order, 'status'));\n        const marketId = this.safeString (order, 'book');\n        const symbol = this.safeSymbol (marketId, market, '_');\n        const orderType = this.safeString (order, 'type');\n        const timestamp = this.parse8601 (this.safeString (order, 'created_at'));\n        const price = this.safeFloat (order, 'price');\n        const amount = this.safeFloat (order, 'original_amount');\n        const remaining = this.safeFloat (order, 'unfilled_amount');\n        let filled = undefined;\n        if (amount !== undefined) {\n            if (remaining !== undefined) {\n                filled = amount - remaining;\n            }\n        }\n        const clientOrderId = this.safeString (order, 'client_id');\n        return {\n            'info': order,\n            'id': id,\n            'clientOrderId': clientOrderId,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'lastTradeTimestamp': undefined,\n            'symbol': symbol,\n            'type': orderType,\n            'timeInForce': undefined,\n            'postOnly': undefined,\n            'side': side,\n            'price': price,\n            'stopPrice': undefined,\n            'amount': amount,\n            'cost': undefined,\n            'remaining': remaining,\n            'filled': filled,\n            'status': status,\n            'fee': undefined,\n            'average': undefined,\n            'trades': undefined,\n        };\n    }\n\n    async fetchOpenOrders (symbol = undefined, since = undefined, limit = 25, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        // the don't support fetching trades starting from a date yet\n        // use the `marker` extra param for that\n        // this is not a typo, the variable name is 'marker' (don't confuse with 'market')\n        const markerInParams = ('marker' in params);\n        // warn the user with an exception if the user wants to filter\n        // starting from since timestamp, but does not set the trade id with an extra 'marker' param\n        if ((since !== undefined) && !markerInParams) {\n            throw new ExchangeError (this.id + ' fetchOpenOrders does not support fetching orders starting from a timestamp with the `since` argument, use the `marker` extra param to filter starting from an integer trade id');\n        }\n        // convert it to an integer unconditionally\n        if (markerInParams) {\n            params = this.extend (params, {\n                'marker': parseInt (params['marker']),\n            });\n        }\n        const request = {\n            'book': market['id'],\n            'limit': limit, // default = 25, max = 100\n            // 'sort': 'desc', // default = desc\n            // 'marker': id, // integer id to start from\n        };\n        const response = await this.privateGetOpenOrders (this.extend (request, params));\n        const orders = this.parseOrders (response['payload'], market, since, limit);\n        return orders;\n    }\n\n    async fetchOrder (id, symbol = undefined, params = {}) {\n        await this.loadMarkets ();\n        const response = await this.privateGetOrdersOid ({\n            'oid': id,\n        });\n        const payload = this.safeValue (response, 'payload');\n        if (Array.isArray (payload)) {\n            const numOrders = response['payload'].length;\n            if (numOrders === 1) {\n                return this.parseOrder (payload[0]);\n            }\n        }\n        throw new OrderNotFound (this.id + ': The order ' + id + ' not found.');\n    }\n\n    async fetchOrderTrades (id, symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'oid': id,\n        };\n        const response = await this.privateGetOrderTradesOid (this.extend (request, params));\n        return this.parseTrades (response['payload'], market);\n    }\n\n    async fetchDepositAddress (code, params = {}) {\n        await this.loadMarkets ();\n        const currency = this.currency (code);\n        const request = {\n            'fund_currency': currency['id'],\n        };\n        const response = await this.privateGetFundingDestination (this.extend (request, params));\n        let address = this.safeString (response['payload'], 'account_identifier');\n        let tag = undefined;\n        if (address.indexOf ('?dt=') >= 0) {\n            const parts = address.split ('?dt=');\n            address = this.safeString (parts, 0);\n            tag = this.safeString (parts, 1);\n        }\n        this.checkAddress (address);\n        return {\n            'currency': code,\n            'address': address,\n            'tag': tag,\n            'info': response,\n        };\n    }\n\n    async withdraw (code, amount, address, tag = undefined, params = {}) {\n        this.checkAddress (address);\n        await this.loadMarkets ();\n        const methods = {\n            'BTC': 'Bitcoin',\n            'ETH': 'Ether',\n            'XRP': 'Ripple',\n            'BCH': 'Bcash',\n            'LTC': 'Litecoin',\n        };\n        const method = (code in methods) ? methods[code] : undefined;\n        if (method === undefined) {\n            throw new ExchangeError (this.id + ' not valid withdraw coin: ' + code);\n        }\n        const request = {\n            'amount': amount,\n            'address': address,\n            'destination_tag': tag,\n        };\n        const classMethod = 'privatePost' + method + 'Withdrawal';\n        const response = await this[classMethod] (this.extend (request, params));\n        return {\n            'info': response,\n            'id': this.safeString (response['payload'], 'wid'),\n        };\n    }\n\n    sign (path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n        let endpoint = '/' + this.version + '/' + this.implodeParams (path, params);\n        const query = this.omit (params, this.extractParams (path));\n        if (method === 'GET') {\n            if (Object.keys (query).length) {\n                endpoint += '?' + this.urlencode (query);\n            }\n        }\n        const url = this.urls['api'] + endpoint;\n        if (api === 'private') {\n            this.checkRequiredCredentials ();\n            const nonce = this.nonce ().toString ();\n            let request = [ nonce, method, endpoint ].join ('');\n            if (method !== 'GET') {\n                if (Object.keys (query).length) {\n                    body = this.json (query);\n                    request += body;\n                }\n            }\n            const signature = this.hmac (this.encode (request), this.encode (this.secret));\n            const auth = this.apiKey + ':' + nonce + ':' + signature;\n            headers = {\n                'Authorization': 'Bitso ' + auth,\n                'Content-Type': 'application/json',\n            };\n        }\n        return { 'url': url, 'method': method, 'body': body, 'headers': headers };\n    }\n\n    handleErrors (httpCode, reason, url, method, headers, body, response, requestHeaders, requestBody) {\n        if (response === undefined) {\n            return; // fallback to default error handler\n        }\n        if ('success' in response) {\n            //\n            //     {\"success\":false,\"error\":{\"code\":104,\"message\":\"Cannot perform request - nonce must be higher than 1520307203724237\"}}\n            //\n            let success = this.safeValue (response, 'success', false);\n            if (typeof success === 'string') {\n                if ((success === 'true') || (success === '1')) {\n                    success = true;\n                } else {\n                    success = false;\n                }\n            }\n            if (!success) {\n                const feedback = this.id + ' ' + this.json (response);\n                const error = this.safeValue (response, 'error');\n                if (error === undefined) {\n                    throw new ExchangeError (feedback);\n                }\n                const code = this.safeString (error, 'code');\n                this.throwExactlyMatchedException (this.exceptions, code, feedback);\n                throw new ExchangeError (feedback);\n            }\n        }\n    }\n\n    async request (path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n        const response = await this.fetch2 (path, api, method, params, headers, body);\n        if ('success' in response) {\n            if (response['success']) {\n                return response;\n            }\n        }\n        throw new ExchangeError (this.id + ' ' + this.json (response));\n    }\n};\n"]},"metadata":{},"sourceType":"script"}