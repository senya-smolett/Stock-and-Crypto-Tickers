{"ast":null,"code":"var os = require('os');\n\nvar util = require('util');\n\nvar _ = require('lodash');\n\nvar Promise = require('bluebird');\n\nvar _constants = require('./constants');\n\nvar _utils = require('./utils');\n\nvar getCrumb = require('./yahooCrumb').getCrumb;\n\nvar validModules = ['summaryProfile', 'financialData', 'recommendationTrend', 'upgradeDowngradeHistory', 'earnings', 'price', 'summaryDetail', 'defaultKeyStatistics', 'calendarEvents'];\nvar dateFields = {\n  summaryDetail: ['exDividendDate'],\n  calendarEvents: ['exDividendDate', 'dividendDate'],\n  upgradeDowngradeHistory: ['history.epochGradeDate'],\n  price: ['preMarketTime', 'postMarketTime', 'regularMarketTime'],\n  defaultKeyStatistics: ['lastFiscalYearEnd', 'nextFiscalYearEnd', 'mostRecentQuarter', 'lastSplitDate']\n};\n\nfunction _sanitizeQuoteOptions(options) {\n  if (!_.isPlainObject(options)) {\n    throw new Error('\"options\" must be a plain object.');\n  }\n\n  if (_.isUndefined(options.symbol) && _.isUndefined(options.symbols)) {\n    throw new Error('Either \"options.symbol\" or \"options.symbols\" must be defined.');\n  }\n\n  if (!_.isUndefined(options.symbol) && !_.isUndefined(options.symbols)) {\n    throw new Error('Either \"options.symbol\" or \"options.symbols\" must be undefined.');\n  }\n\n  if (!_.isUndefined(options.symbol)) {\n    if (!_.isString(options.symbol) || _.isEmpty(options.symbol)) {\n      throw new Error('\"options.symbol\" must be a non-empty string.');\n    }\n  } else {\n    if (!_.isArray(options.symbols) || _.isEmpty(options.symbols)) {\n      throw new Error('\"options.symbols\" must be a non-empty string array.');\n    }\n  }\n\n  if (options.modules) {\n    if (!_.isArray(options.modules)) throw new Error('\"options.modules\" must be a non-empty string array or undefined.');\n  } else {\n    options.modules = ['price', 'summaryDetail'];\n  }\n\n  var invalid = _.difference(options.modules, validModules);\n\n  if (invalid.length) {\n    var available = _.difference(validModules, options.modules);\n\n    throw new Error(\"[yahoo-finance] quote(): The following requested \" + \"modules do not exist: \" + JSON.stringify(invalid) + \".  Did you mean one of: \" + JSON.stringify(available) + \"?\");\n  }\n}\n\nfunction transformDates(result) {\n  _.each(_.keys(result), function (module) {\n    _.each(dateFields[module], function (field) {\n      if (field.indexOf('.') === -1) {\n        if (result[module][field]) result[module][field] = new Date(result[module][field] * 1000);\n      } else {\n        var parts = field.split('.');\n        var arrayName = parts[0];\n        var subField = parts[1];\n        if (result[module][arrayName]) _.each(result[module][arrayName], function (row) {\n          if (row[subField]) row[subField] = new Date(row[subField] * 1000);\n        });\n      }\n    });\n  });\n\n  return result;\n}\n\nfunction quote(options, optionalHttpRequestOptions, cb) {\n  if (_.isString(options)) {\n    options = {\n      symbol: options\n    };\n\n    if (_.isArray(optionalHttpRequestOptions)) {\n      options.modules = optionalHttpRequestOptions;\n      optionalHttpRequestOptions = undefined;\n    }\n  }\n\n  var symbols = options.symbols || _.flatten([options.symbol]);\n\n  options = _.clone(options);\n\n  _sanitizeQuoteOptions(options);\n\n  if (optionalHttpRequestOptions && typeof optionalHttpRequestOptions == 'function') {\n    cb = optionalHttpRequestOptions;\n    optionalHttpRequestOptions = {};\n  } else if (!optionalHttpRequestOptions) {\n    optionalHttpRequestOptions = {};\n  }\n\n  optionalHttpRequestOptions.json = true;\n  return getCrumb(symbols[0]).then(function (crumb) {\n    return Promise.map(symbols, function (symbol) {\n      var url = _constants.SNAPSHOT_URL.replace(/\\$SYMBOL/, symbol);\n\n      return _utils.download(url, {\n        formatted: 'false',\n        crumb: crumb,\n        modules: options.modules.join(','),\n        corsDomain: 'finance.yahoo.com'\n      }, optionalHttpRequestOptions).then(function (result) {\n        var quoteSummary = result.quoteSummary;\n        if (!quoteSummary || quoteSummary.error) throw new Error(quoteSummary.error);\n        var result = quoteSummary.result;\n        if (!_.isArray(result) || result.length > 1) throw new Error(\"quoteSummary format has changed, please report \" + \"this.\");\n        return result[0];\n      }).then(transformDates);\n    }, {\n      concurrency: options.maxConcurrentSymbols || os.cpus().length\n    }).then(function (results) {\n      if (options.symbols) {\n        return _.zipObject(symbols, results);\n      } else {\n        return results[0];\n      }\n    }).catch(function (err) {\n      throw new Error(util.format('Failed to download data (%s)', err.message));\n    }).nodeify(cb);\n  });\n} // API (ES6 syntax with default export)\n\n\nexports.__esModule = true;\nexports.default = quote; // Used by snapshot\n\nexports.dateFields = dateFields; // For tests\n\nexports._sanitizeQuoteOptions = _sanitizeQuoteOptions;","map":{"version":3,"sources":["C:/Users/senya/Documents/Coding/React Projects/react-stock-ticker/node_modules/yahoo-finance/lib/quote.js"],"names":["os","require","util","_","Promise","_constants","_utils","getCrumb","validModules","dateFields","summaryDetail","calendarEvents","upgradeDowngradeHistory","price","defaultKeyStatistics","_sanitizeQuoteOptions","options","isPlainObject","Error","isUndefined","symbol","symbols","isString","isEmpty","isArray","modules","invalid","difference","length","available","JSON","stringify","transformDates","result","each","keys","module","field","indexOf","Date","parts","split","arrayName","subField","row","quote","optionalHttpRequestOptions","cb","undefined","flatten","clone","json","then","crumb","map","url","SNAPSHOT_URL","replace","download","formatted","join","corsDomain","quoteSummary","error","concurrency","maxConcurrentSymbols","cpus","results","zipObject","catch","err","format","message","nodeify","exports","__esModule","default"],"mappings":"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","sourcesContent":["var os = require('os');\nvar util = require('util');\n\nvar _ = require('lodash');\nvar Promise = require('bluebird');\n\nvar _constants = require('./constants');\nvar _utils = require('./utils');\nvar getCrumb = require('./yahooCrumb').getCrumb;\n\nvar validModules = [\n  'summaryProfile', 'financialData', 'recommendationTrend',\n  'upgradeDowngradeHistory', 'earnings', 'price', 'summaryDetail',\n  'defaultKeyStatistics', 'calendarEvents'\n];\n\nvar dateFields = {\n  summaryDetail: [ 'exDividendDate' ],\n  calendarEvents: [ 'exDividendDate', 'dividendDate' ],\n  upgradeDowngradeHistory: [ 'history.epochGradeDate' ],\n  price: [ 'preMarketTime', 'postMarketTime', 'regularMarketTime' ],\n  defaultKeyStatistics: [\n    'lastFiscalYearEnd', 'nextFiscalYearEnd',\n    'mostRecentQuarter', 'lastSplitDate'\n  ]\n};\n\nfunction _sanitizeQuoteOptions(options) {\n  if (!_.isPlainObject(options)) {\n    throw new Error('\"options\" must be a plain object.');\n  }\n  if (_.isUndefined(options.symbol) && _.isUndefined(options.symbols)) {\n    throw new Error('Either \"options.symbol\" or \"options.symbols\" must be defined.');\n  }\n  if (!_.isUndefined(options.symbol) && !_.isUndefined(options.symbols)) {\n    throw new Error('Either \"options.symbol\" or \"options.symbols\" must be undefined.');\n  }\n\n  if (!_.isUndefined(options.symbol)) {\n    if (!_.isString(options.symbol) || _.isEmpty(options.symbol)) {\n      throw new Error('\"options.symbol\" must be a non-empty string.');\n    }\n  } else {\n    if (!_.isArray(options.symbols) || _.isEmpty(options.symbols)) {\n      throw new Error('\"options.symbols\" must be a non-empty string array.');\n    }\n  }\n\n  if (options.modules) {\n    if (!_.isArray(options.modules))\n      throw new Error('\"options.modules\" must be a non-empty string array or undefined.');\n  } else {\n    options.modules = ['price', 'summaryDetail'];\n  }\n\n  var invalid = _.difference(options.modules, validModules);\n  if (invalid.length) {\n    var available = _.difference(validModules, options.modules);\n    throw new Error(\"[yahoo-finance] quote(): The following requested \" +\n      \"modules do not exist: \" + JSON.stringify(invalid) +\n      \".  Did you mean one of: \" + JSON.stringify(available) + \"?\");\n  }\n}\n\nfunction transformDates(result) {\n  _.each(_.keys(result), function(module) {\n    _.each(dateFields[module], function(field) {\n\n      if (field.indexOf('.') === -1) {\n\n        if (result[module][field])\n          result[module][field] = new Date(result[module][field] * 1000);\n\n      } else {\n\n        var parts = field.split('.');\n        var arrayName = parts[0];\n        var subField = parts[1];\n\n        if (result[module][arrayName])\n        _.each(result[module][arrayName], function(row) {\n          if (row[subField])\n            row[subField] = new Date(row[subField] * 1000);\n        });\n\n      }\n    });\n  });\n  return result;\n}\n\nfunction quote(options, optionalHttpRequestOptions, cb) {\n  if (_.isString(options)) {\n    options = { symbol: options };\n    if (_.isArray(optionalHttpRequestOptions)) {\n      options.modules = optionalHttpRequestOptions;\n      optionalHttpRequestOptions = undefined;\n    }\n  }\n\n  var symbols = options.symbols || _.flatten([options.symbol]);\n  options = _.clone(options);\n  _sanitizeQuoteOptions(options);\n\n  if(optionalHttpRequestOptions && typeof optionalHttpRequestOptions == 'function') {\n    cb = optionalHttpRequestOptions;\n    optionalHttpRequestOptions = {};\n  } else if (!optionalHttpRequestOptions) {\n    optionalHttpRequestOptions = {};\n  }\n\n  optionalHttpRequestOptions.json = true;\n\n  return getCrumb(symbols[0])\n    .then(function(crumb) {\n      return Promise.map(symbols, function (symbol) {\n        var url = _constants.SNAPSHOT_URL.replace(/\\$SYMBOL/, symbol);\n        return _utils.download(url, {\n            formatted: 'false',\n            crumb: crumb,\n            modules: options.modules.join(','),\n            corsDomain: 'finance.yahoo.com'\n          }, optionalHttpRequestOptions)\n          .then(function(result) {\n            var quoteSummary = result.quoteSummary;\n            if (!quoteSummary || quoteSummary.error)\n              throw new Error(quoteSummary.error);\n\n            var result = quoteSummary.result;\n            if (!_.isArray(result) || result.length > 1)\n              throw new Error(\"quoteSummary format has changed, please report \"\n                + \"this.\");\n\n            return result[0];\n          })\n          .then(transformDates)\n      }, {concurrency: options.maxConcurrentSymbols || os.cpus().length})\n      .then(function (results) {\n        if (options.symbols) {\n          return _.zipObject(symbols, results);\n        } else {\n          return results[0];\n        }\n      })\n      .catch(function (err) {\n        throw new Error(util.format('Failed to download data (%s)', err.message));\n      })\n      .nodeify(cb);\n    });\n}\n\n// API (ES6 syntax with default export)\nexports.__esModule = true;\nexports.default = quote;\n\n// Used by snapshot\nexports.dateFields = dateFields;\n\n// For tests\nexports._sanitizeQuoteOptions = _sanitizeQuoteOptions;\n"]},"metadata":{},"sourceType":"script"}